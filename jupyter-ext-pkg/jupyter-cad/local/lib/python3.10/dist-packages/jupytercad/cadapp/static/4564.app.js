"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4564],{32293:(e,t,n)=>{var i;n.d(t,{N:()=>i}),function(e){e.defaultMimeType="text/plain"}(i||(i={}))},74564:(e,t,n)=>{n.r(t),n.d(t,{CodeMirrorEditor:()=>Gi,CodeMirrorEditorFactory:()=>Vs,CodeMirrorMimeTypeService:()=>Gs,CodeMirrorSearchHighlighter:()=>Ys,EditorExtensionRegistry:()=>Ke,EditorLanguageRegistry:()=>Vi,EditorSearchProvider:()=>Qs,EditorThemeRegistry:()=>Hi,ExtensionsHandler:()=>Xe,IEditorExtensionRegistry:()=>Ks,IEditorLanguageRegistry:()=>Zs,IEditorThemeRegistry:()=>er,StateCommands:()=>ke,YRange:()=>Ve,YSyncConfig:()=>Ge,customTheme:()=>Oe,jupyterEditorTheme:()=>zi,jupyterHighlightStyle:()=>Fi,jupyterTheme:()=>Ji,parseMathIPython:()=>De,rulers:()=>Je,ySync:()=>Qe,ySyncAnnotation:()=>We,ySyncFacet:()=>Ue,ybinding:()=>Ye});var i=n(16693),s=n(29229),r=n(68466),a=n(21704);function o(e,t){return({state:n,dispatch:i})=>{if(n.readOnly)return!1;let s=e(t,n);return!!s&&(i(n.update(s)),!0)}}const l=o(p,0),c=o(m,0),h=o(((e,t)=>m(e,t,function(e){let t=[];for(let n of e.selection.ranges){let i=e.doc.lineAt(n.from),s=n.to<=i.to?i:e.doc.lineAt(n.to),r=t.length-1;r>=0&&t[r].to>i.from?t[r].to=s.to:t.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:s.to})}return t}(t))),0);function u(e,t){let n=e.languageDataAt("commentTokens",t);return n.length?n[0]:{}}const d=50;function m(e,t,n=t.selection.ranges){let i=n.map((e=>u(t,e.from).block));if(!i.every((e=>e)))return null;let s=n.map(((e,n)=>function(e,{open:t,close:n},i,s){let r,a,o=e.sliceDoc(i-d,i),l=e.sliceDoc(s,s+d),c=/\s*$/.exec(o)[0].length,h=/^\s*/.exec(l)[0].length,u=o.length-c;if(o.slice(u-t.length,u)==t&&l.slice(h,h+n.length)==n)return{open:{pos:i-c,margin:c&&1},close:{pos:s+h,margin:h&&1}};s-i<=2*d?r=a=e.sliceDoc(i,s):(r=e.sliceDoc(i,i+d),a=e.sliceDoc(s-d,s));let m=/^\s*/.exec(r)[0].length,p=/\s*$/.exec(a)[0].length,f=a.length-p-n.length;return r.slice(m,m+t.length)==t&&a.slice(f,f+n.length)==n?{open:{pos:i+m+t.length,margin:/\s/.test(r.charAt(m+t.length))?1:0},close:{pos:s-p-n.length,margin:/\s/.test(a.charAt(f-1))?1:0}}:null}(t,i[n],e.from,e.to)));if(2!=e&&!s.every((e=>e)))return{changes:t.changes(n.map(((e,t)=>s[t]?[]:[{from:e.from,insert:i[t].open+" "},{from:e.to,insert:" "+i[t].close}])))};if(1!=e&&s.some((e=>e))){let e=[];for(let t,n=0;n<s.length;n++)if(t=s[n]){let s=i[n],{open:r,close:a}=t;e.push({from:r.pos-s.open.length,to:r.pos+r.margin},{from:a.pos-a.margin,to:a.pos+s.close.length})}return{changes:e}}return null}function p(e,t,n=t.selection.ranges){let i=[],s=-1;for(let{from:e,to:r}of n){let n=i.length,a=1e9,o=u(t,e).line;if(o){for(let n=e;n<=r;){let l=t.doc.lineAt(n);if(l.from>s&&(e==r||r>l.from)){s=l.from;let e=/^\s*/.exec(l.text)[0].length,t=e==l.length,n=l.text.slice(e,e+o.length)==o?e:-1;e<l.text.length&&e<a&&(a=e),i.push({line:l,comment:n,token:o,indent:e,empty:t,single:!1})}n=l.to+1}if(a<1e9)for(let e=n;e<i.length;e++)i[e].indent<i[e].line.text.length&&(i[e].indent=a);i.length==n+1&&(i[n].single=!0)}}if(2!=e&&i.some((e=>e.comment<0&&(!e.empty||e.single)))){let e=[];for(let{line:t,token:n,indent:s,empty:r,single:a}of i)!a&&r||e.push({from:t.from+s,insert:n+" "});let n=t.changes(e);return{changes:n,selection:t.selection.map(n,1)}}if(1!=e&&i.some((e=>e.comment>=0))){let e=[];for(let{line:t,comment:n,token:s}of i)if(n>=0){let i=t.from+n,r=i+s.length;" "==t.text[r-t.from]&&r++,e.push({from:i,to:r})}return{changes:e}}return null}const f=i.Annotation.define(),g=i.Facet.define();class x{constructor(e,t,n,i,s){this.changes=e,this.effects=t,this.mapped=n,this.startSelection=i,this.selectionsAfter=s}setSelAfter(e){return new x(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,n;return{changes:null===(e=this.changes)||void 0===e?void 0:e.toJSON(),mapped:null===(t=this.mapped)||void 0===t?void 0:t.toJSON(),startSelection:null===(n=this.startSelection)||void 0===n?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map((e=>e.toJSON()))}}static fromJSON(e){return new x(e.changes&&i.ChangeSet.fromJSON(e.changes),[],e.mapped&&i.ChangeDesc.fromJSON(e.mapped),e.startSelection&&i.EditorSelection.fromJSON(e.startSelection),e.selectionsAfter.map(i.EditorSelection.fromJSON))}static fromTransaction(e,t){let n=_;for(let t of e.startState.facet(g)){let i=t(e);i.length&&(n=n.concat(i))}return!n.length&&e.changes.empty?null:new x(e.changes.invert(e.startState.doc),n,void 0,t||e.startState.selection,_)}static selection(e){return new x(void 0,_,void 0,void 0,e)}}function y(e,t,n,i){let s=t+1>n+20?t-n-1:0,r=e.slice(s,t);return r.push(i),r}function b(e,t){return e.length?t.length?e.concat(t):e:t}const _=[];function v(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function w(e,t){if(!e.length)return e;let n=e.length,i=_;for(;n;){let s=k(e[n-1],t,i);if(s.changes&&!s.changes.empty||s.effects.length){let t=e.slice(0,n);return t[n-1]=s,t}t=s.mapped,n--,i=s.selectionsAfter}return i.length?[x.selection(i)]:_}function k(e,t,n){let s=b(e.selectionsAfter.length?e.selectionsAfter.map((e=>e.map(t))):_,n);if(!e.changes)return x.selection(s);let r=e.changes.map(t),a=t.mapDesc(e.changes,!0),o=e.mapped?e.mapped.composeDesc(a):a;return new x(r,i.StateEffect.mapEffects(e.effects,t),o,e.startSelection.map(a),s)}const S=/^(input\.type|delete)($|\.)/;class C{constructor(e,t,n=0,i=void 0){this.done=e,this.undone=t,this.prevTime=n,this.prevUserEvent=i}isolate(){return this.prevTime?new C(this.done,this.undone):this}addChanges(e,t,n,i,s){let r=this.done,a=r[r.length-1];return r=a&&a.changes&&!a.changes.empty&&e.changes&&(!n||S.test(n))&&(!a.selectionsAfter.length&&t-this.prevTime<i.newGroupDelay&&i.joinToEvent(s,function(e,t){let n=[],i=!1;return e.iterChangedRanges(((e,t)=>n.push(e,t))),t.iterChangedRanges(((e,t,s,r)=>{for(let e=0;e<n.length;){let t=n[e++],a=n[e++];r>=t&&s<=a&&(i=!0)}})),i}(a.changes,e.changes))||"input.type.compose"==n)?y(r,r.length-1,i.minDepth,new x(e.changes.compose(a.changes),b(e.effects,a.effects),a.mapped,a.startSelection,_)):y(r,r.length,i.minDepth,e),new C(r,_,t,n)}addSelection(e,t,n,i){let s=this.done.length?this.done[this.done.length-1].selectionsAfter:_;return s.length>0&&t-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&(r=s[s.length-1],a=e,r.ranges.length==a.ranges.length&&0===r.ranges.filter(((e,t)=>e.empty!=a.ranges[t].empty)).length)?this:new C(function(e,t){if(e.length){let n=e[e.length-1],i=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-200));return i.length&&i[i.length-1].eq(t)?e:(i.push(t),y(e,e.length-1,1e9,n.setSelAfter(i)))}return[x.selection([t])]}(this.done,e),this.undone,t,n);var r,a}addMapping(e){return new C(w(this.done,e),w(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,n){let i=0==e?this.done:this.undone;if(0==i.length)return null;let s=i[i.length-1];if(n&&s.selectionsAfter.length)return t.update({selection:s.selectionsAfter[s.selectionsAfter.length-1],annotations:f.of({side:e,rest:v(i)}),userEvent:0==e?"select.undo":"select.redo",scrollIntoView:!0});if(s.changes){let n=1==i.length?_:i.slice(0,i.length-1);return s.mapped&&(n=w(n,s.mapped)),t.update({changes:s.changes,selection:s.startSelection,effects:s.effects,annotations:f.of({side:e,rest:n}),filter:!1,userEvent:0==e?"undo":"redo",scrollIntoView:!0})}return null}}function N(e,t){return i.EditorSelection.create(e.ranges.map(t),e.mainIndex)}function E(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function A({state:e,dispatch:t},n){let i=N(e.selection,n);return!i.eq(e.selection)&&(t(E(e,i)),!0)}function M(e,t){return i.EditorSelection.cursor(t?e.to:e.from)}function O(e,t){return A(e,(n=>n.empty?e.moveByChar(n,t):M(n,t)))}function j(e){return e.textDirectionAt(e.state.selection.main.head)==s.Direction.LTR}C.empty=new C(_,_);const T=e=>O(e,!j(e)),P=e=>O(e,j(e));function $(e,t){return A(e,(n=>n.empty?e.moveByGroup(n,t):M(n,t)))}function I(e,t,n){if(t.type.prop(n))return!0;let i=t.to-t.from;return i&&(i>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function R(e,t,n){let s,o,l=(0,r.qz)(e).resolveInner(t.head),c=n?a.md.closedBy:a.md.openedBy;for(let i=t.head;;){let t=n?l.childAfter(i):l.childBefore(i);if(!t)break;I(e,t,c)?l=t:i=n?t.to:t.from}return o=l.type.prop(c)&&(s=n?(0,r.Um)(e,l.from,1):(0,r.Um)(e,l.to,-1))&&s.matched?n?s.end.to:s.end.from:n?l.to:l.from,i.EditorSelection.cursor(o,n?-1:1)}function L(e,t){return A(e,(n=>{if(!n.empty)return M(n,t);let i=e.moveVertically(n,t);return i.head!=n.head?i:e.moveToLineBoundary(n,t)}))}const D=e=>L(e,!1),q=e=>L(e,!0);function B(e){let t,n=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,i=0,r=0;if(n){for(let t of e.state.facet(s.EditorView.scrollMargins)){let n=t(e);(null==n?void 0:n.top)&&(i=Math.max(null==n?void 0:n.top,i)),(null==n?void 0:n.bottom)&&(r=Math.max(null==n?void 0:n.bottom,r))}t=e.scrollDOM.clientHeight-i-r}else t=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:i,marginBottom:r,selfScroll:n,height:Math.max(e.defaultLineHeight,t-5)}}function z(e,t){let n,i=B(e),{state:r}=e,a=N(r.selection,(n=>n.empty?e.moveVertically(n,t,i.height):M(n,t)));if(a.eq(r.selection))return!1;if(i.selfScroll){let t=e.coordsAtPos(r.selection.main.head),o=e.scrollDOM.getBoundingClientRect(),l=o.top+i.marginTop,c=o.bottom-i.marginBottom;t&&t.top>l&&t.bottom<c&&(n=s.EditorView.scrollIntoView(a.main.head,{y:"start",yMargin:t.top-l}))}return e.dispatch(E(r,a),{effects:n}),!0}const F=e=>z(e,!1),J=e=>z(e,!0);function H(e,t,n){let s=e.lineBlockAt(t.head),r=e.moveToLineBoundary(t,n);if(r.head==t.head&&r.head!=(n?s.to:s.from)&&(r=e.moveToLineBoundary(t,n,!1)),!n&&r.head==s.from&&s.length){let n=/^\s*/.exec(e.state.sliceDoc(s.from,Math.min(s.from+100,s.to)))[0].length;n&&t.head!=s.from+n&&(r=i.EditorSelection.cursor(s.from+n))}return r}function V(e,t){let n=N(e.state.selection,(e=>{let n=t(e);return i.EditorSelection.range(e.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)}));return!n.eq(e.state.selection)&&(e.dispatch(E(e.state,n)),!0)}function G(e,t){return V(e,(n=>e.moveByChar(n,t)))}const U=e=>G(e,!j(e)),W=e=>G(e,j(e));function Q(e,t){return V(e,(n=>e.moveByGroup(n,t)))}function Y(e,t){return V(e,(n=>e.moveVertically(n,t)))}const X=e=>Y(e,!1),K=e=>Y(e,!0);function Z(e,t){return V(e,(n=>e.moveVertically(n,t,B(e).height)))}const ee=e=>Z(e,!1),te=e=>Z(e,!0),ne=({state:e,dispatch:t})=>(t(E(e,{anchor:0})),!0),ie=({state:e,dispatch:t})=>(t(E(e,{anchor:e.doc.length})),!0),se=({state:e,dispatch:t})=>(t(E(e,{anchor:e.selection.main.anchor,head:0})),!0),re=({state:e,dispatch:t})=>(t(E(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0);function ae(e,t){if(e.state.readOnly)return!1;let n="delete.selection",{state:r}=e,a=r.changeByRange((s=>{let{from:r,to:a}=s;if(r==a){let i=t(r);i<r?(n="delete.backward",i=oe(e,i,!1)):i>r&&(n="delete.forward",i=oe(e,i,!0)),r=Math.min(r,i),a=Math.max(a,i)}else r=oe(e,r,!1),a=oe(e,a,!0);return r==a?{range:s}:{changes:{from:r,to:a},range:i.EditorSelection.cursor(r)}}));return!a.changes.empty&&(e.dispatch(r.update(a,{scrollIntoView:!0,userEvent:n,effects:"delete.selection"==n?s.EditorView.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function oe(e,t,n){if(e instanceof s.EditorView)for(let i of e.state.facet(s.EditorView.atomicRanges).map((t=>t(e))))i.between(t,t,((e,i)=>{e<t&&i>t&&(t=n?i:e)}));return t}const le=(e,t)=>ae(e,(n=>{let s,a,{state:o}=e,l=o.doc.lineAt(n);if(!t&&n>l.from&&n<l.from+200&&!/[^ \t]/.test(s=l.text.slice(0,n-l.from))){if("\t"==s[s.length-1])return n-1;let e=(0,i.countColumn)(s,o.tabSize)%(0,r.y1)(o)||(0,r.y1)(o);for(let t=0;t<e&&" "==s[s.length-1-t];t++)n--;a=n}else a=(0,i.findClusterBreak)(l.text,n-l.from,t,t)+l.from,a==n&&l.number!=(t?o.doc.lines:1)&&(a+=t?1:-1);return a})),ce=e=>le(e,!1),he=e=>le(e,!0),ue=(e,t)=>ae(e,(n=>{let s=n,{state:r}=e,a=r.doc.lineAt(s),o=r.charCategorizer(s);for(let e=null;;){if(s==(t?a.to:a.from)){s==n&&a.number!=(t?r.doc.lines:1)&&(s+=t?1:-1);break}let l=(0,i.findClusterBreak)(a.text,s-a.from,t)+a.from,c=a.text.slice(Math.min(s,l)-a.from,Math.max(s,l)-a.from),h=o(c);if(null!=e&&h!=e)break;" "==c&&s==n||(e=h),s=l}return s})),de=e=>ue(e,!1),me=e=>ae(e,(t=>{let n=e.lineBlockAt(t).to;return t<n?n:Math.min(e.state.doc.length,t+1)}));function pe(e){let t=[],n=-1;for(let i of e.selection.ranges){let s=e.doc.lineAt(i.from),r=e.doc.lineAt(i.to);if(i.empty||i.to!=r.from||(r=e.doc.lineAt(i.to-1)),n>=s.number){let e=t[t.length-1];e.to=r.to,e.ranges.push(i)}else t.push({from:s.from,to:r.to,ranges:[i]});n=r.number+1}return t}function fe(e,t,n){if(e.readOnly)return!1;let s=[],r=[];for(let t of pe(e)){if(n?t.to==e.doc.length:0==t.from)continue;let a=e.doc.lineAt(n?t.to+1:t.from-1),o=a.length+1;if(n){s.push({from:t.to,to:a.to},{from:t.from,insert:a.text+e.lineBreak});for(let n of t.ranges)r.push(i.EditorSelection.range(Math.min(e.doc.length,n.anchor+o),Math.min(e.doc.length,n.head+o)))}else{s.push({from:a.from,to:t.from},{from:t.to,insert:e.lineBreak+a.text});for(let e of t.ranges)r.push(i.EditorSelection.range(e.anchor-o,e.head-o))}}return!!s.length&&(t(e.update({changes:s,scrollIntoView:!0,selection:i.EditorSelection.create(r,e.selection.mainIndex),userEvent:"move.line"})),!0)}function ge(e,t,n){if(e.readOnly)return!1;let i=[];for(let t of pe(e))n?i.push({from:t.from,insert:e.doc.slice(t.from,t.to)+e.lineBreak}):i.push({from:t.to,insert:e.lineBreak+e.doc.slice(t.from,t.to)});return t(e.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const xe=ye(!1);function ye(e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let s=t.changeByRange((n=>{let{from:s,to:o}=n,l=t.doc.lineAt(s),c=!e&&s==o&&function(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let n,i=(0,r.qz)(e).resolveInner(t),s=i.childBefore(t),o=i.childAfter(t);return s&&o&&s.to<=t&&o.from>=t&&(n=s.type.prop(a.md.closedBy))&&n.indexOf(o.name)>-1&&e.doc.lineAt(s.to).from==e.doc.lineAt(o.from).from?{from:s.to,to:o.from}:null}(t,s);e&&(s=o=(o<=l.to?l:t.doc.lineAt(o)).to);let h=new r.Gn(t,{simulateBreak:s,simulateDoubleBreak:!!c}),u=(0,r.K0)(h,s);for(null==u&&(u=/^\s*/.exec(t.doc.lineAt(s).text)[0].length);o<l.to&&/\s/.test(l.text[o-l.from]);)o++;c?({from:s,to:o}=c):s>l.from&&s<l.from+100&&!/\S/.test(l.text.slice(0,s))&&(s=l.from);let d=["",(0,r.SS)(t,u)];return c&&d.push((0,r.SS)(t,h.lineIndent(l.from,-1))),{changes:{from:s,to:o,insert:i.Text.of(d)},range:i.EditorSelection.cursor(s+1+d[1].length)}}));return n(t.update(s,{scrollIntoView:!0,userEvent:"input"})),!0}}function be(e,t){let n=-1;return e.changeByRange((s=>{let r=[];for(let i=s.from;i<=s.to;){let a=e.doc.lineAt(i);a.number>n&&(s.empty||s.to>a.from)&&(t(a,r,s),n=a.number),i=a.to+1}let a=e.changes(r);return{changes:r,range:i.EditorSelection.range(a.mapPos(s.anchor,1),a.mapPos(s.head,1))}}))}const _e=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(be(e,((t,n)=>{n.push({from:t.from,insert:e.facet(r.c)})})),{userEvent:"input.indent"})),!0),ve=({state:e,dispatch:t})=>!e.readOnly&&(t(e.update(be(e,((t,n)=>{let s=/^\s*/.exec(t.text)[0];if(!s)return;let a=(0,i.countColumn)(s,e.tabSize),o=0,l=(0,r.SS)(e,Math.max(0,a-(0,r.y1)(e)));for(;o<s.length&&o<l.length&&s.charCodeAt(o)==l.charCodeAt(o);)o++;n.push({from:t.from+o,to:t.from+s.length,insert:l.slice(o)})})),{userEvent:"delete.dedent"})),!0),we=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e=>A(e,(t=>R(e.state,t,!j(e)))),shift:e=>V(e,(t=>R(e.state,t,!j(e))))},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:e=>A(e,(t=>R(e.state,t,j(e)))),shift:e=>V(e,(t=>R(e.state,t,j(e))))},{key:"Alt-ArrowUp",run:({state:e,dispatch:t})=>fe(e,t,!1)},{key:"Shift-Alt-ArrowUp",run:({state:e,dispatch:t})=>ge(e,t,!1)},{key:"Alt-ArrowDown",run:({state:e,dispatch:t})=>fe(e,t,!0)},{key:"Shift-Alt-ArrowDown",run:({state:e,dispatch:t})=>ge(e,t,!0)},{key:"Escape",run:({state:e,dispatch:t})=>{let n=e.selection,s=null;return n.ranges.length>1?s=i.EditorSelection.create([n.main]):n.main.empty||(s=i.EditorSelection.create([i.EditorSelection.cursor(n.main.head)])),!!s&&(t(E(e,s)),!0)}},{key:"Mod-Enter",run:ye(!0)},{key:"Alt-l",mac:"Ctrl-l",run:({state:e,dispatch:t})=>{let n=pe(e).map((({from:t,to:n})=>i.EditorSelection.range(t,Math.min(n+1,e.doc.length))));return t(e.update({selection:i.EditorSelection.create(n),userEvent:"select"})),!0}},{key:"Mod-i",run:({state:e,dispatch:t})=>{let n=N(e.selection,(t=>{var n;let s=(0,r.qz)(e).resolveInner(t.head,1);for(;!(s.from<t.from&&s.to>=t.to||s.to>t.to&&s.from<=t.from)&&(null===(n=s.parent)||void 0===n?void 0:n.parent);)s=s.parent;return i.EditorSelection.range(s.to,s.from)}));return t(E(e,n)),!0},preventDefault:!0},{key:"Mod-[",run:ve},{key:"Mod-]",run:_e},{key:"Mod-Alt-\\",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=Object.create(null),i=new r.Gn(e,{overrideIndentation:e=>{let t=n[e];return null==t?-1:t}}),s=be(e,((t,s,a)=>{let o=(0,r.K0)(i,t.from);if(null==o)return;/\S/.test(t.text)||(o=0);let l=/^\s*/.exec(t.text)[0],c=(0,r.SS)(e,o);(l!=c||a.from<t.from+l.length)&&(n[t.from]=o,s.push({from:t.from,to:t.from+l.length,insert:c}))}));return s.changes.empty||t(e.update(s,{userEvent:"indent"})),!0}},{key:"Shift-Mod-k",run:e=>{if(e.state.readOnly)return!1;let{state:t}=e,n=t.changes(pe(t).map((({from:e,to:n})=>(e>0?e--:n<t.doc.length&&n++,{from:e,to:n})))),i=N(t.selection,(t=>e.moveVertically(t,!0))).map(n);return e.dispatch({changes:n,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0}},{key:"Shift-Mod-\\",run:({state:e,dispatch:t})=>function(e,t,n){let s=!1,a=N(e.selection,(t=>{let a=(0,r.Um)(e,t.head,-1)||(0,r.Um)(e,t.head,1)||t.head>0&&(0,r.Um)(e,t.head-1,1)||t.head<e.doc.length&&(0,r.Um)(e,t.head+1,-1);if(!a||!a.end)return t;s=!0;let o=a.start.from==t.head?a.end.to:a.end.from;return n?i.EditorSelection.range(t.anchor,o):i.EditorSelection.cursor(o)}));return!!s&&(t(E(e,a)),!0)}(e,t,!1)},{key:"Mod-/",run:e=>{let{state:t}=e,n=t.doc.lineAt(t.selection.main.from),i=u(e.state,n.from);return i.line?l(e):!!i.block&&h(e)}},{key:"Alt-A",run:c}].concat([{key:"ArrowLeft",run:T,shift:U,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:e=>$(e,!j(e)),shift:e=>Q(e,!j(e)),preventDefault:!0},{mac:"Cmd-ArrowLeft",run:e=>A(e,(t=>H(e,t,!j(e)))),shift:e=>V(e,(t=>H(e,t,!j(e)))),preventDefault:!0},{key:"ArrowRight",run:P,shift:W,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:e=>$(e,j(e)),shift:e=>Q(e,j(e)),preventDefault:!0},{mac:"Cmd-ArrowRight",run:e=>A(e,(t=>H(e,t,j(e)))),shift:e=>V(e,(t=>H(e,t,j(e)))),preventDefault:!0},{key:"ArrowUp",run:D,shift:X,preventDefault:!0},{mac:"Cmd-ArrowUp",run:ne,shift:se},{mac:"Ctrl-ArrowUp",run:F,shift:ee},{key:"ArrowDown",run:q,shift:K,preventDefault:!0},{mac:"Cmd-ArrowDown",run:ie,shift:re},{mac:"Ctrl-ArrowDown",run:J,shift:te},{key:"PageUp",run:F,shift:ee},{key:"PageDown",run:J,shift:te},{key:"Home",run:e=>A(e,(t=>H(e,t,!1))),shift:e=>V(e,(t=>H(e,t,!1))),preventDefault:!0},{key:"Mod-Home",run:ne,shift:se},{key:"End",run:e=>A(e,(t=>H(e,t,!0))),shift:e=>V(e,(t=>H(e,t,!0))),preventDefault:!0},{key:"Mod-End",run:ie,shift:re},{key:"Enter",run:xe},{key:"Mod-a",run:({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0)},{key:"Backspace",run:ce,shift:ce},{key:"Delete",run:he},{key:"Mod-Backspace",mac:"Alt-Backspace",run:de},{key:"Mod-Delete",mac:"Alt-Delete",run:e=>ue(e,!0)},{mac:"Mod-Backspace",run:e=>ae(e,(t=>{let n=e.lineBlockAt(t).from;return t>n?n:Math.max(0,t-1)}))},{mac:"Mod-Delete",run:me}].concat([{key:"Ctrl-b",run:T,shift:U,preventDefault:!0},{key:"Ctrl-f",run:P,shift:W},{key:"Ctrl-p",run:D,shift:X},{key:"Ctrl-n",run:q,shift:K},{key:"Ctrl-a",run:e=>A(e,(t=>i.EditorSelection.cursor(e.lineBlockAt(t.head).from,1))),shift:e=>V(e,(t=>i.EditorSelection.cursor(e.lineBlockAt(t.head).from)))},{key:"Ctrl-e",run:e=>A(e,(t=>i.EditorSelection.cursor(e.lineBlockAt(t.head).to,-1))),shift:e=>V(e,(t=>i.EditorSelection.cursor(e.lineBlockAt(t.head).to)))},{key:"Ctrl-d",run:he},{key:"Ctrl-h",run:ce},{key:"Ctrl-k",run:me},{key:"Ctrl-Alt-h",run:de},{key:"Ctrl-o",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange((e=>({changes:{from:e.from,to:e.to,insert:i.Text.of(["",""])},range:i.EditorSelection.cursor(e.from)})));return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}},{key:"Ctrl-t",run:({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange((t=>{if(!t.empty||0==t.from||t.from==e.doc.length)return{range:t};let n=t.from,s=e.doc.lineAt(n),r=n==s.from?n-1:(0,i.findClusterBreak)(s.text,n-s.from,!1)+s.from,a=n==s.to?n+1:(0,i.findClusterBreak)(s.text,n-s.from,!0)+s.from;return{changes:{from:r,to:a,insert:e.doc.slice(n,a).append(e.doc.slice(r,n))},range:i.EditorSelection.cursor(a)}}));return!n.changes.empty&&(t(e.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)}},{key:"Ctrl-v",run:J}].map((e=>({mac:e.key,run:e.run,shift:e.shift})))));var ke;!function(e){e.indentMoreOrInsertTab=function(e){const t={state:e.state,dispatch:e.dispatch},n=e.state.selection.main.from;if(n!=e.state.selection.main.to)return _e(t);const i=e.state.doc.lineAt(n),s=e.state.doc.slice(i.from,n).toString();return/^\s*$/.test(s)?_e(t):(({state:e,dispatch:t})=>e.selection.ranges.some((e=>!e.empty))?_e({state:e,dispatch:t}):(t(e.update(e.replaceSelection("\t"),{scrollIntoView:!0,userEvent:"input"})),!0))(t)}}(ke||(ke={}));var Se=n(50558),Ce=n(53968),Ne=n(9e3),Ee=n(77352);const Ae=i.Facet.define({combine:e=>(0,i.combineConfig)(e,{fontFamily:null,fontSize:null,lineHeight:null},{fontFamily:(e,t)=>null!=e?e:t,fontSize:(e,t)=>null!=e?e:t,lineHeight:(e,t)=>null!=e?e:t})});function Me(e){const{fontFamily:t,fontSize:n,lineHeight:i}=e.state.facet(Ae);let s="";return n&&(s+=`font-size: ${n}px !important;`),t&&(s+=`font-family: ${t} !important;`),i&&(s+=`line-height: ${i.toString()} !important`),{style:s}}function Oe(e){return[Ae.of(e),s.EditorView.editorAttributes.of(Me)]}var je=n(30262);const Te="InlineMathDollar",Pe="InlineMathBracket",$e="BlockMathDollar",Ie="BlockMathBracket",Re={[Te]:1,[Pe]:3,[$e]:2,[Ie]:3},Le=Object.keys(Re).reduce(((e,t)=>(e[t]={mark:`${t}Mark`,resolve:t},e)),{});function De(e){const t=new Array;return Object.keys(Re).forEach((e=>{t.push({name:e,style:je.pJ.emphasis},{name:`${e}Mark`,style:je.pJ.processingInstruction})})),{defineNodes:t,parseInline:[{name:$e,parse:(e,t,n)=>36!=t||36!=e.char(n+1)?-1:e.addDelimiter(Le[$e],n,n+Re[$e],!0,!0)},{name:Te,parse:(e,t,n)=>36!=t||36==e.char(n+1)?-1:e.addDelimiter(Le[Te],n,n+Re[Te],!0,!0)},{name:Pe,before:"Escape",parse:(e,t,n)=>92==t&&92==e.char(n+1)&&[40,41].includes(e.char(n+2))?e.addDelimiter(Le[Pe],n,n+Re[Pe],40==e.char(n+2),41==e.char(n+2)):-1},{name:Ie,before:"Escape",parse:(e,t,n)=>92==t&&92==e.char(n+1)&&[91,93].includes(e.char(n+2))?e.addDelimiter(Le[Ie],n,n+Re[Ie],91==e.char(n+2),93==e.char(n+2)):-1}],wrap:e?(0,a.FE)(((t,n)=>{const i=Re[t.type.name];return i?{parser:e,overlay:[{from:t.from+i,to:t.to-i}]}:null})):void 0}}const qe="cm-rulers",Be=s.EditorView.baseTheme({[`.${qe}`]:{borderRight:"1px dotted gray",opacity:.7}}),ze=i.Facet.define({combine:e=>e.reduce(((e,t)=>e.concat(t.filter(((n,i)=>!e.includes(n)&&i==t.lastIndexOf(n))))),[])}),Fe=s.ViewPlugin.fromClass(class{constructor(e){this.rulersContainer=e.dom.appendChild(document.createElement("div")),this.rulersContainer.style.cssText="\n                position: absolute;\n                left: 0;\n                top: 0;\n                width: 100%;\n                height: 100%;\n                pointer-events: none;\n                overflow: hidden;\n            ";const t=e.defaultCharacterWidth,n=e.state.facet(ze);this.rulers=n.map((e=>{const n=this.rulersContainer.appendChild(document.createElement("div"));return n.classList.add(qe),n.style.cssText=`\n                position: absolute;\n                left: ${e*t}px;\n                height: 100%;\n            `,n.style.width="6px",n}))}update(e){const t=e.view.state.facet(ze);if(e.viewportChanged||!Se.JSONExt.deepEqual(t,e.startState.facet(ze))){const n=e.view.defaultCharacterWidth;this.rulers.forEach(((e,i)=>{e.style.left=t[i]*n+"px"}))}}destroy(){this.rulers.forEach((e=>{e.remove()})),this.rulersContainer.remove()}});function Je(e){return[Be,ze.of(e),Fe]}var He=n(70040);class Ve{constructor(e,t){this.yanchor=e,this.yhead=t}toJSON(){return{yanchor:(0,He.relativePositionToJSON)(this.yanchor),yhead:(0,He.relativePositionToJSON)(this.yhead)}}static fromJSON(e){return new Ve((0,He.createRelativePositionFromJSON)(e.yanchor),(0,He.createRelativePositionFromJSON)(e.yhead))}}class Ge{constructor(e){this.ytext=e}toYPos(e,t=0){return(0,He.createRelativePositionFromTypeIndex)(this.ytext,e,t)}fromYPos(e){const t=(0,He.createAbsolutePositionFromRelativePosition)((0,He.createRelativePositionFromJSON)(e),this.ytext.doc);if(null==t||t.type!==this.ytext)throw new Error("[y-codemirror] The position you want to retrieve was created by a different document");return{pos:t.index,assoc:t.assoc}}toYRange(e){const t=e.assoc,n=this.toYPos(e.anchor,t),i=this.toYPos(e.head,t);return new Ve(n,i)}fromYRange(e){const t=this.fromYPos(e.yanchor),n=this.fromYPos(e.yhead);return t.pos===n.pos?i.EditorSelection.cursor(n.pos,n.assoc):i.EditorSelection.range(t.pos,n.pos)}}const Ue=i.Facet.define({combine:e=>e[e.length-1]}),We=i.Annotation.define(),Qe=s.ViewPlugin.fromClass(class{constructor(e){this.conf=e.state.facet(Ue),this._observer=(t,n)=>{var i;if(n.origin!==this.conf){const n=t.delta,s=[];let r=0;for(let e=0;e<n.length;e++){const t=n[e];null!=t.insert?s.push({from:r,to:r,insert:t.insert}):null!=t.delete?(s.push({from:r,to:r+t.delete,insert:""}),r+=t.delete):r+=null!==(i=t.retain)&&void 0!==i?i:0}e.dispatch({changes:s,annotations:[We.of(this.conf)]})}},this._ytext=this.conf.ytext,this._ytext.observe(this._observer)}update(e){if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(We)===this.conf)return;const t=this.conf.ytext;t.doc.transact((()=>{let n=0;e.changes.iterChanges(((e,i,s,r,a)=>{const o=a.sliceString(0,a.length,"\n");e!==i&&t.delete(e+n,i-e),o.length>0&&t.insert(e+n,o),n+=o.length-(i-e)}))}),this.conf)}destroy(){this._ytext.unobserve(this._observer)}});function Ye({ytext:e,undoManager:t}){const n=new Ge(e);return[Ue.of(n),Qe,t?s.ViewPlugin.define((()=>(t.addTrackedOrigin(n),{destroy:()=>{t.removeTrackedOrigin(n)}}))):[]]}class Xe{constructor({baseConfiguration:e,config:t,defaultExtensions:n}={}){this._configChanged=new Ce.Signal(this),this._disposed=new Ce.Signal(this),this._isDisposed=!1,this._immutables=new Set,this._baseConfig=null!=e?e:{},this._config=null!=t?t:{},this._configurableBuilderMap=new Map(n);const i=Object.keys(this._config).concat(Object.keys(this._baseConfig));this._immutables=new Set([...this._configurableBuilderMap.keys()].filter((e=>!i.includes(e))))}get configChanged(){return this._configChanged}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),Ce.Signal.clearData(this))}getOption(e){var t;return null!==(t=this._config[e])&&void 0!==t?t:this._baseConfig[e]}hasOption(e){return Object.keys(this._config).includes(e)||Object.keys(this._baseConfig).includes(e)}setOption(e,t){this._config[e]!==t&&(this._config[e]=t,this._configChanged.emit({[e]:t}))}setBaseOptions(e){const t=this._getChangedOptions(e,this._baseConfig);if(t.length>0){this._baseConfig=e;const n=Object.keys(this._config),i=t.filter((e=>!n.includes(e)));i.length>0&&this._configChanged.emit(i.reduce(((e,t)=>(e[t]=this._baseConfig[t],e)),{}))}}setOptions(e){const t=this._getChangedOptions(e,this._config);t.length>0&&(this._config={...e},this._configChanged.emit(t.reduce(((e,t)=>{var n;return e[t]=null!==(n=this._config[t])&&void 0!==n?n:this._baseConfig[t],e}),{})))}reconfigureExtension(e,t,n){const i=this.getEffect(e.state,t,n);i&&e.dispatch({effects:[i]})}reconfigureExtensions(e,t){const n=Object.keys(t).filter((e=>this.has(e))).map((n=>this.getEffect(e.state,n,t[n])));e.dispatch({effects:n.filter((e=>null!==e))})}injectExtension(e,t){e.dispatch({effects:i.StateEffect.appendConfig.of(t)})}getInitialExtensions(){const e={...this._baseConfig,...this._config},t=[...this._immutables].map((e=>{var t;return null===(t=this.get(e))||void 0===t?void 0:t.instance(void 0)})).filter((e=>e));for(const n of Object.keys(e)){const i=this.get(n);if(i){const s=e[n];t.push(i.instance(s))}}return t}get(e){return this._configurableBuilderMap.get(e)}has(e){return this._configurableBuilderMap.has(e)}getEffect(e,t,n){var i;const s=this.get(t);return null!==(i=null==s?void 0:s.reconfigure(n))&&void 0!==i?i:null}_getChangedOptions(e,t){const n=new Array,i=new Array;for(const[s,r]of Object.entries(e))i.push(s),t[s]!==r&&n.push(s);return n.push(...Object.keys(t).filter((e=>!i.includes(e)))),n}}class Ke{constructor(){this.configurationBuilder=new Map,this.configurationSchema={},this.defaultOptions={},this.handlers=new Set,this.immutableExtensions=new Set,this._baseConfiguration={}}get baseConfiguration(){return{...this.defaultOptions,...this._baseConfiguration}}set baseConfiguration(e){if(!Se.JSONExt.deepEqual(e,this._baseConfiguration)){this._baseConfiguration=e;for(const e of this.handlers)e.setBaseOptions(this.baseConfiguration)}}get defaultConfiguration(){return Object.freeze({...this.defaultOptions})}get settingsSchema(){return Object.freeze(Se.JSONExt.deepCopy(this.configurationSchema))}addExtension(e){var t;if(this.configurationBuilder.has(e.name))throw new Error(`Extension named ${e.name} is already registered.`);this.configurationBuilder.set(e.name,e),void 0!==e.default&&(this.defaultOptions[e.name]=e.default),e.schema&&(this.configurationSchema[e.name]={default:null!==(t=e.default)&&void 0!==t?t:null,...e.schema},this.defaultOptions[e.name]=this.configurationSchema[e.name].default)}createNew(e){const t=new Array;for(const[n,i]of this.configurationBuilder.entries()){const s=i.factory(e);s&&t.push([n,s])}const n=new Xe({baseConfiguration:this.baseConfiguration,config:e.config,defaultExtensions:t});return this.handlers.add(n),n.disposed.connect((()=>{this.handlers.delete(n)})),n}}!function(e){class t{constructor(e){this._compartment=new i.Compartment,this._builder=e}instance(e){return this._compartment.of(this._builder(e))}reconfigure(e){return this._compartment.reconfigure(this._builder(e))}}class n{constructor(e){this._extension=e}instance(){return this._extension}reconfigure(){return null}}function a(e){return new t(e)}function o(e,n=[]){return new t((t=>t?e:n))}e.createConfigurableExtension=a,e.createConditionalExtension=o,e.createImmutableExtension=function(e){return new n(e)},e.getDefaultExtensions=function(e={}){const{themes:t,translator:n}=e,l=(null!=n?n:Ee.nullTranslator).load("jupyterlab"),c=[Object.freeze({name:"autoClosingBrackets",default:!1,factory:()=>o((0,Ne.vQ)()),schema:{type:"boolean",title:l.__("Auto Closing Brackets")}}),Object.freeze({name:"codeFolding",default:!1,factory:()=>o((0,r.mi)()),schema:{type:"boolean",title:l.__("Code Folding")}}),Object.freeze({name:"cursorBlinkRate",default:1200,factory:()=>a((e=>(0,s.drawSelection)({cursorBlinkRate:e}))),schema:{type:"number",title:l.__("Cursor blinking rate"),description:l.__("Half-period in milliseconds used for cursor blinking. The default blink rate is 1200ms. By setting this to zero, blinking can be disabled.")}}),Object.freeze({name:"highlightActiveLine",default:!1,factory:()=>o((0,s.highlightActiveLine)()),schema:{type:"boolean",title:l.__("Highlight the active line")}}),Object.freeze({name:"highlightTrailingWhitespace",default:!1,factory:()=>o((0,s.highlightTrailingWhitespace)()),schema:{type:"boolean",title:l.__("Highlight trailing white spaces")}}),Object.freeze({name:"highlightWhitespace",default:!1,factory:()=>o((0,s.highlightWhitespace)()),schema:{type:"boolean",title:l.__("Highlight white spaces")}}),Object.freeze({name:"indentUnit",default:"4",factory:()=>a((e=>"Tab"==e?r.c.of("\t"):r.c.of(" ".repeat(parseInt(e,10))))),schema:{type:"string",title:l.__("Indentation unit"),description:l.__("The indentation is a `Tab` or the number of spaces. This defaults to 4 spaces."),enum:["Tab","1","2","4","8"]}}),Object.freeze({name:"keymap",default:[...we,{key:"Tab",run:ke.indentMoreOrInsertTab,shift:ve}],factory:()=>a((e=>s.keymap.of(e)))}),Object.freeze({name:"lineNumbers",default:!0,factory:()=>o((0,s.lineNumbers)()),schema:{type:"boolean",title:l.__("Line Numbers")}}),Object.freeze({name:"lineWrap",factory:()=>o(s.EditorView.lineWrapping),default:!0,schema:{type:"boolean",title:l.__("Line Wrap")}}),Object.freeze({name:"matchBrackets",default:!0,factory:()=>o((0,r.n$)()),schema:{type:"boolean",title:l.__("Match Brackets")}}),Object.freeze({name:"rectangularSelection",default:!0,factory:()=>o([(0,s.rectangularSelection)(),(0,s.crosshairCursor)()]),schema:{type:"boolean",title:l.__("Rectangular selection"),description:l.__("Rectangular (block) selection can be created by dragging the mouse pointer while holding the left mouse button and the Alt key. When the Alt key is pressed, a crosshair cursor will appear, indicating that the rectangular selection mode is active.")}}),Object.freeze({name:"readOnly",default:!1,factory:()=>a((e=>[i.EditorState.readOnly.of(e),e?s.EditorView.editorAttributes.of({class:"jp-mod-readOnly"}):[]]))}),Object.freeze({name:"rulers",default:[],factory:()=>a((e=>e.length>0?Je(e):[])),schema:{type:"array",title:l.__("Rulers"),items:{type:"number",minimum:0}}}),Object.freeze({name:"scrollPastEnd",default:!1,factory:e=>e.inline?null:o((0,s.scrollPastEnd)())}),Object.freeze({name:"smartIndent",default:!0,factory:()=>o((0,r.nY)()),schema:{type:"boolean",title:l.__("Smart Indentation")}}),Object.freeze({name:"tabSize",default:4,factory:()=>a((e=>i.EditorState.tabSize.of(e))),schema:{type:"number",title:l.__("Tab size")}}),Object.freeze({name:"allowMultipleSelections",default:!0,factory:()=>a((e=>i.EditorState.allowMultipleSelections.of(e))),schema:{type:"boolean",title:l.__("Multiple selections")}}),Object.freeze({name:"customStyles",factory:()=>a((e=>Oe(e))),default:{fontFamily:null,fontSize:null,lineHeight:null},schema:{title:l.__("Custom editor styles"),type:"object",properties:{fontFamily:{type:["string","null"],title:l.__("Font Family")},fontSize:{type:["number","null"],minimum:1,maximum:100,title:l.__("Font Size")},lineHeight:{type:["number","null"],title:l.__("Line Height")}},additionalProperties:!1}})];return t&&c.push(Object.freeze({name:"theme",default:"jupyter",factory:()=>a((e=>t.getTheme(e))),schema:{type:"string",title:l.__("Theme"),description:l.__("CodeMirror theme")}})),n&&c.push(Object.freeze({name:"translation",default:{"Control character":l.__("Control character"),"Selection deleted":l.__("Selection deleted"),"Folded lines":l.__("Folded lines"),"Unfolded lines":l.__("Unfolded lines"),to:l.__("to"),"folded code":l.__("folded code"),unfold:l.__("unfold"),"Fold line":l.__("Fold line"),"Unfold line":l.__("Unfold line"),"Go to line":l.__("Go to line"),go:l.__("go"),Find:l.__("Find"),Replace:l.__("Replace"),next:l.__("next"),previous:l.__("previous"),all:l.__("all"),"match case":l.__("match case"),replace:l.__("replace"),"replace all":l.__("replace all"),close:l.__("close"),"current match":l.__("current match"),"replaced $ matches":l.__("replaced $ matches"),"replaced match on line $":l.__("replaced match on line $"),"on line":l.__("on line"),Completions:l.__("Completions"),Diagnostics:l.__("Diagnostics"),"No diagnostics":l.__("No diagnostics")},factory:()=>a((e=>i.EditorState.phrases.of(e)))})),c}}(Ke||(Ke={}));var Ze=n(32293),et=n(55455),tt=n(56575),nt=n(34406);class it{constructor(e){this.start=e}}class st extends it{constructor(e,t,n,i,s,r,a,o,l,c,h,u,d,m,p){super(e),this.rules=t,this.topRules=n,this.tokens=i,this.localTokens=s,this.context=r,this.externalTokens=a,this.externalSpecializers=o,this.externalPropSources=l,this.precedences=c,this.mainSkip=h,this.scopedSkip=u,this.dialects=d,this.externalProps=m,this.autoDelim=p}toString(){return Object.values(this.rules).join("\n")}}class rt extends it{constructor(e,t,n,i,s){super(e),this.id=t,this.props=n,this.params=i,this.expr=s}toString(){return this.id.name+(this.params.length?`<${this.params.join()}>`:"")+" -> "+this.expr}}class at extends it{constructor(e,t){super(e),this.items=t}}class ot extends it{constructor(e,t){super(e),this.items=t}}class lt extends it{constructor(e,t,n){super(e),this.a=t,this.b=n}}class ct extends it{constructor(e,t,n,i,s){super(e),this.precedences=t,this.conflicts=n,this.rules=i,this.literals=s}}class ht extends it{constructor(e,t,n,i){super(e),this.precedences=t,this.rules=n,this.fallback=i}}class ut extends it{constructor(e,t,n){super(e),this.literal=t,this.props=n}}class dt extends it{constructor(e,t,n){super(e),this.id=t,this.source=n}}class mt extends it{constructor(e,t,n,i){super(e),this.id=t,this.source=n,this.tokens=i}}class pt extends it{constructor(e,t,n,i,s,r){super(e),this.type=t,this.token=n,this.id=i,this.source=s,this.tokens=r}}class ft extends it{constructor(e,t,n){super(e),this.id=t,this.source=n}}class gt extends it{constructor(e,t,n,i){super(e),this.id=t,this.externalID=n,this.source=i}}class xt extends it{constructor(e,t){super(e),this.name=t}toString(){return this.name}}class yt extends it{walk(e){return e(this)}eq(e){return!1}}yt.prototype.prec=10;class bt extends yt{constructor(e,t,n){super(e),this.id=t,this.args=n}toString(){return this.id.name+(this.args.length?`<${this.args.join()}>`:"")}eq(e){return this.id.name==e.id.name&&Pt(this.args,e.args)}walk(e){let t=Mt(this.args,e);return e(t==this.args?this:new bt(this.start,this.id,t))}}class _t extends yt{constructor(e,t,n,i,s){super(e),this.type=t,this.props=n,this.token=i,this.content=s}toString(){return`@${this.type}[${this.props.join(",")}]<${this.token}, ${this.content}>`}eq(e){return this.type==e.type&&$t.eqProps(this.props,e.props)&&Tt(this.token,e.token)&&Tt(this.content,e.content)}walk(e){let t=this.token.walk(e),n=this.content.walk(e);return e(t==this.token&&n==this.content?this:new _t(this.start,this.type,this.props,t,n))}}class vt extends yt{constructor(e,t){super(e),this.rule=t}toString(){let e=this.rule;return`${e.id}${e.props.length?`[${e.props.join(",")}]`:""} { ${e.expr} }`}eq(e){let t=this.rule,n=e.rule;return Tt(t.expr,n.expr)&&t.id.name==n.id.name&&$t.eqProps(t.props,n.props)}walk(e){let t=this.rule,n=t.expr.walk(e);return e(n==t.expr?this:new vt(this.start,new rt(t.start,t.id,t.props,[],n)))}}class wt extends yt{constructor(e,t){super(e),this.exprs=t}toString(){return this.exprs.map((e=>Rt(e,this))).join(" | ")}eq(e){return Pt(this.exprs,e.exprs)}walk(e){let t=Mt(this.exprs,e);return e(t==this.exprs?this:new wt(this.start,t))}}wt.prototype.prec=1;class kt extends yt{constructor(e,t,n,i=!1){super(e),this.exprs=t,this.markers=n,this.empty=i}toString(){return this.empty?"()":this.exprs.map((e=>Rt(e,this))).join(" ")}eq(e){return Pt(this.exprs,e.exprs)&&this.markers.every(((t,n)=>{let i=e.markers[n];return t.length==i.length&&t.every(((e,t)=>e.eq(i[t])))}))}walk(e){let t=Mt(this.exprs,e);return e(t==this.exprs?this:new kt(this.start,t,this.markers,this.empty&&!t.length))}}kt.prototype.prec=2;class St extends it{constructor(e,t,n){super(e),this.id=t,this.type=n}toString(){return("ambig"==this.type?"~":"!")+this.id.name}eq(e){return this.id.name==e.id.name&&this.type==e.type}}class Ct extends yt{constructor(e,t,n){super(e),this.expr=t,this.kind=n}toString(){return Rt(this.expr,this)+this.kind}eq(e){return Tt(this.expr,e.expr)&&this.kind==e.kind}walk(e){let t=this.expr.walk(e);return e(t==this.expr?this:new Ct(this.start,t,this.kind))}}Ct.prototype.prec=3;class Nt extends yt{constructor(e,t){super(e),this.value=t}toString(){return JSON.stringify(this.value)}eq(e){return this.value==e.value}}class Et extends yt{constructor(e,t,n){super(e),this.ranges=t,this.inverted=n}toString(){return`[${this.inverted?"^":""}${this.ranges.map((([e,t])=>String.fromCodePoint(e)+(t==e+1?"":"-"+String.fromCodePoint(t))))}]`}eq(e){return this.inverted==e.inverted&&this.ranges.length==e.ranges.length&&this.ranges.every((([t,n],i)=>{let[s,r]=e.ranges[i];return t==s&&n==r}))}}class At extends yt{constructor(e){super(e)}toString(){return"_"}eq(){return!0}}function Mt(e,t){let n=null;for(let i=0;i<e.length;i++){let s=e[i].walk(t);s==e[i]||n||(n=e.slice(0,i)),n&&n.push(s)}return n||e}const Ot={asciiLetter:[[65,91],[97,123]],asciiLowercase:[[97,123]],asciiUppercase:[[65,91]],digit:[[48,58]],whitespace:[[9,14],[32,33],[133,134],[160,161],[5760,5761],[8192,8203],[8232,8234],[8239,8240],[8287,8288],[12288,12289]],eof:[[65535,65535]]};class jt extends yt{constructor(e,t){super(e),this.type=t}toString(){return"@"+this.type}eq(e){return this.type==e.type}}function Tt(e,t){return e.constructor==t.constructor&&e.eq(t)}function Pt(e,t){return e.length==t.length&&e.every(((e,n)=>Tt(e,t[n])))}class $t extends it{constructor(e,t,n,i){super(e),this.at=t,this.name=n,this.value=i}eq(e){return this.name==e.name&&this.value.length==e.value.length&&this.value.every(((t,n)=>t.value==e.value[n].value&&t.name==e.value[n].name))}toString(){let e=(this.at?"@":"")+this.name;if(this.value.length){e+="=";for(let{name:t,value:n}of this.value)e+=t?`{${t}}`:/[^\w-]/.test(n)?JSON.stringify(n):n}return e}static eqProps(e,t){return e.length==t.length&&e.every(((e,n)=>e.eq(t[n])))}}class It extends it{constructor(e,t,n){super(e),this.value=t,this.name=n}}function Rt(e,t){return e.prec<t.prec?"("+e.toString()+")":e.toString()}class Lt extends Error{}function Dt(e){for(let t in e)return!0;return!1}let qt=0;class Bt{constructor(e,t,n,i={}){this.name=e,this.flags=t,this.nodeName=n,this.props=i,this.hash=++qt,this.id=-1,this.rules=[]}toString(){return this.name}get nodeType(){return this.top||null!=this.nodeName||Dt(this.props)||this.repeated}get terminal(){return(1&this.flags)>0}get eof(){return(4&this.flags)>0}get error(){return"error"in this.props}get top(){return(2&this.flags)>0}get interesting(){return this.flags>0||null!=this.nodeName}get repeated(){return(16&this.flags)>0}set preserve(e){this.flags=e?8|this.flags:-9&this.flags}get preserve(){return(8&this.flags)>0}set inline(e){this.flags=e?32|this.flags:-33&this.flags}get inline(){return(32&this.flags)>0}cmp(e){return this.hash-e.hash}}class zt{constructor(){this.terms=[],this.names=Object.create(null),this.tops=[],this.eof=this.term("␄",null,5),this.error=this.term("⚠","⚠",8)}term(e,t,n=0,i={}){let s=new Bt(e,n,t,i);return this.terms.push(s),this.names[e]=s,s}makeTop(e,t){const n=this.term("@top",e,2,t);return this.tops.push(n),n}makeTerminal(e,t,n={}){return this.term(e,t,1,n)}makeNonTerminal(e,t,n={}){return this.term(e,t,0,n)}makeRepeat(e){return this.term(e,null,16)}uniqueName(e){for(let t=0;;t++){let n=t?`${e}-${t}`:e;if(!this.names[n])return n}}finish(e){for(let t of e)t.name.rules.push(t);this.terms=this.terms.filter((t=>t.terminal||t.preserve||e.some((e=>e.name==t||e.parts.includes(t)))));let t={},n=[this.error];this.error.id=0;let i=1;for(let e of this.terms)e.id<0&&e.nodeType&&!e.repeated&&(e.id=i++,n.push(e));let s=i;for(let e of this.terms)e.repeated&&(e.id=i++,n.push(e));this.eof.id=i++;for(let e of this.terms)e.id<0&&(e.id=i++),e.name&&(t[e.id]=e.name);if(i>=65534)throw new Lt("Too many terms");return{nodeTypes:n,names:t,minRepeatTerm:s,maxTerm:i-1}}}function Ft(e,t,n){if(e.length!=t.length)return e.length-t.length;for(let i=0;i<e.length;i++){let s=n(e[i],t[i]);if(s)return s}return 0}const Jt=[];class Ht{constructor(e,t=Jt,n=0){this.precedence=e,this.ambigGroups=t,this.cut=n}join(e){return this==Ht.none||this==e?e:e==Ht.none?this:new Ht(Math.max(this.precedence,e.precedence),Vt(this.ambigGroups,e.ambigGroups),Math.max(this.cut,e.cut))}cmp(e){return this.precedence-e.precedence||Ft(this.ambigGroups,e.ambigGroups,((e,t)=>e<t?-1:e>t?1:0))||this.cut-e.cut}}function Vt(e,t){if(0==e.length||e==t)return t;if(0==t.length)return e;let n=e.slice();for(let i of t)e.includes(i)||n.push(i);return n.sort()}Ht.none=new Ht(0);let Gt=0;class Ut{constructor(e,t,n,i){this.name=e,this.parts=t,this.conflicts=n,this.skip=i,this.id=Gt++}cmp(e){return this.id-e.id}cmpNoName(e){return this.parts.length-e.parts.length||this.skip.hash-e.skip.hash||this.parts.reduce(((t,n,i)=>t||n.cmp(e.parts[i])),0)||Ft(this.conflicts,e.conflicts,((e,t)=>e.cmp(t)))}toString(){return this.name+" -> "+this.parts.join(" ")}get isRepeatWrap(){return this.name.repeated&&2==this.parts.length&&this.parts[0]==this.name}sameReduce(e){return this.name==e.name&&this.parts.length==e.parts.length&&this.isRepeatWrap==e.isRepeatWrap}}class Wt{constructor(e,t,n){this.from=e,this.to=t,this.target=n}toString(){return`-> ${this.target.id}[label=${JSON.stringify(this.from<0?"ε":Qt(this.from)+(this.to>this.from+1?"-"+Qt(this.to-1):""))}]`}}function Qt(e){return e>65535?"∞":10==e?"\\n":13==e?"\\r":e<32||e>=55296&&e<57343?"\\u{"+e.toString(16)+"}":String.fromCharCode(e)}function Yt(e,t,n){if(e.edges.length!=t.edges.length)return!1;for(let i=0;i<e.edges.length;i++){let s=e.edges[i],r=t.edges[i];if(s.from!=r.from||s.to!=r.to||n[s.target.id]!=n[r.target.id])return!1}return!0}function Xt(e,t,n){for(let t of e)for(let e=0;e<t.edges.length;e++){let i=t.edges[e],s=n[i.target.id][0];s!=i.target&&(t.edges[e]=new Wt(i.from,i.to,s))}return n[t.id][0]}let Kt=1;class Zt{constructor(e=[],t=Kt++){this.accepting=e,this.id=t,this.edges=[]}edge(e,t,n){this.edges.push(new Wt(e,t,n))}nullEdge(e){this.edge(-1,-1,e)}compile(){let e=Object.create(null),t=0,n=function n(i){let s=e[nn(i)]=new Zt(i.reduce(((e,t)=>Vt(e,t.accepting)),[]),t++),r=[];for(let e of i)for(let t of e.edges)t.from>=0&&r.push(t);let a=function(e){let t=[],n=[];for(let n of e)t.includes(n.from)||t.push(n.from),t.includes(n.to)||t.push(n.to);t.sort(((e,t)=>e-t));for(let i=1;i<t.length;i++){let s=t[i-1],r=t[i],a=[];for(let t of e)if(t.to>s&&t.from<r)for(let e of t.target.closure())a.includes(e)||a.push(e);a.length&&n.push(new sn(s,r,a))}let i=e.filter((e=>65535==e.from&&65535==e.to));if(i.length){let e=[];for(let t of i)for(let n of t.target.closure())e.includes(n)||e.push(n);e.length&&n.push(new sn(65535,65535,e))}return n}(r);for(let t of a){let i=t.targets.sort(((e,t)=>e.id-t.id));s.edge(t.from,t.to,e[nn(i)]||n(i))}return s}(this.closure().sort(((e,t)=>e.id-t.id)));return function(e,t){let n=Object.create(null),i=Object.create(null);for(let t of e){let e=nn(t.accepting),s=i[e]||(i[e]=[]);s.push(t),n[t.id]=s}for(;;){let i=!1,s=Object.create(null);for(let t of e){if(s[t.id])continue;let e=n[t.id];if(1==e.length){s[e[0].id]=e;continue}let r=[];e:for(let t of e){for(let e of r)if(Yt(t,e[0],n)){e.push(t);continue e}r.push([t])}r.length>1&&(i=!0);for(let e of r)for(let t of e)s[t.id]=e}if(!i)return Xt(e,t,n);n=s}}(Object.values(e),n)}closure(){let e=[],t=Object.create(null);return function n(i){if(!t[i.id]){t[i.id]=!0,(i.edges.some((e=>e.from>=0))||i.accepting.length>0&&!i.edges.some((e=>function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}(i.accepting,e.target.accepting))))&&e.push(i);for(let e of i.edges)e.from<0&&n(e.target)}}(this),e}findConflicts(e){let t=[],n=this.cycleTerms();function i(e,n,i,s,r){e.id<n.id&&([e,n]=[n,e],i=-i);let a=t.find((t=>t.a==e&&t.b==n));a?a.soft!=i&&(a.soft=0):t.push(new en(e,n,i,tn(s),r&&tn(r)))}return this.reachable(((t,s)=>{if(0!=t.accepting.length){for(let e=0;e<t.accepting.length;e++)for(let n=e+1;n<t.accepting.length;n++)i(t.accepting[e],t.accepting[n],0,s);t.reachable(((r,a)=>{if(r!=t)for(let o of r.accepting){let r=n.includes(o);for(let l of t.accepting)o!=l&&i(o,l,r||n.includes(l)||!e(o,l)?0:1,s,s.concat(a))}}))}})),t}cycleTerms(){let e=[];this.reachable((t=>{for(let{target:n}of t.edges)e.push(t,n)}));let t=new Map,n=[];for(let i=0;i<e.length;){let s=e[i++],r=e[i++],a=t.get(s);if(a||t.set(s,a=[]),!a.includes(r))if(s==r)n.includes(s)||n.push(s);else{for(let t of a)e.push(s,t);a.push(r)}}let i=[];for(let e of n)for(let t of e.accepting)i.includes(t)||i.push(t);return i}reachable(e){let t=[],n=[];!function i(s){e(s,n),t.push(s);for(let e of s.edges)t.includes(e.target)||(n.push(e),i(e.target),n.pop())}(this)}toString(){let e="digraph {\n";return this.reachable((t=>{t.accepting.length&&(e+=`  ${t.id} [label=${JSON.stringify(t.accepting.join())}];\n`);for(let n of t.edges)e+=`  ${t.id} ${n};\n`})),e+"}"}toArray(e,t){let n=[],i=[];this.reachable((s=>{let r=i.length,a=r+3+2*s.accepting.length;n[s.id]=r,i.push(s.stateMask(e),a,s.edges.length),s.accepting.sort(((e,n)=>t.indexOf(e.id)-t.indexOf(n.id)));for(let t of s.accepting)i.push(t.id,e[t.id]||65535);for(let e of s.edges)i.push(e.from,e.to,-e.target.id-1)}));for(let e=0;e<i.length;e++)i[e]<0&&(i[e]=n[-i[e]-1]);if(i.length>65536)throw new Lt("Tokenizer tables too big to represent with 16-bit offsets.");return Uint16Array.from(i)}stateMask(e){let t=0;return this.reachable((n=>{for(let i of n.accepting)t|=e[i.id]||65535})),t}}class en{constructor(e,t,n,i,s){this.a=e,this.b=t,this.soft=n,this.exampleA=i,this.exampleB=s}}function tn(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n].from);return t}function nn(e){let t="";for(let n of e)t.length&&(t+="-"),t+=n.id;return t}class sn{constructor(e,t,n){this.from=e,this.to=t,this.targets=n}}let rn=/[\w_-]+/gy;try{rn=/[\p{Alphabetic}\d_-]+/guy}catch(e){}const an=[];class on{constructor(e,t=null){this.string=e,this.fileName=t,this.type="sof",this.value=null,this.start=0,this.end=0,this.next()}lineInfo(e){for(let t=1,n=0;;){let i=this.string.indexOf("\n",n);if(!(i>-1&&i<e))return{line:t,ch:e-n};++t,n=i+1}}message(e,t=-1){let n=this.fileName||"";if(t>-1){let e=this.lineInfo(t);n+=(n?" ":"")+e.line+":"+e.ch}return n?e+` (${n})`:e}raise(e,t=-1){throw new Lt(this.message(e,t))}match(e,t){let n=t.exec(this.string.slice(e));return n?e+n[0].length:-1}next(){let e=this.match(this.end,/^(\s|\/\/.*|\/\*[^]*?\*\/)*/);if(e==this.string.length)return this.set("eof",null,e,e);let t=this.string[e];if('"'==t){let t=this.match(e+1,/^(\\.|[^"\\])*"/);return-1==t&&this.raise("Unterminated string literal",e),this.set("string",On(this.string.slice(e+1,t-1)),e,t)}if("'"==t){let t=this.match(e+1,/^(\\.|[^'\\])*'/);return-1==t&&this.raise("Unterminated string literal",e),this.set("string",On(this.string.slice(e+1,t-1)),e,t)}if("@"==t){rn.lastIndex=e+1;let t=rn.exec(this.string);return t?this.set("at",t[0],e,e+1+t[0].length):this.raise("@ without a name",e)}if("$"!=t&&"!"!=t||"["!=this.string[e+1]){if(/[\[\]()!~+*?{}<>\.,|:$=]/.test(t))return this.set(t,null,e,e+1);{rn.lastIndex=e;let n=rn.exec(this.string);return n?this.set("id",n[0],e,e+n[0].length):this.raise("Unexpected character "+JSON.stringify(t),e)}}{let t=this.match(e+2,/^(?:\\.|[^\]\\])*\]/);return-1==t&&this.raise("Unterminated character set",e),this.set("set",this.string.slice(e+2,t-1),e,t)}}set(e,t,n,i){this.type=e,this.value=t,this.start=n,this.end=i}eat(e,t=null){return this.type==e&&(null==t||this.value===t)&&(this.next(),!0)}unexpected(){return this.raise(`Unexpected token '${this.string.slice(this.start,this.end)}'`,this.start)}expect(e,t=null){let n=this.value;return(this.type!=e||null!=t&&n!==t)&&this.unexpected(),this.next(),n}parse(){return function(e){let t=e.start,n=[],i=null,s=null,r=[],a=null,o=[],l=[],c=null,h=[],u=[],d=[],m=[],p=[],f=!1,g=!1;for(;"eof"!=e.type;){let t=e.start;if(e.eat("at","top"))"id"!=e.type&&e.raise("Top rules must have a name",e.start),p.push(ln(e,bn(e))),f=!0;else if("at"==e.type&&"tokens"==e.value)s?e.raise("Multiple @tokens declaractions",e.start):s=vn(e);else if(e.eat("at","local"))e.expect("id","tokens"),r.push(wn(e,t));else if(e.eat("at","context")){c&&e.raise("Multiple @context declarations",t);let n=bn(e);e.expect("id","from");let i=e.expect("string");c=new dt(t,n,i)}else if(e.eat("at","external"))e.eat("id","tokens")?h.push(Nn(e,t)):e.eat("id","prop")?d.push(Mn(e,t)):e.eat("id","extend")?u.push(En(e,"extend",t)):e.eat("id","specialize")?u.push(En(e,"specialize",t)):e.eat("id","propSource")?m.push(An(e,t)):e.unexpected();else if(e.eat("at","dialects")){e.expect("{");for(let t=!0;!e.eat("}");t=!1)t||e.eat(","),l.push(bn(e))}else if("at"==e.type&&"precedence"==e.value)i&&e.raise("Multiple precedence declarations",e.start),i=_n(e);else if(e.eat("at","detectDelim"))g=!0;else if(e.eat("at","skip")){let t=un(e);if("{"==e.type){e.next();let n=[],i=[];for(;!e.eat("}");)e.eat("at","top")?(i.push(ln(e,bn(e))),f=!0):n.push(ln(e));o.push({expr:t,topRules:i,rules:n})}else a&&e.raise("Multiple top-level skip declarations",e.start),a=t}else n.push(ln(e))}return f?new st(t,n,p,s,r,c,h,u,m,i,a,o,l,d,g):e.raise("Missing @top declaration")}(this)}}function ln(e,t){let n=t?t.start:e.start,i=t||bn(e),s=cn(e),r=[];if(e.eat("<"))for(;!e.eat(">");)r.length&&e.expect(","),r.push(bn(e));let a=un(e);return new rt(n,i,s,r,a)}function cn(e){if("["!=e.type)return an;let t=[];for(e.expect("[");!e.eat("]");)t.length&&e.expect(","),t.push(hn(e));return t}function hn(e){let t=e.start,n=[],i=e.value,s="at"==e.type;if(e.eat("at")||e.eat("id")||e.unexpected(),e.eat("="))for(;;)if("string"==e.type||"id"==e.type)n.push(new It(e.start,e.value,null)),e.next();else if(e.eat("."))n.push(new It(e.start,".",null));else{if(!e.eat("{"))break;n.push(new It(e.start,null,e.expect("id"))),e.expect("}")}return new $t(t,s,i,n)}function un(e){e.expect("{");let t=yn(e);return e.expect("}"),t}const dn="﷚";function mn(e){let t=e.start;if(e.eat("(")){if(e.eat(")"))return new kt(t,an,[an,an]);let n=yn(e);return e.expect(")"),n}if("string"==e.type){let n=e.value;return e.next(),0==n.length?new kt(t,an,[an,an]):new Nt(t,n)}if(e.eat("id","_"))return new At(t);if("set"==e.type){let n=e.value,i="!"==e.string[e.start],s=On(n.replace(/\\.|-|"/g,(e=>"-"==e?dn:'"'==e?'\\"':e))),r=[];for(let t=0;t<s.length;){let n=s.codePointAt(t);if(t+=n>65535?2:1,t<s.length-1&&s[t]==dn){let i=s.codePointAt(t+1);t+=i>65535?3:2,i<n&&e.raise("Invalid character range",e.start),pn(e,r,n,i+1)}else n==dn.charCodeAt(0)&&(n=45),pn(e,r,n,n+1)}return e.next(),new Et(t,r.sort(((e,t)=>e[0]-t[0])),i)}if("at"!=e.type||"specialize"!=e.value&&"extend"!=e.value){if("at"==e.type&&Ot.hasOwnProperty(e.value)){let t=new jt(e.start,e.value);return e.next(),t}if("["==e.type){let n=ln(e,new xt(t,"_anon"));return n.params.length&&e.raise("Inline rules can't have parameters",n.start),new vt(t,n)}{let n=bn(e);if("["==e.type||"{"==e.type){let i=ln(e,n);return i.params.length&&e.raise("Inline rules can't have parameters",i.start),new vt(t,i)}if(e.eat(".")&&"std"==n.name&&Ot.hasOwnProperty(e.value)){let n=new jt(t,e.value);return e.next(),n}return new bt(t,n,function(e){let t=[];if(e.eat("<"))for(;!e.eat(">");)t.length&&e.expect(","),t.push(yn(e));return t}(e))}}{let{start:t,value:n}=e;e.next();let i=cn(e);e.expect("<");let s,r=yn(e);return e.eat(",")?s=yn(e):r instanceof Nt?s=r:e.raise(`@${n} requires two arguments when its first argument isn't a literal string`),e.expect(">"),new _t(t,n,i,r,s)}}function pn(e,t,n,i){t.every((([e,t])=>t<=n||e>=i))||e.raise("Overlapping character range",e.start),t.push([n,i])}function fn(e){let t=e.start,n=mn(e);for(;;){let i=e.type;if(!(e.eat("*")||e.eat("?")||e.eat("+")))return n;n=new Ct(t,n,i)}}function gn(e){return"}"==e.type||")"==e.type||"|"==e.type||"/"==e.type||"/\\"==e.type||"{"==e.type||","==e.type||">"==e.type}function xn(e){let t=e.start,n=[],i=[an];do{for(;;){let t,n=e.start;if(e.eat("~"))t="ambig";else{if(!e.eat("!"))break;t="prec"}i[i.length-1]=i[i.length-1].concat(new St(n,bn(e),t))}if(gn(e))break;n.push(fn(e)),i.push(an)}while(!gn(e));return 1==n.length&&i.every((e=>0==e.length))?n[0]:new kt(t,n,i,!n.length)}function yn(e){let t=e.start,n=xn(e);if(!e.eat("|"))return n;let i=[n];do{i.push(xn(e))}while(e.eat("|"));let s=i.find((e=>e instanceof kt&&e.empty));return s&&e.raise("Empty expression in choice operator. If this is intentional, use () to make it explicit.",s.start),new wt(t,i)}function bn(e){"id"!=e.type&&e.unexpected();let t=e.start,n=e.value;return e.next(),new xt(t,n)}function _n(e){let t=e.start;e.next(),e.expect("{");let n=[];for(;!e.eat("}");)n.length&&e.eat(","),n.push({id:bn(e),type:e.eat("at","left")?"left":e.eat("at","right")?"right":e.eat("at","cut")?"cut":null});return new at(t,n)}function vn(e){let t=e.start;e.next(),e.expect("{");let n=[],i=[],s=[],r=[];for(;!e.eat("}");)"at"==e.type&&"precedence"==e.value?s.push(kn(e)):"at"==e.type&&"conflict"==e.value?r.push(Sn(e)):"string"==e.type?i.push(new ut(e.start,e.expect("string"),cn(e))):n.push(ln(e));return new ct(t,s,r,n,i)}function wn(e,t){e.expect("{");let n=[],i=[],s=null;for(;!e.eat("}");)"at"==e.type&&"precedence"==e.value?i.push(kn(e)):e.eat("at","else")&&!s?s={id:bn(e),props:cn(e)}:n.push(ln(e));return new ht(t,i,n,s)}function kn(e){let t=e.start;e.next(),e.expect("{");let n=[];for(;!e.eat("}");){n.length&&e.eat(",");let t=mn(e);t instanceof Nt||t instanceof bt?n.push(t):e.raise("Invalid expression in token precedences",t.start)}return new ot(t,n)}function Sn(e){let t=e.start;e.next(),e.expect("{");let n=mn(e);n instanceof Nt||n instanceof bt||e.raise("Invalid expression in token conflict",n.start),e.eat(",");let i=mn(e);return i instanceof Nt||i instanceof bt||e.raise("Invalid expression in token conflict",i.start),e.expect("}"),new lt(t,n,i)}function Cn(e){let t=[];for(e.expect("{");!e.eat("}");){t.length&&e.eat(",");let n=bn(e),i=cn(e);t.push({id:n,props:i})}return t}function Nn(e,t){let n=bn(e);e.expect("id","from");let i=e.expect("string");return new mt(t,n,i,Cn(e))}function En(e,t,n){let i=un(e),s=bn(e);e.expect("id","from");let r=e.expect("string");return new pt(n,t,i,s,r,Cn(e))}function An(e,t){let n=bn(e);return e.expect("id","from"),new ft(t,n,e.expect("string"))}function Mn(e,t){let n=bn(e),i=e.eat("id","as")?bn(e):n;e.expect("id","from");let s=e.expect("string");return new gt(t,i,n,s)}function On(e){let t,n=/\\(?:u\{([\da-f]+)\}|u([\da-f]{4})|x([\da-f]{2})|([ntbrf0])|(.))|[^]/giy,i="";for(;t=n.exec(e);){let[e,n,s,r,a,o]=t;i+=n||s||r?String.fromCodePoint(parseInt(n||s||r,16)):a?"n"==a?"\n":"t"==a?"\t":"0"==a?"\0":"r"==a?"\r":"f"==a?"\f":"\b":o||e}return i}function jn(e,t){return(e<<5)+e+t}function Tn(e,t){for(let n=0;n<t.length;n++)e=jn(e,t.charCodeAt(n));return e}const Pn=void 0!==nt&&nt.env.LOG||"",$n=/\btime\b/.test(Pn),In=$n?(e,t)=>{let n=Date.now(),i=t();return console.log(`${e} (${((Date.now()-n)/1e3).toFixed(2)}s)`),i}:(e,t)=>t();class Rn{constructor(e,t,n,i,s,r){this.rule=e,this.pos=t,this.ahead=n,this.ambigAhead=i,this.skipAhead=s,this.via=r,this.hash=0}finish(){let e=jn(jn(this.rule.id,this.pos),this.skipAhead.hash);for(let t of this.ahead)e=jn(e,t.hash);for(let t of this.ambigAhead)e=Tn(e,t);return this.hash=e,this}get next(){return this.pos<this.rule.parts.length?this.rule.parts[this.pos]:null}advance(){return new Rn(this.rule,this.pos+1,this.ahead,this.ambigAhead,this.skipAhead,this.via).finish()}get skip(){return this.pos==this.rule.parts.length?this.skipAhead:this.rule.skip}cmp(e){return this.rule.cmp(e.rule)||this.pos-e.pos||this.skipAhead.hash-e.skipAhead.hash||Ft(this.ahead,e.ahead,((e,t)=>e.cmp(t)))||Ft(this.ambigAhead,e.ambigAhead,qn)}eqSimple(e){return e.rule==this.rule&&e.pos==this.pos}toString(){let e=this.rule.parts.map((e=>e.name));return e.splice(this.pos,0,"·"),`${this.rule.name} -> ${e.join(" ")}`}eq(e){return this==e||this.hash==e.hash&&this.rule==e.rule&&this.pos==e.pos&&this.skipAhead==e.skipAhead&&Fn(this.ahead,e.ahead)&&Fn(this.ambigAhead,e.ambigAhead)}trail(e=60){let t=[];for(let e=this;e;e=e.via)for(let n=e.pos-1;n>=0;n--)t.push(e.rule.parts[n]);let n=t.reverse().join(" ");return n.length>e&&(n=n.slice(n.length-e).replace(/.*? /,"… ")),n}conflicts(e=this.pos){let t=this.rule.conflicts[e];return e==this.rule.parts.length&&this.ambigAhead.length&&(t=t.join(new Ht(0,this.ambigAhead))),t}static addOrigins(e,t){let n=e.slice();for(let e=0;e<n.length;e++){let i=n[e];if(0==i.pos)for(let e of t)e.next!=i.rule.name||n.includes(e)||n.push(e)}return n}}function Ln(e){let t=Ht.none;for(let n of e)t=t.join(n.conflicts());return t}function Dn(e,t){for(let n of e)if(n.rule.name.repeated)for(let e of t)if(e.rule.name==n.rule.name){if(n.rule.isRepeatWrap&&2==n.pos)return 1;if(e.rule.isRepeatWrap&&2==e.pos)return-1}return 0}function qn(e,t){return e<t?-1:e>t?1:0}function Bn(e,t,n,i){let s=[];for(let n=t+1;n<e.parts.length;n++){let t=e.parts[n],r=!1;if(t.terminal)Un(t,s);else for(let e of i[t.name])null==e?r=!0:Un(e,s);if(!r)return s}for(let e of n)Un(e,s);return s}function zn(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}function Fn(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}class Jn{constructor(e,t){this.term=e,this.target=t}eq(e){return e instanceof Jn&&this.term==e.term&&e.target.id==this.target.id}cmp(e){return e instanceof Hn?-1:this.term.id-e.term.id||this.target.id-e.target.id}toString(){return"s"+this.target.id}map(e,t){let n=t[e[this.target.id]];return n==this.target?this:new Jn(this.term,n)}}class Hn{constructor(e,t){this.term=e,this.rule=t}eq(e){return e instanceof Hn&&this.term==e.term&&e.rule.sameReduce(this.rule)}cmp(e){return e instanceof Jn?1:this.term.id-e.term.id||this.rule.name.id-e.rule.name.id||this.rule.parts.length-e.rule.parts.length}toString(){return`${this.rule.name.name}(${this.rule.parts.length})`}map(){return this}}function Vn(e){let t=5381;for(let n of e)t=jn(t,n.hash);return t}class Gn{constructor(e,t,n=0,i,s=Vn(t),r=null){this.id=e,this.set=t,this.flags=n,this.skip=i,this.hash=s,this.startRule=r,this.actions=[],this.actionPositions=[],this.goto=[],this.tokenGroup=-1,this.defaultReduce=null}toString(){let e=this.actions.map((e=>e.term+"="+e)).join(",")+(this.goto.length?" | "+this.goto.map((e=>e.term+"="+e)).join(","):"");return this.id+": "+this.set.filter((e=>e.pos>0)).join()+(this.defaultReduce?`\n  always ${this.defaultReduce.name}(${this.defaultReduce.parts.length})`:e.length?"\n  "+e:"")}addActionInner(e,t){e:for(let n=0;n<this.actions.length;n++){let i=this.actions[n];if(i.term==e.term){if(i.eq(e))return null;let s=Rn.addOrigins(t,this.set),r=Rn.addOrigins(this.actionPositions[n],this.set),a=Ln(s),o=Ln(r),l=Dn(s,r)||a.precedence-o.precedence;if(l>0){this.actions.splice(n,1),this.actionPositions.splice(n,1),n--;continue e}if(l<0)return null;if(a.ambigGroups.some((e=>o.ambigGroups.includes(e))))continue e;return i}}return this.actions.push(e),this.actionPositions.push(t),null}addAction(e,t,n){let i=this.addActionInner(e,t);if(i){let s,r=this.actionPositions[this.actions.indexOf(i)][0],a=[t[0].rule.name,r.rule.name];if(n.some((e=>e.rules.some((e=>a.includes(e))))))return;s=i instanceof Jn?`shift/reduce conflict between\n  ${r}\nand\n  ${t[0].rule}`:`reduce/reduce conflict between\n  ${r.rule}\nand\n  ${t[0].rule}`,s+=`\nWith input:\n  ${t[0].trail(70)} · ${e.term} …`,s+=function(e,t){if(e.eqSimple(t))return"";function n(e,t){let n=[];for(let i=t.via;!i.eqSimple(e);i=i.via)n.push(i);return n.length?(n.unshift(t),n.reverse().map(((e,n)=>"\n"+"  ".repeat(n+1)+(e==t?"":"via ")+e)).join("")):""}for(let i=e;i;i=i.via)for(let s=t;s;s=s.via)if(i.eqSimple(s))return"\nShared origin: "+i+n(i,e)+n(i,t);return""}(r,t[0]),n.push(new Qn(s,a))}}getGoto(e){return this.goto.find((t=>t.term==e))}hasSet(e){return zn(this.set,e)}finish(){if(this.actions.length){let e=this.actions[0];if(e instanceof Hn){let{rule:t}=e;this.actions.every((e=>e instanceof Hn&&e.rule.sameReduce(t)))&&(this.defaultReduce=t)}}this.actions.sort(((e,t)=>e.cmp(t))),this.goto.sort(((e,t)=>e.cmp(t)))}eq(e){let t=this.defaultReduce,n=e.defaultReduce;return t||n?!(!t||!n)&&t.sameReduce(n):this.skip==e.skip&&this.tokenGroup==e.tokenGroup&&zn(this.actions,e.actions)&&zn(this.goto,e.goto)}}function Un(e,t){t.includes(e)||t.push(e)}class Wn{constructor(e,t){this.set=e,this.state=t}}class Qn{constructor(e,t){this.error=e,this.rules=t}}function Yn(e){let t=null,n=1;for(let i of e){let e=i.rule.conflicts[i.pos-1].cut;e<n||((!t||e>n)&&(n=e,t=[]),t.push(i))}return t||e}function Xn(e,t,n){for(let i of e.goto)for(let e of t.goto)if(i.term==e.term&&n[i.target.id]!=n[e.target.id])return!1;e:for(let i of e.actions){let e=!1;for(let s of t.actions)if(s.term==i.term){if(i instanceof Jn?s instanceof Jn&&n[i.target.id]==n[s.target.id]:s.eq(i))continue e;e=!0}if(e)return!1}return!0}function Kn(e,t,n){return Xn(e,t,n)&&Xn(t,e,n)}function Zn(e,t){let n=[];for(let i of e){let e=t[i.id];n[e]||(n[e]=new Gn(e,i.set,0,i.skip,i.hash,i.startRule),n[e].tokenGroup=i.tokenGroup,n[e].defaultReduce=i.defaultReduce)}for(let i of e){let e=n[t[i.id]];e.flags|=i.flags;for(let s=0;s<i.actions.length;s++){let r=i.actions[s].map(t,n);e.actions.some((e=>e.eq(r)))||(e.actions.push(r),e.actionPositions.push(i.actionPositions[s]))}for(let s of i.goto){let i=s.map(t,n);e.goto.some((e=>e.eq(i)))||e.goto.push(i)}}return n}class ei{constructor(e,t){this.origin=e,this.members=[t]}}function ti(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eqSimple(t[n]))return!1;return!0}const ni=[];function ii(e){let t=e+32;return t>=34&&t++,t>=92&&t++,String.fromCharCode(t)}function si(e,t=65535){if(e>t)throw new Error("Trying to encode a number that's too big: "+e);if(65535==e)return String.fromCharCode(126);let n="";for(let t=46;;t=0){let i=e%46,s=e-i;if(n=ii(i+t)+n,0==s)break;e=s/46}return n}function ri(e,t=65535){let n='"'+si(e.length,4294967295);for(let i=0;i<e.length;i++)n+=si(e[i],t);return n+='"',n}const ai=[];class oi{constructor(e,t){this.terms=e,this.conflicts=t}concat(e){if(this==oi.none)return e;if(e==oi.none)return this;let t=null;if(this.conflicts||e.conflicts){t=this.conflicts?this.conflicts.slice():this.ensureConflicts();let n=e.ensureConflicts();t[t.length-1]=t[t.length-1].join(n[0]);for(let e=1;e<n.length;e++)t.push(n[e])}return new oi(this.terms.concat(e.terms),t)}withConflicts(e,t){if(t==Ht.none)return this;let n=this.conflicts?this.conflicts.slice():this.ensureConflicts();return n[e]=n[e].join(t),new oi(this.terms,n)}ensureConflicts(){if(this.conflicts)return this.conflicts;let e=[];for(let t=0;t<=this.terms.length;t++)e.push(Ht.none);return e}}function li(...e){return new oi(e,null)}oi.none=new oi(ai,null);class ci{constructor(e,t,n){this.id=e,this.args=t,this.term=n}matches(e){return this.id==e.id.name&&Pt(e.args,this.args)}matchesRepeat(e){return"+"==this.id&&Tt(e.expr,this.args[0])}}class hi{constructor(e,t){this.options=t,this.terms=new zt,this.specialized=Object.create(null),this.tokenOrigins=Object.create(null),this.rules=[],this.built=[],this.ruleNames=Object.create(null),this.namespaces=Object.create(null),this.namedTerms=Object.create(null),this.termTable=Object.create(null),this.knownProps=Object.create(null),this.dynamicRulePrecedences=[],this.definedGroups=[],this.astRules=[],this.currentSkip=[],In("Parse",(()=>{this.input=new on(e,t.fileName),this.ast=this.input.parse()}));let n=a.md;for(let e in n)n[e]instanceof a.md&&!n[e].perNode&&(this.knownProps[e]={prop:n[e],source:{name:e,from:null}});for(let e of this.ast.externalProps)this.knownProps[e.id.name]={prop:this.options.externalProp?this.options.externalProp(e.id.name):new a.md,source:{name:e.externalID.name,from:e.source}};this.dialects=this.ast.dialects.map((e=>e.name)),this.tokens=new ki(this,this.ast.tokens),this.localTokens=this.ast.localTokens.map((e=>new Si(this,e))),this.externalTokens=this.ast.externalTokens.map((e=>new Ri(this,e))),this.externalSpecializers=this.ast.externalSpecializers.map((e=>new Li(this,e))),In("Build rules",(()=>{let e=this.newName("%noskip",!0);this.defineRule(e,[]);let t=this.ast.mainSkip?this.newName("%mainskip",!0):e,n=[],i=[];for(let e of this.ast.rules)this.astRules.push({skip:t,rule:e});for(let e of this.ast.topRules)i.push({skip:t,rule:e});for(let s of this.ast.scopedSkip){let r=e,a=this.ast.scopedSkip.findIndex(((e,t)=>t<n.length&&Tt(e.expr,s.expr)));a>-1?r=n[a]:this.ast.mainSkip&&Tt(s.expr,this.ast.mainSkip)?r=t:Ti(s.expr)||(r=this.newName("%skip",!0)),n.push(r);for(let e of s.rules)this.astRules.push({skip:r,rule:e});for(let e of s.topRules)i.push({skip:r,rule:e})}for(let{rule:e}of this.astRules)this.unique(e.id);this.currentSkip.push(e),this.skipRules=t==e?[t]:[e,t],t!=e&&this.defineRule(t,this.normalizeExpr(this.ast.mainSkip));for(let t=0;t<this.ast.scopedSkip.length;t++){let i=n[t];this.skipRules.includes(i)||(this.skipRules.push(i),i!=e&&this.defineRule(i,this.normalizeExpr(this.ast.scopedSkip[t].expr)))}this.currentSkip.pop();for(let{rule:e,skip:t}of i.sort(((e,t)=>e.rule.start-t.rule.start))){this.unique(e.id),this.used(e.id.name),this.currentSkip.push(t);let{name:n,props:i}=this.nodeInfo(e.props,"a",e.id.name,ai,ai,e.expr),s=this.terms.makeTop(n,i);this.namedTerms[n]=s,this.defineRule(s,this.normalizeExpr(e.expr)),this.currentSkip.pop()}for(let e of this.externalSpecializers)e.finish();for(let{skip:e,rule:t}of this.astRules)this.ruleNames[t.id.name]&&Bi(t)&&!t.params.length&&(this.buildRule(t,[],e,!1),t.expr instanceof kt&&0==t.expr.exprs.length&&this.used(t.id.name))}));for(let e in this.ruleNames){let t=this.ruleNames[e];t&&this.warn(`Unused rule '${t.name}'`,t.start)}this.tokens.takePrecedences(),this.tokens.takeConflicts();for(let{name:e,group:t,rule:n}of this.definedGroups)this.defineGroup(e,t,n);this.checkGroups()}unique(e){e.name in this.ruleNames&&this.raise(`Duplicate definition of rule '${e.name}'`,e.start),this.ruleNames[e.name]=e}used(e){this.ruleNames[e]=null}newName(e,t=null,n={}){for(let i=t?0:1;;i++){let s=i?`${e}-${i}`:e;if(!this.terms.names[s])return this.terms.makeNonTerminal(s,!0===t?null:t,n)}}prepareParser(){let e=In("Simplify rules",(()=>function(e,t){return function(e){let t,n=Object.create(null);for(let i=0;i<e.length;){let s=i,r=e[i++].name;for(;i<e.length&&e[i].name==r;)i++;let a=i-s;if(!r.interesting)for(let o=i;o<e.length;){let i=o,l=e[o++].name;for(;o<e.length&&e[o].name==l;)o++;if(o-i!=a||l.interesting)continue;let c=!0;for(let t=0;t<a&&c;t++){let n=e[s+t],r=e[i+t];0!=n.cmpNoName(r)&&(c=!1)}c&&(t=n[r.name]=l)}}if(!t)return e;let i=[];for(let t of e)n[t.name.name]||i.push(t.parts.every((e=>!n[e.name]))?t:new Ut(t.name,t.parts.map((e=>n[e.name]||e)),t.conflicts,t.skip));return i}(function(e,t){for(let n=0;;n++){let i,s=Object.create(null);if(0==n)for(let a of e)if(a.name.inline&&!s[a.name.name]){let o=e.filter((e=>e.name==a.name));if(o.some((e=>e.parts.includes(a.name))))continue;i=s[a.name.name]=o}for(let l=0;l<e.length;l++){let c=e[l];c.name.interesting||c.parts.includes(c.name)||!(c.parts.length<3)||t.includes(c.name)||1!=c.parts.length&&!e.every((e=>e.skip==c.skip||!e.parts.includes(c.name)))||c.parts.some((e=>!!s[e.name]))||e.some(((e,t)=>t!=l&&e.name==c.name))||(i=s[c.name.name]=[c])}if(!i)return e;let r=[];for(let h of e){function u(e,t,n){if(e==h.parts.length)return void r.push(new Ut(h.name,n,t,h.skip));let i=h.parts[e],a=s[i.name];if(a)for(let i of a)u(e+1,t.slice(0,t.length-1).concat(t[e].join(i.conflicts[0])).concat(i.conflicts.slice(1,i.conflicts.length-1)).concat(h.conflicts[e+1].join(i.conflicts[i.conflicts.length-1])),n.concat(i.parts));else u(e+1,t.concat(h.conflicts[e+1]),n.concat(i))}s[h.name.name]||(h.parts.some((e=>!!s[e.name]))?u(0,[h.conflicts[0]],[]):r.push(h))}e=r}}(e,t))}(this.rules,[...this.skipRules,...this.terms.tops]))),{nodeTypes:t,names:n,minRepeatTerm:i,maxTerm:s}=this.terms.finish(e);for(let e in this.namedTerms)this.termTable[e]=this.namedTerms[e].id;/\bgrammar\b/.test(Pn)&&console.log(e.join("\n"));let r=this.terms.tops.slice(),a=function(e){let t=Object.create(null);for(let n of e.terms)n.terminal||(t[n.name]=[]);for(;;){let n=!1;for(let i of e.terms)if(!i.terminal)for(let e of i.rules){let s=t[i.name],r=!1,a=s.length;for(let n of e.parts){if(r=!0,n.terminal)Un(n,s);else for(let e of t[n.name])null==e?r=!1:Un(e,s);if(r)break}r||Un(null,s),s.length>a&&(n=!0)}if(!n)return t}}(this.terms),o=this.skipRules.map(((e,t)=>{let n=[],i=[],s=[];for(let t of e.rules){if(!t.parts.length)continue;let e=t.parts[0];for(let t of e.terminal?[e]:a[e.name]||[])i.includes(t)||i.push(t);e.terminal&&1==t.parts.length&&!s.some((n=>n!=t&&n.parts[0]==e))?n.push(e):s.push(t)}return e.rules=s,s.length&&r.push(e),{skip:n,rule:s.length?e:null,startTokens:i,id:t}})),l=In("Build full automaton",(()=>function(e,t,n){let i=[],s={},r=Date.now();function a(e,t){if(0==e.length)return null;let a,o=Vn(e),l=s[o];for(let t of e)if(a){if(a!=t.skip)throw new Lt("Inconsistent skip sets after "+t.trail())}else a=t.skip;if(l)for(let t of l)if(zn(e,t.set)){if(t.state.skip!=a)throw new Lt("Inconsistent skip sets after "+t.set[0].trail());return t.state}let c,h=function(e,t){let n=[],i=[];function s(t,s,r,a,o){for(let l of t.rules){let t=n.find((e=>e.rule==l));if(!t){let i=e.find((e=>0==e.pos&&e.rule==l));t=i?new Rn(l,0,i.ahead.slice(),i.ambigAhead,i.skipAhead,i.via):new Rn(l,0,[],ni,a,o),n.push(t)}if(t.skipAhead!=a)throw new Lt("Inconsistent skip sets after "+o.trail());t.ambigAhead=Vt(t.ambigAhead,r);for(let e of s)t.ahead.includes(e)||(t.ahead.push(e),t.rule.parts.length&&!t.rule.parts[0].terminal&&Un(t,i))}}for(let n of e){let e=n.next;e&&!e.terminal&&s(e,Bn(n.rule,n.pos,n.ahead,t),n.conflicts(n.pos+1).ambigGroups,n.pos==n.rule.parts.length-1?n.skipAhead:n.rule.skip,n)}for(;i.length;){let e=i.pop();s(e.rule.parts[0],Bn(e.rule,0,e.ahead,t),Vt(e.rule.conflicts[1].ambigGroups,1==e.rule.parts.length?e.ambigAhead:ni),1==e.rule.parts.length?e.skipAhead:e.rule.skip,e)}let r=e.slice();for(let t of n){t.ahead.sort(((e,t)=>e.hash-t.hash)),t.finish();let n=e.findIndex((e=>0==e.pos&&e.rule==t.rule));n>-1?r[n]=t:r.push(t)}return r.sort(((e,t)=>e.cmp(t)))}(e,n),u=Vn(h);if(!t)for(let e of i)e.hash==u&&e.hasSet(h)&&(c=e);return c||(c=new Gn(i.length,h,0,a,u,t),i.push(c),$n&&i.length%500==0&&console.log(`${i.length} states after ${((Date.now()-r)/1e3).toFixed(2)}s`)),(s[o]||(s[o]=[])).push(new Wn(e,c)),c}for(const n of t){const t=n.rules.length?n.rules[0].skip:e.names["%noskip"];a(n.rules.map((n=>new Rn(n,0,[e.eof],ni,t,null).finish())),n)}let o=[];for(let e=0;e<i.length;e++){let t=i[e],s=[],r=[],l=[];for(let e of t.set)if(e.pos==e.rule.parts.length)e.rule.name.top||l.push(e);else{let t=e.rule.parts[e.pos],n=s.indexOf(t);n<0?(s.push(t),r.push([e])):r[n].push(e)}for(let e=0;e<s.length;e++){let n=s[e],i=r[e].map((e=>e.advance()));if(n.terminal){let s=a(Yn(i));s&&t.addAction(new Jn(n,s),r[e],o)}else{let e=a(i);e&&t.goto.push(new Jn(n,e))}}let c=!1;for(let e of l)for(let n of e.ahead){let i=t.actions.length;t.addAction(new Hn(n,e.rule),[e],o),t.actions.length==i&&(c=!0)}if(c)for(let e=0;e<t.goto.length;e++)n[t.goto[e].term.name].some((e=>t.actions.some((t=>t.term==e&&t instanceof Jn))))||t.goto.splice(e--,1)}if(o.length)throw new Lt(o.map((e=>e.error)).join("\n\n"));for(let e of i)e.finish();return $n&&console.log(`${i.length} states total.`),i}(this.terms,r,a))),c=this.localTokens.map(((e,t)=>e.buildLocalGroup(l,o,t))),{tokenGroups:h,tokenPrec:u,tokenData:d}=In("Build token groups",(()=>this.tokens.buildTokenGroups(l,o,c.length))),m=In("Finish automaton",(()=>function(e){for(let t=1;;t++){let n=[],i=!1,s=Date.now(),r=[];for(let t=0;t<e.length;t++){let s=e[t],a=r.findIndex((e=>s.eq(e)));if(a<0)n[t]=r.length,r.push(s);else{n[t]=a,i=!0;let e=r[a],o=null;for(let t of s.set)e.set.some((e=>e.eqSimple(t)))||(o||(o=[])).push(t);o&&(e.set=o.concat(e.set).sort(((e,t)=>e.cmp(t))))}}if($n&&console.log(`Merge identical pass ${t}${i?"":", done"} (${((Date.now()-s)/1e3).toFixed(2)}s)`),!i)return e;for(let e of r)e.defaultReduce||(e.actions=e.actions.map((e=>e.map(n,r))),e.goto=e.goto.map((e=>e.map(n,r))));for(let e=0;e<r.length;e++)r[e].id=e;e=r}}(function(e){let t=[],n=[];e:for(let i=0;i<e.length;i++){let s=e[i];if(!s.startRule)for(let r=0;r<n.length;r++){let a=n[r],o=e[a.members[0]];if(s.tokenGroup==o.tokenGroup&&s.skip==o.skip&&!o.startRule&&ti(s.set,o.set)){a.members.push(i),t.push(r);continue e}}t.push(n.length),n.push(new ei(n.length,i))}function i(i,s){let r=n[i],a=e[r.members[s]],o=r.members.pop();s!=r.members.length&&(r.members[s]=o);for(let s=i+1;s<n.length;s++)if(t[a.id]=s,n[s].origin==r.origin&&n[s].members.every((n=>Kn(a,e[n],t))))return void n[s].members.push(a.id);t[a.id]=n.length,n.push(new ei(r.origin,a.id))}for(let s=1;;s++){let r=!1,a=Date.now();for(let s=0,a=n.length;s<a;s++){let a=n[s];for(let n=0;n<a.members.length-1;n++)for(let o=n+1;o<a.members.length;o++){let l=a.members[n],c=a.members[o];Kn(e[l],e[c],t)||(r=!0,i(s,o--))}}if($n&&console.log(`Collapse pass ${s}${r?"":", done"} (${((Date.now()-a)/1e3).toFixed(2)}s)`),!r)return Zn(e,t)}}(l)))),p=function(e,t){let n=Object.create(null),i=[],s=e=>{n[e.id]||(n[e.id]=!0,i.push(e))};for(let n of e)n.startRule&&t.includes(n.startRule)&&s(n);for(let e=0;e<i.length;e++){for(let t of i[e].actions)t instanceof Jn&&s(t.target);for(let t of i[e].goto)s(t.target)}return e=>!n[e]}(m,this.terms.tops);/\blr\b/.test(Pn)&&console.log(m.join("\n"));let f=[];for(let e of this.externalSpecializers)f.push(e);for(let e in this.specialized)f.push({token:this.terms.names[e],table:mi(this.specialized[e])});let g=e=>e instanceof Ri?e.ast.start:this.tokens.ast?this.tokens.ast.start:-1,x=h.concat(this.externalTokens).sort(((e,t)=>g(e)-g(t))).concat(c),y=new fi,b=o.map((e=>{let t=[];for(let n of e.skip)t.push(n.id,0,4);if(e.rule){let n=m.find((t=>t.startRule==e.rule));for(let e of n.actions)t.push(e.term.id,n.id,2)}return t.push(65535,0),y.storeArray(t)})),_=In("Finish states",(()=>{let e=new Uint32Array(6*m.length),t=this.computeForceReductions(m,o),n=new ui(x,y,e,b,o,m,this);for(let e of m)n.finish(e,p(e.id),t[e.id]);return e})),v=Object.create(null);for(let e=0;e<this.dialects.length;e++)v[this.dialects[e]]=y.storeArray((this.tokens.byDialect[e]||ai).map((e=>e.id)).concat(65535));let w=null;if(this.dynamicRulePrecedences.length){w=Object.create(null);for(let{rule:e,prec:t}of this.dynamicRulePrecedences)w[e.id]=t}let k=Object.create(null);for(let e of this.terms.tops)k[e.nodeName]=[m.find((t=>t.startRule==e)).id,e.id];let S=y.storeArray(u.concat(65535)),{nodeProps:C,skippedTypes:N}=this.gatherNodeProps(t);return{states:_,stateData:y.finish(),goto:gi(m),nodeNames:t.filter((e=>e.id<i)).map((e=>e.nodeName)).join(" "),nodeProps:C,skippedTypes:N,maxTerm:s,repeatNodeCount:t.length-i,tokenizers:x,tokenData:d,topRules:k,dialects:v,dynamicPrecedences:w,specialized:f,tokenPrec:S,termNames:n}}getParser(){let{states:e,stateData:t,goto:n,nodeNames:i,nodeProps:s,skippedTypes:r,maxTerm:a,repeatNodeCount:o,tokenizers:l,tokenData:c,topRules:h,dialects:u,dynamicPrecedences:d,specialized:m,tokenPrec:p,termNames:f}=this.prepareParser(),g=m.map((e=>{if(e instanceof Li){let t=this.options.externalSpecializer(e.ast.id.name,this.termTable);return{term:e.term.id,get:(n,i)=>t(n,i)<<1|("extend"==e.ast.type?1:0),external:t,extend:"extend"==e.ast.type}}return{term:e.token.id,get:t=>e.table[t]||-1}}));return tt.WQ.deserialize({version:14,states:e,stateData:t,goto:n,nodeNames:i,maxTerm:a,repeatNodeCount:o,nodeProps:s.map((({prop:e,terms:t})=>[this.knownProps[e].prop,...t])),propSources:this.options.externalPropSource?this.ast.externalPropSources.map((e=>this.options.externalPropSource(e.id.name))):void 0,skippedNodes:r,tokenData:c,tokenizers:l.map((e=>e.create())),context:this.ast.context?this.options.contextTracker:void 0,topRules:h,dialects:u,dynamicPrecedences:d,specialized:g,tokenPrec:p,termNames:f})}getParserFile(){let{states:e,stateData:t,goto:n,nodeNames:i,nodeProps:s,skippedTypes:r,maxTerm:a,repeatNodeCount:o,tokenizers:l,tokenData:c,topRules:h,dialects:u,dynamicPrecedences:d,specialized:m,tokenPrec:p,termNames:f}=this.prepareParser(),g=this.options.moduleStyle||"es",x="// This file was generated by lezer-generator. You probably shouldn't edit it.\n",y=x,b={},_=Object.create(null),v=Object.create(null);for(let e of qi)v[e]=!0;let w=this.options.exportName||"parser";v[w]=!0;let k=e=>{for(let t=0;;t++){let n=e+(t?"_"+t:"");if(!v[n])return n}},S=(e,t,n=e)=>{let i=e+" from "+t;if(_[i])return _[i];let s=JSON.stringify(t),r=e;return e in v&&(r=k(n),e+=`${"cjs"==g?":":" as"} ${r}`),v[r]=!0,(b[s]||(b[s]=[])).push(e),_[i]=r},C=S("LRParser","@lezer/lr"),N=l.map((e=>e.createSource(S))),E=this.ast.context?S(this.ast.context.id.name,this.ast.context.source):null,A=s.map((({prop:e,terms:t})=>{let{source:n}=this.knownProps[e];return`[${n.from?S(n.name,n.from):JSON.stringify(n.name)}, ${t.map(T).join(",")}]`})),M="",O=m.map((e=>{if(e instanceof Li){let t=S(e.ast.id.name,e.ast.source);return`{term: ${e.term.id}, get: (value, stack) => (${t}(value, stack) << 1)${"extend"==e.ast.type?" | 1":""}, external: ${t}${"extend"==e.ast.type?", extend: true":""}}`}{let n=k("spec_"+e.token.name.replace(/\W/g,""));return v[n]=!0,M+=`const ${n} = ${t=e.table,"{__proto__:null,"+Object.keys(t).map((e=>`${/\W/.test(e)?JSON.stringify(e):e}:${t[e]}`)).join(", ")+"}"}\n`,`{term: ${e.token.id}, get: value => ${n}[value] || -1}`}var t})),j=this.ast.externalPropSources.map((e=>S(e.id.name,e.source)));for(let e in b)y+="cjs"==g?`const {${b[e].join(", ")}} = require(${e})\n`:`import {${b[e].join(", ")}} from ${e}\n`;function T(e){return"string"!=typeof e||/^(true|false|\d+(\.\d+)?|\.\d+)$/.test(e)?e:JSON.stringify(e)}y+=M;let P=Object.keys(u).map((e=>`${e}: ${u[e]}`)),$=`${C}.deserialize({\n  version: 14,\n  states: ${ri(e,4294967295)},\n  stateData: ${ri(t)},\n  goto: ${ri(n)},\n  nodeNames: ${JSON.stringify(i)},\n  maxTerm: ${a}${E?`,\n  context: ${E}`:""}${A.length?`,\n  nodeProps: [\n    ${A.join(",\n    ")}\n  ]`:""}${j.length?`,\n  propSources: [${j.join()}]`:""}${r.length?`,\n  skippedNodes: ${JSON.stringify(r)}`:""},\n  repeatNodeCount: ${o},\n  tokenData: ${ri(c)},\n  tokenizers: [${N.join(", ")}],\n  topRules: ${JSON.stringify(h)}${P.length?`,\n  dialects: {${P.join(", ")}}`:""}${d?`,\n  dynamicPrecedences: ${JSON.stringify(d)}`:""}${O.length?`,\n  specialized: [${O.join(",")}]`:""},\n  tokenPrec: ${p}${this.options.includeNames?`,\n  termNames: ${JSON.stringify(f)}`:""}\n})`,I=[];for(let e in this.termTable){let t=e;if(qi.includes(t))for(let n=1;t="_".repeat(n)+e,t in this.termTable;n++);I.push(`${t}${"cjs"==g?":":" ="} ${this.termTable[e]}`)}for(let e=0;e<this.dialects.length;e++)I.push(`Dialect_${this.dialects[e]}${"cjs"==g?":":" ="} ${e}`);return{parser:y+("cjs"==g?`exports.${w} = ${$}\n`:`export const ${w} = ${$}\n`),terms:"cjs"==g?`${x}module.exports = {\n  ${I.join(",\n  ")}\n}`:`${x}export const\n  ${I.join(",\n  ")}\n`}}gatherNonSkippedNodes(){let e=Object.create(null),t=[],n=n=>{e[n.id]||(e[n.id]=!0,t.push(n))};this.terms.tops.forEach(n);for(let e=0;e<t.length;e++)for(let i of t[e].rules)for(let e of i.parts)n(e);return e}gatherNodeProps(e){let t=this.gatherNonSkippedNodes(),n=[],i=[];for(let s of e){t[s.id]||s.error||n.push(s.id);for(let e in s.props){let t=this.knownProps[e];if(!t)throw new Lt("No known prop type for "+e);if(null==t.source.from&&("repeated"==t.source.name||"error"==t.source.name))continue;let n=i.find((t=>t.prop==e));n||i.push(n={prop:e,values:{}}),(n.values[s.props[e]]||(n.values[s.props[e]]=[])).push(s.id)}}return{nodeProps:i.map((({prop:e,values:t})=>{let n=[];for(let e in t){let i=t[e];if(1==i.length)n.push(i[0],e);else{n.push(-i.length);for(let e of i)n.push(e);n.push(e)}}return{prop:e,terms:n}})),skippedTypes:n}}makeTerminal(e,t,n){return this.terms.makeTerminal(this.terms.uniqueName(e),t,n)}computeForceReductions(e,t){let n=[],i=[],s=Object.create(null);for(let t of e){n.push(0);for(let e of t.goto){let n=s[e.term.id]||(s[e.term.id]=[]),i=n.find((t=>t.target==e.target.id));i?i.parents.push(t.id):n.push({parents:[t.id],target:e.target.id})}i[t.id]=t.set.filter((e=>e.pos>0&&!e.rule.name.top)).sort(((e,t)=>t.pos-e.pos||e.rule.parts.length-t.rule.parts.length))}let r=Object.create(null);function a(e,t,n=null){let i=s[e];return!!i&&i.some((e=>{let i=n?n.filter((t=>e.parents.includes(t))):e.parents;if(0==i.length)return!1;if(e.target==t)return!0;let s=r[e.target];return null!=s&&a(s,t,i)}))}for(let i of e)i.defaultReduce&&i.defaultReduce.parts.length>0&&(n[i.id]=pi(i.defaultReduce,t),1==i.defaultReduce.parts.length&&(r[i.id]=i.defaultReduce.name.id));for(let s=1;;s++){let o=!0;for(let l of e){if(l.defaultReduce)continue;let e=i[l.id];if(e.length==s){for(let i of e)if(1!=i.pos||!a(i.rule.name.id,l.id)){n[l.id]=pi(i.rule,t,i.pos),1==i.pos&&(r[l.id]=i.rule.name.id);break}}else e.length>s&&(o=!1)}if(o)break}return n}substituteArgs(e,t,n){return 0==t.length?e:e.walk((e=>{let i;if(e instanceof bt&&(i=n.findIndex((t=>t.name==e.id.name)))>-1){let n=t[i];if(e.args.length){if(n instanceof bt&&!n.args.length)return new bt(e.start,n.id,e.args);this.raise("Passing arguments to a parameter that already has arguments",e.start)}return n}if(e instanceof vt){let i=e.rule,s=this.substituteArgsInProps(i.props,t,n);return s==i.props?e:new vt(e.start,new rt(i.start,i.id,s,i.params,i.expr))}if(e instanceof _t){let i=this.substituteArgsInProps(e.props,t,n);return i==e.props?e:new _t(e.start,e.type,i,e.token,e.content)}return e}))}substituteArgsInProps(e,t,n){let i=e=>{let i=e;for(let s=0;s<e.length;s++){let r=e[s];if(!r.name)continue;let a=n.findIndex((e=>e.name==r.name));if(a<0)continue;i==e&&(i=e.slice());let o=t[a];o instanceof bt&&!o.args.length?i[s]=new It(r.start,o.id.name,null):o instanceof Nt?i[s]=new It(r.start,o.value,null):this.raise(`Trying to interpolate expression '${o}' into a prop`,r.start)}return i},s=e;for(let t=0;t<e.length;t++){let n=e[t],r=i(n.value);r!=n.value&&(s==e&&(s=e.slice()),s[t]=new $t(n.start,n.at,n.name,r))}return s}conflictsFor(e){let t=Ht.none,n=Ht.none;for(let i of e)if("ambig"==i.type)t=t.join(new Ht(0,[i.id.name]));else{let e=this.ast.precedences,s=e?e.items.findIndex((e=>e.id.name==i.id.name)):-1;s<0&&this.raise(`Reference to unknown precedence: '${i.id.name}'`,i.id.start);let r=e.items[s],a=e.items.length-s;"cut"==r.type?t=t.join(new Ht(0,ai,a)):(t=t.join(new Ht(a<<2)),n=n.join(new Ht((a<<2)+("left"==r.type?1:"right"==r.type?-1:0))))}return{here:t,atEnd:n}}raise(e,t=1){return this.input.raise(e,t)}warn(e,t=-1){let n=this.input.message(e,t);this.options.warn?this.options.warn(n):console.warn(n)}defineRule(e,t){let n=this.currentSkip[this.currentSkip.length-1];for(let i of t)this.rules.push(new Ut(e,i.terms,i.ensureConflicts(),n))}resolve(e){for(let t of this.built)if(t.matches(e))return[li(t.term)];let t=this.tokens.getToken(e);if(t)return[li(t)];for(let t of this.localTokens){let n=t.getToken(e);if(n)return[li(n)]}for(let t of this.externalTokens){let n=t.getToken(e);if(n)return[li(n)]}for(let t of this.externalSpecializers){let n=t.getToken(e);if(n)return[li(n)]}let n=this.astRules.find((t=>t.rule.id.name==e.id.name));return n?(n.rule.params.length!=e.args.length&&this.raise(`Wrong number or arguments for '${e.id.name}'`,e.start),this.used(n.rule.id.name),[li(this.buildRule(n.rule,e.args,n.skip))]):this.raise(`Reference to undefined rule '${e.id.name}'`,e.start)}normalizeRepeat(e){let t=this.built.find((t=>t.matchesRepeat(e)));if(t)return li(t.term);let n=e.expr.prec<e.prec?`(${e.expr})+`:`${e.expr}+`,i=this.terms.makeRepeat(this.terms.uniqueName(n));return this.built.push(new ci("+",[e.expr],i)),this.defineRule(i,this.normalizeExpr(e.expr).concat(li(i,i))),li(i)}normalizeSequence(e){let t=e.exprs.map((e=>this.normalizeExpr(e))),n=this;return function i(s,r,a){let{here:o,atEnd:l}=n.conflictsFor(e.markers[r]);if(r==t.length)return[s.withConflicts(s.terms.length,o.join(a))];let c=[];for(let e of t[r])for(let t of i(s.concat(e).withConflicts(s.terms.length,o),r+1,a.join(l)))c.push(t);return c}(oi.none,0,Ht.none)}normalizeExpr(e){if(e instanceof Ct&&"?"==e.kind)return[oi.none,...this.normalizeExpr(e.expr)];if(e instanceof Ct){let t=this.normalizeRepeat(e);return"+"==e.kind?[t]:[oi.none,t]}return e instanceof wt?e.exprs.reduce(((e,t)=>e.concat(this.normalizeExpr(t))),[]):e instanceof kt?this.normalizeSequence(e):e instanceof Nt?[li(this.tokens.getLiteral(e))]:e instanceof bt?this.resolve(e):e instanceof _t?[li(this.resolveSpecialization(e))]:e instanceof vt?[li(this.buildRule(e.rule,ai,this.currentSkip[this.currentSkip.length-1],!0))]:this.raise(`This type of expression ('${e}') may not occur in non-token rules`,e.start)}buildRule(e,t,n,i=!1){let s=this.substituteArgs(e.expr,t,e.params),{name:r,props:a,dynamicPrec:o,inline:l,group:c,exported:h}=this.nodeInfo(e.props||ai,i?"pg":"pgi",e.id.name,t,e.params,e.expr);h&&e.params.length&&this.warn("Can't export parameterized rules",e.start),h&&i&&this.warn("Can't export inline rule",e.start);let u=this.newName(e.id.name+(t.length?"<"+t.join(",")+">":""),r||!0,a);return l&&(u.inline=!0),o&&this.registerDynamicPrec(u,o),(u.nodeType||h)&&0==e.params.length&&(r||(u.preserve=!0),i||(this.namedTerms[h||e.id.name]=u)),i||this.built.push(new ci(e.id.name,t,u)),this.currentSkip.push(n),this.defineRule(u,this.normalizeExpr(s)),this.currentSkip.pop(),c&&this.definedGroups.push({name:u,group:c,rule:e}),u}nodeInfo(e,t,n=null,i=ai,s=ai,r,a){let o={},l=n&&(t.indexOf("a")>-1||!function(e){let t=e[0];return"_"==t||t.toUpperCase()!=t}(n))&&!/ /.test(n)?n:null,c=null,h=0,u=!1,d=null,m=null;for(let r of e)if(r.at)if("name"==r.name)l=this.finishProp(r,i,s),/ /.test(l)&&this.raise(`Node names cannot have spaces ('${l}')`,r.start);else if("dialect"==r.name){t.indexOf("d")<0&&this.raise("Can't specify a dialect on non-token rules",e[0].start),1==r.value.length||r.value[0].value||this.raise("The '@dialect' rule prop must hold a plain string value");let n=this.dialects.indexOf(r.value[0].value);n<0&&this.raise(`Unknown dialect '${r.value[0].value}'`,r.value[0].start),c=n}else"dynamicPrecedence"==r.name?(t.indexOf("p")<0&&this.raise("Dynamic precedence can only be specified on nonterminals"),1==r.value.length&&/^-?(?:10|\d)$/.test(r.value[0].value)||this.raise("The '@dynamicPrecedence' rule prop must hold an integer between -10 and 10"),h=+r.value[0].value):"inline"==r.name?(r.value.length&&this.raise("'@inline' doesn't take a value",r.value[0].start),t.indexOf("i")<0&&this.raise("Inline can only be specified on nonterminals"),u=!0):"isGroup"==r.name?(t.indexOf("g")<0&&this.raise("'@isGroup' can only be specified on nonterminals"),d=r.value.length?this.finishProp(r,i,s):n):"export"==r.name?m=r.value.length?this.finishProp(r,i,s):n:this.raise(`Unknown built-in prop name '@${r.name}'`,r.start);else{if(!this.knownProps[r.name]){let e=["name","dialect","dynamicPrecedence","export","isGroup"].includes(r.name)?` (did you mean '@${r.name}'?)`:"";this.raise(`Unknown prop name '${r.name}'${e}`,r.start)}o[r.name]=this.finishProp(r,i,s)}if(r&&this.ast.autoDelim&&(l||Dt(o))){let e=this.findDelimiters(r);e&&(di(e[0],"closedBy",e[1].nodeName),di(e[1],"openedBy",e[0].nodeName))}if(a&&Dt(a))for(let e in a)e in o||(o[e]=a[e]);return Dt(o)&&!l&&this.raise("Node has properties but no name",e.length?e[0].start:r.start),u&&(Dt(o)||c||h)&&this.raise("Inline nodes can't have props, dynamic precedence, or a dialect",e[0].start),u&&l&&(l=null),{name:l,props:o,dialect:c,dynamicPrec:h,inline:u,group:d,exported:m}}finishProp(e,t,n){return e.value.map((e=>{if(e.value)return e.value;let i=n.findIndex((t=>t.name==e.name));i<0&&this.raise(`Property refers to '${e.name}', but no parameter by that name is in scope`,e.start);let s=t[i];return s instanceof bt&&!s.args.length?s.id.name:s instanceof Nt?s.value:this.raise(`Expression '${s}' can not be used as part of a property value`,e.start)})).join("")}resolveSpecialization(e){let t,n=e.type,{name:i,props:s,dialect:r}=this.nodeInfo(e.props,"d"),a=this.normalizeExpr(e.token);if(1==a.length&&1==a[0].terms.length&&a[0].terms[0].terminal||this.raise(`The first argument to '${n}' must resolve to a token`,e.token.start),e.content instanceof Nt)t=[e.content.value];else{if(!(e.content instanceof wt&&e.content.exprs.every((e=>e instanceof Nt))))return this.raise(`The second argument to '${e.type}' must be a literal or choice of literals`,e.content.start);t=e.content.exprs.map((e=>e.value))}let o=a[0].terms[0],l=null,c=this.specialized[o.name]||(this.specialized[o.name]=[]);for(let a of t){let t=c.find((e=>e.value==a));null==t?(l||(l=this.makeTerminal(o.name+"/"+JSON.stringify(a),i,s),null!=r&&(this.tokens.byDialect[r]||(this.tokens.byDialect[r]=[])).push(l)),c.push({value:a,term:l,type:n,dialect:r,name:i}),this.tokenOrigins[l.name]={spec:o}):(t.type!=n&&this.raise(`Conflicting specialization types for ${JSON.stringify(a)} of ${o.name} (${n} vs ${t.type})`,e.start),t.dialect!=r&&this.raise(`Conflicting dialects for specialization ${JSON.stringify(a)} of ${o.name}`,e.start),t.name!=i&&this.raise(`Conflicting names for specialization ${JSON.stringify(a)} of ${o.name}`,e.start),l&&t.term!=l&&this.raise(`Conflicting specialization tokens for ${JSON.stringify(a)} of ${o.name}`,e.start),l=t.term)}return l}findDelimiters(e){if(!(e instanceof kt)||e.exprs.length<2)return null;let t=e=>{if(e instanceof Nt)return{term:this.tokens.getLiteral(e),str:e.value};if(e instanceof bt&&0==e.args.length){let n=this.ast.rules.find((t=>t.id.name==e.id.name));if(n)return t(n.expr);let i=this.tokens.rules.find((t=>t.id.name==e.id.name));if(i&&i.expr instanceof Nt)return{term:this.tokens.getToken(e),str:i.expr.value}}return null},n=t(e.exprs[e.exprs.length-1]);if(!n||!n.term.nodeName)return null;let i=["()","[]","{}","<>"].find((e=>n.str.indexOf(e[1])>-1&&n.str.indexOf(e[0])<0));if(!i)return null;let s=t(e.exprs[0]);return!s||!s.term.nodeName||s.str.indexOf(i[0])<0||s.str.indexOf(i[1])>-1?null:[s.term,n.term]}registerDynamicPrec(e,t){this.dynamicRulePrecedences.push({rule:e,prec:t}),e.preserve=!0}defineGroup(e,t,n){var i;let s=[],r=e=>{if(e.nodeName)return[e];s.includes(e)&&this.raise(`Rule '${n.id.name}' cannot define a group because it contains a non-named recursive rule ('${e.name}')`,n.start);let t=[];s.push(e);for(let i of this.rules)if(i.name==e){let e=i.parts.map(r).filter((e=>e.length));if(e.length>1&&this.raise(`Rule '${n.id.name}' cannot define a group because some choices produce multiple named nodes`,n.start),1==e.length)for(let n of e[0])t.push(n)}return s.pop(),t};for(let n of r(e))n.props.group=((null===(i=n.props.group)||void 0===i?void 0:i.split(" "))||[]).concat(t).sort().join(" ")}checkGroups(){let e=Object.create(null),t=Object.create(null);for(let n of this.terms.terms)if(n.nodeName&&(t[n.nodeName]=!0,n.props.group))for(let t of n.props.group.split(" "))(e[t]||(e[t]=[])).push(n);let n=Object.keys(e);for(let i=0;i<n.length;i++){let s=n[i],r=e[s];t[s]&&this.warn(`Group name '${s}' conflicts with a node of the same name`);for(let t=i+1;t<n.length;t++){let i=e[n[t]];r.some((e=>i.includes(e)))&&(r.length>i.length?i.some((e=>!r.includes(e))):r.some((e=>!i.includes(e))))&&this.warn(`Groups '${s}' and '${n[t]}' overlap without one being a superset of the other`)}}}}class ui{constructor(e,t,n,i,s,r,a){this.tokenizers=e,this.data=t,this.stateArray=n,this.skipData=i,this.skipInfo=s,this.states=r,this.builder=a,this.sharedActions=[]}findSharedActions(e){if(e.actions.length<5)return null;let t=null;for(let n of this.sharedActions)(!t||n.actions.length>t.actions.length)&&n.actions.every((t=>e.actions.some((e=>e.eq(t)))))&&(t=n);if(t)return t;let n=null,i=[];for(let t=e.id+1;t<this.states.length;t++){let s=this.states[t],r=0;if(!(s.defaultReduce||s.actions.length<5)){for(let t of e.actions)for(let e of s.actions)t.eq(e)&&(i[r++]=t);r>=5&&(!n||n.length<r)&&(n=i,i=[])}}if(!n)return null;let s={actions:n,addr:this.storeActions(n,-1,null)};return this.sharedActions.push(s),s}storeActions(e,t,n){if(t<0&&n&&n.actions.length==e.length)return n.addr;let i=[];for(let s of e)if(!n||!n.actions.some((e=>e.eq(s))))if(s instanceof Jn)i.push(s.term.id,s.target.id,0);else{let e=pi(s.rule,this.skipInfo);e!=t&&i.push(s.term.id,65535&e,e>>16)}return i.push(65535),t>-1?i.push(2,65535&t,t>>16):n?i.push(1,65535&n.addr,n.addr>>16):i.push(0),this.data.storeArray(i)}finish(e,t,n){let i=this.builder,s=i.skipRules.indexOf(e.skip),r=this.skipData[s],a=this.skipInfo[s].startTokens,o=e.defaultReduce?pi(e.defaultReduce,this.skipInfo):0,l=t?1:0,c=-1,h=null;if(0==o){if(t)for(const t of e.actions)t instanceof Hn&&t.term.eof&&(c=pi(t.rule,this.skipInfo));c<0&&(h=this.findSharedActions(e))}e.set.some((e=>e.rule.name.top&&e.pos==e.rule.parts.length))&&(l|=2);let u=[];for(let t=0;t<e.actions.length+a.length;t++){let n=t<e.actions.length?e.actions[t].term:a[t-e.actions.length];for(;;){let e=i.tokenOrigins[n.name];if(!e||!e.spec){e&&e.external instanceof Ri&&yi(u,e.external);break}n=e.spec}}let d=0;for(let t=0;t<this.tokenizers.length;t++){let n=this.tokenizers[t];(u.includes(n)||n.groupID==e.tokenGroup)&&(d|=1<<t)}let m=6*e.id;this.stateArray[m+0]=l,this.stateArray[m+1]=this.storeActions(o?ai:e.actions,c,h),this.stateArray[m+2]=r,this.stateArray[m+3]=d,this.stateArray[m+4]=o,this.stateArray[m+5]=n}}function di(e,t,n){let i=e.props[t];(!i||i.split(" ").indexOf(n)<0)&&(e.props[t]=i?i+" "+n:n)}function mi(e){let t=Object.create(null);for(let{value:n,term:i,type:s}of e){let e="specialize"==s?0:1;t[n]=i.id<<1|e}return t}function pi(e,t,n=e.parts.length){return 65536|e.name.id|(e.isRepeatWrap&&n==e.parts.length?131072:0)|(t.some((t=>t.rule==e.name))?262144:0)|n<<19}class fi{constructor(){this.data=[]}storeArray(e){let t=function(e,t){e:for(let n=0;;){let i=e.indexOf(t[0],n);if(-1==i||i+t.length>e.length)break;for(let s=1;s<t.length;s++)if(t[s]!=e[i+s]){n=i+1;continue e}return i}return-1}(this.data,e);if(t>-1)return t;let n=this.data.length;for(let t of e)this.data.push(t);return n}finish(){return Uint16Array.from(this.data)}}function gi(e){let t={},n=0;for(let i of e)for(let e of i.goto){n=Math.max(e.term.id,n);let s=t[e.term.id]||(t[e.term.id]={});(s[e.target.id]||(s[e.target.id]=[])).push(i.id)}let i=new fi,s=[],r=n+2;for(let e=0;e<=n;e++){let n=t[e];if(!n){s.push(1);continue}let a=[],o=Object.keys(n);for(let e of o){let t=n[e];a.push((e==o[o.length-1]?1:0)+(t.length<<1)),a.push(+e);for(let e of t)a.push(e)}s.push(i.storeArray(a)+r)}if(s.some((e=>e>65535)))throw new Lt("Goto table too large");return Uint16Array.from([n+1,...s,...i.data])}class xi{constructor(e,t){this.tokens=e,this.groupID=t}create(){return this.groupID}createSource(){return String(this.groupID)}}function yi(e,t){e.includes(t)||e.push(t)}function bi(e){let t=Object.create(null);for(let n of e){let e=1<<n.groupID;for(let i of n.tokens)t[i.id]=(t[i.id]||0)|e}return t}class _i{constructor(e,t,n){this.name=e,this.expr=t,this.scope=n}}class vi{constructor(e,t,n,i){this.name=e,this.start=t,this.to=n,this.args=i}}class wi{constructor(e,t){this.b=e,this.ast=t,this.startState=new Zt,this.built=[],this.building=[],this.byDialect=Object.create(null),this.precedenceRelations=[],this.rules=t?t.rules:ai;for(let t of this.rules)e.unique(t.id)}getToken(e){for(let t of this.built)if(t.matches(e))return t.term;let t=e.id.name,n=this.rules.find((e=>e.id.name==t));if(!n)return null;let{name:i,props:s,dialect:r,exported:a}=this.b.nodeInfo(n.props,"d",t,e.args,n.params.length!=e.args.length?ai:n.params),o=this.b.makeTerminal(e.toString(),i,s);return null!=r&&(this.byDialect[r]||(this.byDialect[r]=[])).push(o),(o.nodeType||a)&&0==n.params.length&&(o.nodeType||(o.preserve=!0),this.b.namedTerms[a||t]=o),this.buildRule(n,e,this.startState,new Zt([o])),this.built.push(new ci(t,e.args,o)),o}buildRule(e,t,n,i,s=ai){let r=t.id.name;e.params.length!=t.args.length&&this.b.raise(`Incorrect number of arguments for token '${r}'`,t.start);let a=this.building.find((e=>e.name==r&&Pt(t.args,e.args)));if(a){if(a.to==i)return void n.nullEdge(a.start);let e=this.building.length-1;for(;this.building[e].name!=r;)e--;this.b.raise(`Invalid (non-tail) recursion in token rules: ${this.building.slice(e).map((e=>e.name)).join(" -> ")}`,t.start)}this.b.used(e.id.name);let o=new Zt;n.nullEdge(o),this.building.push(new vi(r,o,i,t.args)),this.build(this.b.substituteArgs(e.expr,t.args,e.params),o,i,t.args.map(((t,n)=>new _i(e.params[n].name,t,s)))),this.building.pop()}build(e,t,n,i){if(e instanceof bt){let s,r=e.id.name,a=i.find((e=>e.name==r));if(a)return this.build(a.expr,t,n,a.scope);for(let e=0,t=this.b.localTokens;e<=t.length;e++)s=(e==t.length?this.b.tokens:t[e]).rules.find((e=>e.id.name==r));if(!s)return this.b.raise(`Reference to token rule '${e.id.name}', which isn't found`,e.start);this.buildRule(s,e,t,n,i)}else if(e instanceof jt)for(let[i,s]of Ot[e.type])t.edge(i,s,n);else if(e instanceof wt)for(let s of e.exprs)this.build(s,t,n,i);else if(Ti(e))t.nullEdge(n);else if(e instanceof kt){let s=e.markers.find((e=>e.length>0));s&&this.b.raise("Conflict marker in token expression",s[0].start);for(let s=0;s<e.exprs.length;s++){let r=s==e.exprs.length-1?n:new Zt;this.build(e.exprs[s],t,r,i),t=r}}else if(e instanceof Ct)if("*"==e.kind){let s=new Zt;t.nullEdge(s),this.build(e.expr,s,s,i),s.nullEdge(n)}else if("+"==e.kind){let s=new Zt;this.build(e.expr,t,s,i),this.build(e.expr,s,s,i),s.nullEdge(n)}else t.nullEdge(n),this.build(e.expr,t,n,i);else if(e instanceof Et)for(let[i,s]of e.inverted?function(e){let t=0,n=[];for(let[i,s]of e)i>t&&n.push([t,i]),t=s;return t<=Ai&&n.push([t,Ai+1]),n}(e.ranges):e.ranges)ji(t,n,i,s);else if(e instanceof Nt)for(let i=0;i<e.value.length;i++){let s=e.value.charCodeAt(i),r=i==e.value.length-1?n:new Zt;t.edge(s,s+1,r),t=r}else{if(!(e instanceof At))return this.b.raise("Unrecognized expression type in token",e.start);{let e=new Zt;t.edge(0,56320,n),t.edge(56320,65536,n),t.edge(55296,56320,e),e.edge(56320,57344,n)}}}takePrecedences(){let e=this.precedenceRelations=[];if(this.ast)for(let t of this.ast.precedences){let n=[];for(let i of t.items){let t=[];if(i instanceof bt)for(let e of this.built)(i.args.length?e.matches(i):e.id==i.id.name)&&t.push(e.term);else{let e=JSON.stringify(i.value),n=this.built.find((t=>t.id==e));n&&t.push(n.term)}t.length||this.b.warn(`Precedence specified for unknown token ${i}`,i.start);for(let i of t)Ii(e,i,n);n=n.concat(t)}}}precededBy(e,t){let n=this.precedenceRelations.find((t=>t.term==e));return n&&n.after.includes(t)}buildPrecTable(e){let t=[],n=this.precedenceRelations.slice();for(let{a:t,b:i,soft:s}of e)if(s){if(!n.some((e=>e.term==t))||!n.some((e=>e.term==i)))continue;s<0&&([t,i]=[i,t]),Ii(n,i,[t]),Ii(n,t,[])}e:for(;n.length;){for(let e=0;e<n.length;e++){let i=n[e];if(i.after.every((e=>t.includes(e.id)))){if(t.push(i.term.id),1==n.length)break e;n[e]=n.pop();continue e}}this.b.raise(`Cyclic token precedence relation between ${n.map((e=>e.term)).join(", ")}`)}return t}}class ki extends wi{constructor(){super(...arguments),this.explicitConflicts=[]}getLiteral(e){let t=JSON.stringify(e.value);for(let e of this.built)if(e.id==t)return e.term;let n=null,i={},s=null,r=null,a=this.ast?this.ast.literals.find((t=>t.literal==e.value)):null;a&&({name:n,props:i,dialect:s,exported:r}=this.b.nodeInfo(a.props,"da",e.value));let o=this.b.makeTerminal(t,n,i);return null!=s&&(this.byDialect[s]||(this.byDialect[s]=[])).push(o),r&&(this.b.namedTerms[r]=o),this.build(e,this.startState,new Zt([o]),ai),this.built.push(new ci(t,ai,o)),o}takeConflicts(){var e;let t=e=>{if(e instanceof bt){for(let t of this.built)if(t.matches(e))return t.term}else{let t=JSON.stringify(e.value),n=this.built.find((e=>e.id==t));if(n)return n.term}return this.b.warn(`Precedence specified for unknown token ${e}`,e.start),null};for(let n of(null===(e=this.ast)||void 0===e?void 0:e.conflicts)||[]){let e=t(n.a),i=t(n.b);e&&i&&(e.id<i.id&&([e,i]=[i,e]),this.explicitConflicts.push({a:e,b:i}))}}buildTokenGroups(e,t,n){let i=this.startState.compile();i.accepting.length&&this.b.raise(`Grammar contains zero-length tokens (in '${i.accepting[0].name}')`,this.rules.find((e=>e.id.name==i.accepting[0].name)).start),/\btokens\b/.test(Pn)&&console.log(i.toString());let s=i.findConflicts(function(e,t,n){let i=Object.create(null);function s(e,i){return e.actions.some((e=>e.term==i))||n[t.skipRules.indexOf(e.skip)].startTokens.includes(i)}return(t,n)=>{t.id<n.id&&([t,n]=[n,t]);let r=t.id|n.id<<16,a=i[r];return null!=a?a:i[r]=e.some((e=>s(e,t)&&s(e,n)))}}(e,this.b,t)).filter((({a:e,b:t})=>!this.precededBy(e,t)&&!this.precededBy(t,e)));for(let{a:e,b:t}of this.explicitConflicts)s.some((n=>n.a==e&&n.b==t))||s.push(new en(e,t,0,"",""));let r=s.filter((e=>e.soft)),a=s.filter((e=>!e.soft)),o=[],l=[];for(let i of e){if(i.defaultReduce||i.tokenGroup>-1)continue;let e=[],s=[],r=t[this.b.skipRules.indexOf(i.skip)].startTokens;for(let e of r)i.actions.some((t=>t.term==e))&&this.b.raise(`Use of token ${e.name} conflicts with skip rule`);let c=[];for(let e=0;e<i.actions.length+(r?r.length:0);e++){let t=e<i.actions.length?i.actions[e].term:r[e-i.actions.length],n=this.b.tokenOrigins[t.name];if(n&&n.spec)t=n.spec;else if(n&&n.external)continue;yi(c,t)}if(0==c.length)continue;for(let t of c)for(let n of a){let r=n.a==t?n.b:n.b==t?n.a:null;if(r){if(c.includes(r)&&!o.some((e=>e.conflict==n))){let e=n.exampleA?` (example: ${JSON.stringify(n.exampleA)}${n.exampleB?` vs ${JSON.stringify(n.exampleB)}`:""})`:"";o.push({error:`Overlapping tokens ${t.name} and ${r.name} used in same context${e}\nAfter: ${i.set[0].trail()}`,conflict:n})}yi(e,t),yi(s,r)}}let h=null;for(let t of l)if(!s.some((e=>t.tokens.includes(e)))){for(let n of e)yi(t.tokens,n);h=t;break}h||(h=new xi(e,l.length+n),l.push(h)),i.tokenGroup=h.groupID}o.length&&this.b.raise(o.map((e=>e.error)).join("\n\n")),l.length+n>16&&this.b.raise(`Too many different token groups (${l.length}) to represent them as a 16-bit bitfield`);let c=this.buildPrecTable(r);return{tokenGroups:l,tokenPrec:c,tokenData:i.toArray(bi(l),c)}}}class Si extends wi{constructor(e,t){super(e,t),this.fallback=null,t.fallback&&e.unique(t.fallback.id)}getToken(e){let t=null;if(this.ast.fallback&&this.ast.fallback.id.name==e.id.name){if(e.args.length&&this.b.raise(`Incorrect number of arguments for ${e.id.name}`,e.start),!this.fallback){let{name:t,props:n,exported:i}=this.b.nodeInfo(this.ast.fallback.props,"",e.id.name,ai,ai),s=this.fallback=this.b.makeTerminal(e.id.name,t,n);(s.nodeType||i)&&(s.nodeType||(s.preserve=!0),this.b.namedTerms[i||e.id.name]=s),this.b.used(e.id.name)}t=this.fallback}else t=super.getToken(e);return t&&!this.b.tokenOrigins[t.name]&&(this.b.tokenOrigins[t.name]={group:this}),t}buildLocalGroup(e,t,n){let i=this.startState.compile();i.accepting.length&&this.b.raise(`Grammar contains zero-length tokens (in '${i.accepting[0].name}')`,this.rules.find((e=>e.id.name==i.accepting[0].name)).start);for(let{a:e,b:t,exampleA:n}of i.findConflicts((()=>!0)))this.precededBy(e,t)||this.precededBy(t,e)||this.b.raise(`Overlapping tokens ${e.name} and ${t.name} in local token group${n?` (example: ${JSON.stringify(n)})`:""}`);for(let i of e){if(i.defaultReduce)continue;let e=null,s=t[this.b.skipRules.indexOf(i.skip)].startTokens[0];for(let{term:t}of i.actions){let n=this.b.tokenOrigins[t.name];(null==n?void 0:n.group)==this?e=t:s=t}e&&(s&&this.b.raise(`Tokens from a local token group used together with other tokens (${e.name} with ${s.name})`),i.tokenGroup=n)}let s=this.buildPrecTable(ai),r=i.toArray({[n]:65535},s),a=r.length,o=new Uint16Array(r.length+s.length+1);return o.set(r,0),o.set(s,a),o[o.length-1]=65535,{groupID:n,create:()=>new tt.RA(o,a,this.fallback?this.fallback.id:void 0),createSource:e=>`new ${e("LocalTokenGroup","@lezer/lr")}(${ri(o)}, ${a}${this.fallback?`, ${this.fallback.id}`:""})`}}}const Ci=65536,Ni=55296,Ei=57344,Ai=1114111,Mi=56320,Oi=57343;function ji(e,t,n,i){if(n<Ci&&(n<Ni&&e.edge(n,Math.min(i,Ni),t),i>Ei&&e.edge(Math.max(n,Ei),Math.min(i,65536),t),n=Ci),i<=Ci)return;let s=String.fromCodePoint(n),r=String.fromCodePoint(i-1),a=s.charCodeAt(0),o=s.charCodeAt(1),l=r.charCodeAt(0),c=r.charCodeAt(1);if(a==l){let n=new Zt;e.edge(a,a+1,n),n.edge(o,c+1,t)}else{let n=a,i=l;if(o>Mi){n++;let i=new Zt;e.edge(a,a+1,i),i.edge(o,Oi+1,t)}if(c<Oi){i--;let n=new Zt;e.edge(l,l+1,n),n.edge(Mi,c+1,t)}if(n<=i){let s=new Zt;e.edge(n,i+1,s),s.edge(Mi,Oi+1,t)}}}function Ti(e){return e instanceof kt&&0==e.exprs.length}function Pi(e,t){let n=Object.create(null);for(let i of t){e.unique(i.id);let{name:t,props:s,dialect:r}=e.nodeInfo(i.props,"d",i.id.name),a=e.makeTerminal(i.id.name,t,s);null!=r&&(e.tokens.byDialect[r]||(e.tokens.byDialect[r]=[])).push(a),e.namedTerms[i.id.name]=n[i.id.name]=a}return n}function $i(e,t,n){let i=t[n.id.name];return i?(n.args.length&&e.raise("External tokens cannot take arguments",n.args[0].start),e.used(n.id.name),i):null}function Ii(e,t,n){let i=e.findIndex((e=>e.term==t));i<0?e.push({term:t,after:n}):e[i]={term:t,after:e[i].after.concat(n)}}class Ri{constructor(e,t){this.b=e,this.ast=t,this.tokens=Pi(e,t.tokens);for(let e in this.tokens)this.b.tokenOrigins[this.tokens[e].name]={external:this}}getToken(e){return $i(this.b,this.tokens,e)}create(){return this.b.options.externalTokenizer(this.ast.id.name,this.b.termTable)}createSource(e){let{source:t,id:{name:n}}=this.ast;return e(n,t)}}class Li{constructor(e,t){this.b=e,this.ast=t,this.term=null,this.tokens=Pi(e,t.tokens)}finish(){let e=this.b.normalizeExpr(this.ast.token);1==e.length&&1==e[0].terms.length&&e[0].terms[0].terminal||this.b.raise(`The token expression to '@external ${this.ast.type}' must resolve to a token`,this.ast.token.start),this.term=e[0].terms[0];for(let e in this.tokens)this.b.tokenOrigins[this.tokens[e].name]={spec:this.term,external:this}}getToken(e){return $i(this.b,this.tokens,e)}}function Di(e,t={}){let n=new hi(e,t),i=n.getParser();return i.termTable=n.termTable,i}const qi=["break","case","catch","continue","debugger","default","do","else","finally","for","function","if","return","switch","throw","try","var","while","with","null","true","false","instanceof","typeof","void","delete","new","in","this","const","class","extends","export","import","super","enum","implements","interface","let","package","private","protected","public","static","yield","require"];function Bi(e){return e.props.some((e=>e.at&&"export"==e.name))}const zi=s.EditorView.theme({"&":{background:"var(--jp-layout-color0)",color:"var(--jp-content-font-color1)"},".jp-CodeConsole &, .jp-Notebook &":{background:"transparent"},".cm-content":{caretColor:"var(--jp-editor-cursor-color)"},".cm-scroller":{fontFamily:"inherit"},".cm-cursor, .cm-dropCursor":{borderLeft:"var(--jp-code-cursor-width0) solid var(--jp-editor-cursor-color)"},".cm-selectionBackground, .cm-content ::selection":{backgroundColor:"var(--jp-editor-selected-background)"},"&.cm-focused .cm-selectionBackground":{backgroundColor:"var(--jp-editor-selected-focused-background)"},".cm-gutters":{borderRight:"1px solid var(--jp-border-color2)",backgroundColor:"var(--jp-layout-color2)"},".cm-gutter, .cm-activeLine":{backgroundColor:"var(--jp-layout-color2)"},".cm-lineNumbers":{color:"var(--jp-ui-font-color2)"},".cm-searchMatch":{backgroundColor:"var(--jp-search-unselected-match-background-color)",color:"var(--jp-search-unselected-match-color)"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"var(--jp-search-selected-match-background-color) !important",color:"var(--jp-search-selected-match-color) !important"}}),Fi=r.Qf.define([{tag:je.pJ.meta,color:"var(--jp-mirror-editor-meta-color)"},{tag:je.pJ.heading,color:"var(--jp-mirror-editor-header-color)"},{tag:[je.pJ.heading1,je.pJ.heading2,je.pJ.heading3,je.pJ.heading4],color:"var(--jp-mirror-editor-header-color)",fontWeight:"bold"},{tag:je.pJ.keyword,color:"var(--jp-mirror-editor-keyword-color)",fontWeight:"bold"},{tag:je.pJ.atom,color:"var(--jp-mirror-editor-atom-color)"},{tag:je.pJ.number,color:"var(--jp-mirror-editor-number-color)"},{tag:[je.pJ.definition(je.pJ.name),je.pJ.function(je.pJ.definition(je.pJ.variableName))],color:"var(--jp-mirror-editor-def-color)"},{tag:je.pJ.standard(je.pJ.variableName),color:"var(--jp-mirror-editor-builtin-color)"},{tag:[je.pJ.special(je.pJ.variableName),je.pJ.self],color:"var(--jp-mirror-editor-variable-2-color)"},{tag:je.pJ.punctuation,color:"var(--jp-mirror-editor-punctuation-color)"},{tag:je.pJ.propertyName,color:"var(--jp-mirror-editor-property-color)"},{tag:je.pJ.operator,color:"var(--jp-mirror-editor-operator-color)",fontWeight:"bold"},{tag:je.pJ.comment,color:"var(--jp-mirror-editor-comment-color)",fontStyle:"italic"},{tag:je.pJ.string,color:"var(--jp-mirror-editor-string-color)"},{tag:[je.pJ.labelName,je.pJ.monospace,je.pJ.special(je.pJ.string)],color:"var(--jp-mirror-editor-string-2-color)"},{tag:je.pJ.bracket,color:"var(--jp-mirror-editor-bracket-color)"},{tag:je.pJ.tagName,color:"var(--jp-mirror-editor-tag-color)"},{tag:je.pJ.attributeName,color:"var(--jp-mirror-editor-attribute-color)"},{tag:je.pJ.quote,color:"var(--jp-mirror-editor-quote-color)"},{tag:je.pJ.link,color:"var(--jp-mirror-editor-link-color)",textDecoration:"underline"},{tag:[je.pJ.separator,je.pJ.derefOperator,je.pJ.paren],color:""},{tag:je.pJ.strong,fontWeight:"bold"},{tag:je.pJ.emphasis,fontStyle:"italic"},{tag:je.pJ.strikethrough,textDecoration:"line-through"},{tag:je.pJ.bool,color:"var(--jp-mirror-editor-keyword-color)",fontWeight:"bold"}]),Ji=[zi,(0,r.nF)(Fi)];class Hi{constructor(){this._themeMap=new Map([["jupyter",Object.freeze({name:"jupyter",theme:Ji})]])}get themes(){return Array.from(this._themeMap.values())}defaultTheme(){return this._themeMap.get("jupyter").theme}addTheme(e){if(this._themeMap.has(e.name))throw new Error(`A theme named '${e.name}' is already registered.`);this._themeMap.set(e.name,{displayName:e.name,...e})}getTheme(e){var t;const n=null===(t=this._themeMap.get(e))||void 0===t?void 0:t.theme;return null!=n?n:this.defaultTheme()}}!function(e){e.getDefaultThemes=function(e){const t=(null!=e?e:Ee.nullTranslator).load("jupyterlab");return[Object.freeze({name:"codemirror",displayName:t.__("codemirror"),theme:[s.EditorView.baseTheme({}),(0,r.nF)(r.R_)]})]}}(Hi||(Hi={}));class Vi{constructor(){this._modeList=[],this.addLanguage({name:"none",mime:"text/plain",support:new r.ri(r.qp.define({parser:Di("@top Program { }")}))})}addLanguage(e){var t;if(null!==(t=this.findByName(e.name))&&void 0!==t?t:this.findByMIME(e.mime,!0))throw new Error(`${e.mime} already registered`);this._modeList.push(this.makeSpec(e))}async getLanguage(e){const t=this.findBest(e);return t&&!t.support&&(t.support=await t.load()),t}getLanguages(){return[...this._modeList]}findByMIME(e,t=!1){if(Array.isArray(e)){for(let t=0;t<e.length;t++){const n=this.findByMIME(e[t]);if(n)return n}return null}e=e.toLowerCase();for(let t=0;t<this._modeList.length;t++){let n=this._modeList[t];if(Array.isArray(n.mime)){for(let t=0;t<n.mime.length;t++)if(n.mime[t]==e)return n}else if(n.mime==e)return n}if(!t){if(/\+xml$/.test(e))return this.findByMIME("application/xml");if(/\+json$/.test(e))return this.findByMIME("application/json")}return null}findByName(e){e=e.toLowerCase();for(let t=0;t<this._modeList.length;t++){let n=this._modeList[t];if(n.name.toLowerCase()==e)return n;if(n.alias)for(let t=0;t<n.alias.length;t++)if(n.alias[t].toLowerCase()==e)return n}return null}findByExtension(e){if(Array.isArray(e)){for(let t=0;t<e.length;t++){const n=this.findByExtension(e[t]);if(n)return n}return null}e=e.toLowerCase();for(let t=0;t<this._modeList.length;t++){let n=this._modeList[t];for(let t=0;t<n.extensions.length;t++)if(n.extensions[t].toLowerCase()==e)return n}return null}findByFileName(e){const t=et.PathExt.basename(e);for(let e=0;e<this._modeList.length;e++){let n=this._modeList[e];if(n.filename&&n.filename.test(t))return n}let n=t.lastIndexOf("."),i=n>-1&&t.substring(n+1,t.length);return i?this.findByExtension(i):null}findBest(e,t=!0){var n,i,s,r;const a="string"==typeof e?e:e.name,o="string"!=typeof e?e.mime:a,l="string"!=typeof e&&null!==(n=e.extensions)&&void 0!==n?n:[];return null!==(r=null!==(s=null!==(i=a?this.findByName(a):null)&&void 0!==i?i:o?this.findByMIME(o):null)&&void 0!==s?s:this.findByExtension(l))&&void 0!==r?r:t?this.findByMIME(Ze.N.defaultMimeType):null}async highlight(e,t,n){var i;t&&await this.getLanguage(t);const s=null===(i=null==t?void 0:t.support)||void 0===i?void 0:i.language;if(!s)return void n.appendChild(document.createTextNode(e));const r=s.parser.parse(e);let a=0;(0,je.bW)(r,Fi,((t,i,s)=>{t>a&&n.appendChild(document.createTextNode(e.slice(a,t)));const r=n.appendChild(document.createElement("span"));r.className=s,r.appendChild(document.createTextNode(e.slice(t,i))),a=i})),a<r.length-1&&n.appendChild(document.createTextNode(e.slice(a,r.length)))}makeSpec(e){let t=r.c6.of(e);return t.mime=e.mime,t.displayName=e.displayName,t}}!function(e){function t(e){return new r.ri(r.il.define(e))}async function i(e){const t=await n.e(8423).then(n.bind(n,48423));return t.sql({dialect:t[e]})}e.legacy=t,e.getDefaultLanguages=function(e){const s=(null!=e?e:Ee.nullTranslator).load("jupyterlab");return[{name:"C",displayName:s.__("C"),mime:"text/x-csrc",extensions:["c","h","ino"],load:async()=>(await n.e(5340).then(n.bind(n,35340))).cpp()},{name:"C++",displayName:s.__("C++"),mime:"text/x-c++src",extensions:["cpp","c++","cc","cxx","hpp","h++","hh","hxx"],load:async()=>(await n.e(5340).then(n.bind(n,35340))).cpp()},{name:"CQL",displayName:s.__("CQL"),mime:"text/x-cassandra",extensions:["cql"],load:()=>i("Cassandra")},{name:"CSS",displayName:s.__("CSS"),mime:"text/css",extensions:["css"],load:async()=>(await n.e(7664).then(n.bind(n,37664))).css()},{name:"HTML",displayName:s.__("HTML"),alias:["xhtml"],mime:"text/html",extensions:["html","htm","handlebars","hbs"],load:async()=>(await Promise.all([n.e(2318),n.e(7664),n.e(6510)]).then(n.bind(n,6510))).html()},{name:"Java",displayName:s.__("Java"),mime:"text/x-java",extensions:["java"],load:async()=>(await n.e(7529).then(n.bind(n,87529))).java()},{name:"Javascript",displayName:s.__("Javascript"),alias:["ecmascript","js","node"],mime:["text/javascript","text/ecmascript","application/javascript","application/x-javascript","application/ecmascript"],extensions:["js","mjs","cjs"],load:async()=>(await n.e(2318).then(n.bind(n,72318))).javascript()},{name:"JSON",displayName:s.__("JSON"),alias:["json5"],mime:["application/json","application/x-json"],extensions:["json","map"],load:async()=>(await n.e(2628).then(n.bind(n,32628))).json()},{name:"JSX",displayName:s.__("JSX"),mime:"text/jsx",extensions:["jsx"],load:async()=>(await n.e(2318).then(n.bind(n,72318))).javascript({jsx:!0})},{name:"MariaDB SQL",displayName:s.__("MariaDB SQL"),mime:"text/x-mariadb",load:()=>i("MariaSQL")},{name:"Markdown",displayName:s.__("Markdown"),mime:"text/x-markdown",extensions:["md","markdown","mkd"],async load(){return(await Promise.all([n.e(2318),n.e(7664),n.e(6510),n.e(8769)]).then(n.bind(n,38769))).markdown({codeLanguages:this._modeList})}},{name:"MS SQL",displayName:s.__("MS SQL"),mime:"text/x-mssql",load:()=>i("MSSQL")},{name:"MySQL",displayName:s.__("MySQL"),mime:"text/x-mysql",load:()=>i("MySQL")},{name:"PHP",displayName:s.__("PHP"),mime:["text/x-php","application/x-httpd-php","application/x-httpd-php-open"],extensions:["php","php3","php4","php5","php7","phtml"],load:async()=>(await Promise.all([n.e(2318),n.e(7664),n.e(6510),n.e(5148)]).then(n.bind(n,5148))).php()},{name:"PLSQL",displayName:s.__("PLSQL"),mime:"text/x-plsql",extensions:["pls"],load:()=>i("PLSQL")},{name:"PostgreSQL",displayName:s.__("PostgreSQL"),mime:"text/x-pgsql",load:()=>i("PostgreSQL")},{name:"Python",displayName:s.__("Python"),mime:"text/x-python",extensions:["BUILD","bzl","py","pyw"],filename:/^(BUCK|BUILD)$/,load:async()=>(await n.e(8138).then(n.bind(n,88138))).python()},{name:"ipython",displayName:s.__("ipython"),mime:"text/x-ipython",load:async()=>(await n.e(8138).then(n.bind(n,88138))).python()},{name:"Rust",displayName:s.__("Rust"),mime:"text/x-rustsrc",extensions:["rs"],load:async()=>(await n.e(5708).then(n.bind(n,55708))).rust()},{name:"SQL",displayName:s.__("SQL"),mime:"text/x-sql",extensions:["sql"],load:()=>i("StandardSQL")},{name:"SQLite",displayName:s.__("SQLite"),mime:"text/x-sqlite",load:()=>i("SQLite")},{name:"TSX",displayName:s.__("TSX"),alias:["TypeScript-JSX"],mime:"text/typescript-jsx",extensions:["tsx"],load:async()=>(await n.e(2318).then(n.bind(n,72318))).javascript({jsx:!0,typescript:!0})},{name:"TypeScript",displayName:s.__("TypeScript"),alias:["ts"],mime:"application/typescript",extensions:["ts"],load:async()=>(await n.e(2318).then(n.bind(n,72318))).javascript({typescript:!0})},{name:"WebAssembly",displayName:s.__("WebAssembly"),mime:"text/webassembly",extensions:["wat","wast"],load:async()=>(await n.e(8782).then(n.bind(n,78782))).wast()},{name:"XML",displayName:s.__("XML"),alias:["rss","wsdl","xsd"],mime:["application/xml","text/xml"],extensions:["xml","xsl","xsd","svg"],load:async()=>(await n.e(1746).then(n.bind(n,61746))).xml()},{name:"APL",displayName:s.__("APL"),mime:"text/apl",extensions:["dyalog","apl"],load:async()=>t((await n.e(1377).then(n.bind(n,31377))).apl)},{name:"PGP",displayName:s.__("PGP"),alias:["asciiarmor"],mime:["application/pgp","application/pgp-encrypted","application/pgp-keys","application/pgp-signature"],extensions:["asc","pgp","sig"],load:async()=>t((await n.e(7111).then(n.bind(n,37111))).asciiArmor)},{name:"ASN.1",displayName:s.__("ASN.1"),mime:"text/x-ttcn-asn",extensions:["asn","asn1"],load:async()=>t((await n.e(1580).then(n.bind(n,61580))).asn1({}))},{name:"Asterisk",displayName:s.__("Asterisk"),mime:"text/x-asterisk",filename:/^extensions\.conf$/i,load:async()=>t((await n.e(8877).then(n.bind(n,48877))).asterisk)},{name:"Brainfuck",displayName:s.__("Brainfuck"),mime:"text/x-brainfuck",extensions:["b","bf"],load:async()=>t((await n.e(5024).then(n.bind(n,75024))).brainfuck)},{name:"Cobol",displayName:s.__("Cobol"),mime:"text/x-cobol",extensions:["cob","cpy"],load:async()=>t((await n.e(7236).then(n.bind(n,87236))).cobol)},{name:"C#",displayName:s.__("C#"),alias:["csharp","cs"],mime:"text/x-csharp",extensions:["cs"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).csharp)},{name:"Clojure",displayName:s.__("Clojure"),mime:"text/x-clojure",extensions:["clj","cljc","cljx"],load:async()=>t((await n.e(4283).then(n.bind(n,94283))).clojure)},{name:"ClojureScript",displayName:s.__("ClojureScript"),mime:"text/x-clojurescript",extensions:["cljs"],load:async()=>t((await n.e(4283).then(n.bind(n,94283))).clojure)},{name:"Closure Stylesheets (GSS)",displayName:s.__("Closure Stylesheets (GSS)"),mime:"text/x-gss",extensions:["gss"],load:async()=>t((await n.e(7233).then(n.bind(n,97233))).gss)},{name:"CMake",displayName:s.__("CMake"),mime:"text/x-cmake",extensions:["cmake","cmake.in"],filename:/^CMakeLists\.txt$/,load:async()=>t((await n.e(4878).then(n.bind(n,4878))).cmake)},{name:"CoffeeScript",displayName:s.__("CoffeeScript"),alias:["coffee","coffee-script"],mime:["application/vnd.coffeescript","text/coffeescript","text/x-coffeescript"],extensions:["coffee"],load:async()=>t((await n.e(9036).then(n.bind(n,9036))).coffeeScript)},{name:"Common Lisp",displayName:s.__("Common Lisp"),alias:["lisp"],mime:"text/x-common-lisp",extensions:["cl","lisp","el"],load:async()=>t((await n.e(9172).then(n.bind(n,79172))).commonLisp)},{name:"Cypher",displayName:s.__("Cypher"),mime:"application/x-cypher-query",extensions:["cyp","cypher"],load:async()=>t((await n.e(9397).then(n.bind(n,9397))).cypher)},{name:"Cython",displayName:s.__("Cython"),mime:"text/x-cython",extensions:["pyx","pxd","pxi"],load:async()=>t((await n.e(4282).then(n.bind(n,74282))).cython)},{name:"Crystal",displayName:s.__("Crystal"),mime:"text/x-crystal",extensions:["cr"],load:async()=>t((await n.e(8803).then(n.bind(n,48803))).crystal)},{name:"D",displayName:s.__("D"),mime:"text/x-d",extensions:["d"],load:async()=>t((await n.e(504).then(n.bind(n,10504))).d)},{name:"Dart",displayName:s.__("Dart"),mime:["application/dart","text/x-dart"],extensions:["dart"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).dart)},{name:"diff",displayName:s.__("diff"),mime:"text/x-diff",extensions:["diff","patch"],load:async()=>t((await n.e(2563).then(n.bind(n,82563))).diff)},{name:"Dockerfile",displayName:s.__("Dockerfile"),mime:"text/x-dockerfile",filename:/^Dockerfile$/,load:async()=>t((await n.e(6835).then(n.bind(n,6835))).dockerFile)},{name:"DTD",displayName:s.__("DTD"),mime:"application/xml-dtd",extensions:["dtd"],load:async()=>t((await n.e(151).then(n.bind(n,60151))).dtd)},{name:"Dylan",displayName:s.__("Dylan"),mime:"text/x-dylan",extensions:["dylan","dyl","intr"],load:async()=>t((await n.e(7377).then(n.bind(n,57377))).dylan)},{name:"EBNF",displayName:s.__("EBNF"),mime:"text/x-ebnf",load:async()=>t((await n.e(5681).then(n.bind(n,65681))).ebnf)},{name:"ECL",displayName:s.__("ECL"),mime:"text/x-ecl",extensions:["ecl"],load:async()=>t((await n.e(5876).then(n.bind(n,85876))).ecl)},{name:"edn",displayName:s.__("edn"),mime:"application/edn",extensions:["edn"],load:async()=>t((await n.e(4283).then(n.bind(n,94283))).clojure)},{name:"Eiffel",displayName:s.__("Eiffel"),mime:"text/x-eiffel",extensions:["e"],load:async()=>t((await n.e(4403).then(n.bind(n,4403))).eiffel)},{name:"Elm",displayName:s.__("Elm"),mime:"text/x-elm",extensions:["elm"],load:async()=>t((await n.e(8866).then(n.bind(n,48866))).elm)},{name:"Erlang",displayName:s.__("Erlang"),mime:"text/x-erlang",extensions:["erl"],load:async()=>t((await n.e(2033).then(n.bind(n,72033))).erlang)},{name:"Esper",displayName:s.__("Esper"),mime:"text/x-esper",load:async()=>t((await n.e(6645).then(n.bind(n,16645))).esper)},{name:"Factor",displayName:s.__("Factor"),mime:"text/x-factor",extensions:["factor"],load:async()=>t((await n.e(360).then(n.bind(n,62502))).factor)},{name:"FCL",displayName:s.__("FCL"),mime:"text/x-fcl",load:async()=>t((await n.e(2100).then(n.bind(n,42100))).fcl)},{name:"Forth",displayName:s.__("Forth"),mime:"text/x-forth",extensions:["forth","fth","4th"],load:async()=>t((await n.e(7600).then(n.bind(n,47600))).forth)},{name:"Fortran",displayName:s.__("Fortran"),mime:"text/x-fortran",extensions:["f","for","f77","f90","f95"],load:async()=>t((await n.e(1222).then(n.bind(n,31222))).fortran)},{name:"F#",displayName:s.__("F#"),alias:["fsharp"],mime:"text/x-fsharp",extensions:["fs"],load:async()=>t((await n.e(5764).then(n.bind(n,95764))).fSharp)},{name:"Gas",displayName:s.__("Gas"),mime:"text/x-gas",extensions:["s"],load:async()=>t((await n.e(6151).then(n.bind(n,16151))).gas)},{name:"Gherkin",displayName:s.__("Gherkin"),mime:"text/x-feature",extensions:["feature"],load:async()=>t((await n.e(6196).then(n.bind(n,26196))).gherkin)},{name:"Go",displayName:s.__("Go"),mime:"text/x-go",extensions:["go"],load:async()=>t((await n.e(6186).then(n.bind(n,66186))).go)},{name:"Groovy",displayName:s.__("Groovy"),mime:"text/x-groovy",extensions:["groovy","gradle"],filename:/^Jenkinsfile$/,load:async()=>t((await n.e(1567).then(n.bind(n,71567))).groovy)},{name:"Haskell",displayName:s.__("Haskell"),mime:"text/x-haskell",extensions:["hs"],load:async()=>t((await n.e(4351).then(n.bind(n,64351))).haskell)},{name:"Haxe",displayName:s.__("Haxe"),mime:"text/x-haxe",extensions:["hx"],load:async()=>t((await n.e(6970).then(n.bind(n,26970))).haxe)},{name:"HXML",displayName:s.__("HXML"),mime:"text/x-hxml",extensions:["hxml"],load:async()=>t((await n.e(6970).then(n.bind(n,26970))).hxml)},{name:"HTTP",displayName:s.__("HTTP"),mime:"message/http",load:async()=>t((await n.e(2042).then(n.bind(n,82042))).http)},{name:"IDL",displayName:s.__("IDL"),mime:"text/x-idl",extensions:["pro"],load:async()=>t((await n.e(2185).then(n.bind(n,2185))).idl)},{name:"JSON-LD",displayName:s.__("JSON-LD"),alias:["jsonld"],mime:"application/ld+json",extensions:["jsonld"],load:async()=>t((await n.e(3211).then(n.bind(n,83211))).jsonld)},{name:"Jinja2",displayName:s.__("Jinja2"),mime:"text/jinja2",extensions:["j2","jinja","jinja2"],load:async()=>t((await n.e(386).then(n.bind(n,40386))).jinja2)},{name:"Julia",displayName:s.__("Julia"),mime:"text/x-julia",extensions:["jl"],load:async()=>t((await n.e(9473).then(n.bind(n,59473))).julia)},{name:"Kotlin",displayName:s.__("Kotlin"),mime:"text/x-kotlin",extensions:["kt"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).kotlin)},{name:"LESS",displayName:s.__("LESS"),mime:"text/x-less",extensions:["less"],load:async()=>t((await n.e(7233).then(n.bind(n,97233))).less)},{name:"LiveScript",displayName:s.__("LiveScript"),alias:["ls"],mime:"text/x-livescript",extensions:["ls"],load:async()=>t((await n.e(9672).then(n.bind(n,59672))).liveScript)},{name:"Lua",displayName:s.__("Lua"),mime:"text/x-lua",extensions:["lua"],load:async()=>t((await n.e(3466).then(n.bind(n,43466))).lua)},{name:"mIRC",displayName:s.__("mIRC"),mime:"text/mirc",load:async()=>t((await n.e(4476).then(n.bind(n,14476))).mirc)},{name:"Mathematica",displayName:s.__("Mathematica"),mime:"text/x-mathematica",extensions:["m","nb","wl","wls"],load:async()=>t((await n.e(4654).then(n.bind(n,29101))).mathematica)},{name:"Modelica",displayName:s.__("Modelica"),mime:"text/x-modelica",extensions:["mo"],load:async()=>t((await n.e(9636).then(n.bind(n,19636))).modelica)},{name:"MUMPS",displayName:s.__("MUMPS"),mime:"text/x-mumps",extensions:["mps"],load:async()=>t((await n.e(9715).then(n.bind(n,59715))).mumps)},{name:"mbox",displayName:s.__("mbox"),mime:"application/mbox",extensions:["mbox"],load:async()=>t((await n.e(8658).then(n.bind(n,88658))).mbox)},{name:"Nginx",displayName:s.__("Nginx"),mime:"text/x-nginx-conf",filename:/nginx.*\.conf$/i,load:async()=>t((await n.e(7882).then(n.bind(n,97882))).nginx)},{name:"NSIS",displayName:s.__("NSIS"),mime:"text/x-nsis",extensions:["nsh","nsi"],load:async()=>t((await n.e(9866).then(n.bind(n,9866))).nsis)},{name:"NTriples",displayName:s.__("NTriples"),mime:["application/n-triples","application/n-quads","text/n-triples"],extensions:["nt","nq"],load:async()=>t((await n.e(3206).then(n.bind(n,23206))).ntriples)},{name:"Objective-C",displayName:s.__("Objective-C"),alias:["objective-c","objc"],mime:"text/x-objectivec",extensions:["m"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).objectiveC)},{name:"Objective-C++",displayName:s.__("Objective-C++"),alias:["objective-c++","objc++"],mime:"text/x-objectivec++",extensions:["mm"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).objectiveCpp)},{name:"OCaml",displayName:s.__("OCaml"),mime:"text/x-ocaml",extensions:["ml","mli","mll","mly"],load:async()=>t((await n.e(5764).then(n.bind(n,95764))).oCaml)},{name:"Octave",displayName:s.__("Octave"),mime:"text/x-octave",extensions:["m"],load:async()=>t((await n.e(4073).then(n.bind(n,94073))).octave)},{name:"Oz",displayName:s.__("Oz"),mime:"text/x-oz",extensions:["oz"],load:async()=>t((await n.e(1403).then(n.bind(n,81403))).oz)},{name:"Pascal",displayName:s.__("Pascal"),mime:"text/x-pascal",extensions:["p","pas"],load:async()=>t((await n.e(5176).then(n.bind(n,55176))).pascal)},{name:"Perl",displayName:s.__("Perl"),mime:"text/x-perl",extensions:["pl","pm"],load:async()=>t((await n.e(3192).then(n.bind(n,73192))).perl)},{name:"Pig",displayName:s.__("Pig"),mime:"text/x-pig",extensions:["pig"],load:async()=>t((await n.e(7058).then(n.bind(n,27058))).pig)},{name:"PowerShell",displayName:s.__("PowerShell"),mime:"application/x-powershell",extensions:["ps1","psd1","psm1"],load:async()=>t((await n.e(7149).then(n.bind(n,97149))).powerShell)},{name:"Properties files",displayName:s.__("Properties files"),alias:["ini","properties"],mime:"text/x-properties",extensions:["properties","ini","in"],load:async()=>t((await n.e(231).then(n.bind(n,50231))).properties)},{name:"ProtoBuf",displayName:s.__("ProtoBuf"),mime:"text/x-protobuf",extensions:["proto"],load:async()=>t((await n.e(1278).then(n.bind(n,1278))).protobuf)},{name:"Puppet",displayName:s.__("Puppet"),mime:"text/x-puppet",extensions:["pp"],load:async()=>t((await n.e(5263).then(n.bind(n,5263))).puppet)},{name:"Q",displayName:s.__("Q"),mime:"text/x-q",extensions:["q"],load:async()=>t((await n.e(1286).then(n.bind(n,51286))).q)},{name:"R",displayName:s.__("R"),alias:["rscript"],mime:"text/x-rsrc",extensions:["r","R"],load:async()=>t((await n.e(4391).then(n.bind(n,4391))).r)},{name:"RPM Changes",displayName:s.__("RPM Changes"),mime:"text/x-rpm-changes",load:async()=>t((await n.e(1227).then(n.bind(n,91227))).rpmChanges)},{name:"RPM Spec",displayName:s.__("RPM Spec"),mime:"text/x-rpm-spec",extensions:["spec"],load:async()=>t((await n.e(1227).then(n.bind(n,91227))).rpmSpec)},{name:"Ruby",displayName:s.__("Ruby"),alias:["jruby","macruby","rake","rb","rbx"],mime:"text/x-ruby",extensions:["rb"],load:async()=>t((await n.e(4040).then(n.bind(n,54040))).ruby)},{name:"SAS",displayName:s.__("SAS"),mime:"text/x-sas",extensions:["sas"],load:async()=>t((await n.e(2488).then(n.bind(n,2488))).sas)},{name:"Scala",displayName:s.__("Scala"),mime:"text/x-scala",extensions:["scala"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).scala)},{name:"Scheme",displayName:s.__("Scheme"),mime:"text/x-scheme",extensions:["scm","ss"],load:async()=>t((await n.e(765).then(n.bind(n,10765))).scheme)},{name:"SCSS",displayName:s.__("SCSS"),mime:"text/x-scss",extensions:["scss"],load:async()=>t((await n.e(7233).then(n.bind(n,97233))).sCSS)},{name:"Shell",displayName:s.__("Shell"),alias:["bash","sh","zsh"],mime:["text/x-sh","application/x-sh"],extensions:["sh","ksh","bash"],filename:/^PKGBUILD$/,load:async()=>t((await n.e(9472).then(n.bind(n,49472))).shell)},{name:"Sieve",displayName:s.__("Sieve"),mime:"application/sieve",extensions:["siv","sieve"],load:async()=>t((await n.e(2284).then(n.bind(n,22284))).sieve)},{name:"Smalltalk",displayName:s.__("Smalltalk"),mime:"text/x-stsrc",extensions:["st"],load:async()=>t((await n.e(7498).then(n.bind(n,57498))).smalltalk)},{name:"Solr",displayName:s.__("Solr"),mime:"text/x-solr",load:async()=>t((await n.e(3191).then(n.bind(n,43191))).solr)},{name:"SML",displayName:s.__("SML"),mime:"text/x-sml",extensions:["sml","sig","fun","smackspec"],load:async()=>t((await n.e(5764).then(n.bind(n,95764))).sml)},{name:"SPARQL",displayName:s.__("SPARQL"),alias:["sparul"],mime:"application/sparql-query",extensions:["rq","sparql"],load:async()=>t((await n.e(8953).then(n.bind(n,18953))).sparql)},{name:"Spreadsheet",displayName:s.__("Spreadsheet"),alias:["excel","formula"],mime:"text/x-spreadsheet",load:async()=>t((await n.e(5223).then(n.bind(n,25223))).spreadsheet)},{name:"Squirrel",displayName:s.__("Squirrel"),mime:"text/x-squirrel",extensions:["nut"],load:async()=>t((await n.e(4982).then(n.bind(n,94982))).squirrel)},{name:"Stylus",displayName:s.__("Stylus"),mime:"text/x-styl",extensions:["styl"],load:async()=>t((await n.e(274).then(n.bind(n,40274))).stylus)},{name:"Swift",displayName:s.__("Swift"),mime:"text/x-swift",extensions:["swift"],load:async()=>t((await n.e(4024).then(n.bind(n,4024))).swift)},{name:"sTeX",displayName:s.__("sTeX"),mime:"text/x-stex",load:async()=>t((await n.e(5513).then(n.bind(n,55513))).stex)},{name:"LaTeX",displayName:s.__("LaTeX"),alias:["tex"],mime:"text/x-latex",extensions:["text","ltx","tex"],load:async()=>t((await n.e(5513).then(n.bind(n,55513))).stex)},{name:"SystemVerilog",displayName:s.__("SystemVerilog"),mime:"text/x-systemverilog",extensions:["v","sv","svh"],load:async()=>t((await n.e(819).then(n.bind(n,20819))).verilog)},{name:"Tcl",displayName:s.__("Tcl"),mime:"text/x-tcl",extensions:["tcl"],load:async()=>t((await n.e(1623).then(n.bind(n,41623))).tcl)},{name:"Textile",displayName:s.__("Textile"),mime:"text/x-textile",extensions:["textile"],load:async()=>t((await n.e(9304).then(n.bind(n,49304))).textile)},{name:"TiddlyWiki",displayName:s.__("TiddlyWiki"),mime:"text/x-tiddlywiki",load:async()=>t((await n.e(6146).then(n.bind(n,96146))).tiddlyWiki)},{name:"Tiki wiki",displayName:s.__("Tiki wiki"),mime:"text/tiki",load:async()=>t((await n.e(9932).then(n.bind(n,39932))).tiki)},{name:"TOML",displayName:s.__("TOML"),mime:"text/x-toml",extensions:["toml"],load:async()=>t((await n.e(5556).then(n.bind(n,75556))).toml)},{name:"troff",displayName:s.__("troff"),mime:"text/troff",extensions:["1","2","3","4","5","6","7","8","9"],load:async()=>t((await n.e(9308).then(n.bind(n,39308))).troff)},{name:"TTCN",displayName:s.__("TTCN"),mime:"text/x-ttcn",extensions:["ttcn","ttcn3","ttcnpp"],load:async()=>t((await n.e(7710).then(n.bind(n,7710))).ttcn)},{name:"TTCN_CFG",displayName:s.__("TTCN_CFG"),mime:"text/x-ttcn-cfg",extensions:["cfg"],load:async()=>t((await n.e(9827).then(n.bind(n,9827))).ttcnCfg)},{name:"Turtle",displayName:s.__("Turtle"),mime:"text/turtle",extensions:["ttl"],load:async()=>t((await n.e(5393).then(n.bind(n,15393))).turtle)},{name:"Web IDL",displayName:s.__("Web IDL"),mime:"text/x-webidl",extensions:["webidl"],load:async()=>t((await n.e(9583).then(n.bind(n,89583))).webIDL)},{name:"VB.NET",displayName:s.__("VB.NET"),mime:"text/x-vb",extensions:["vb"],load:async()=>t((await n.e(3500).then(n.bind(n,43500))).vb)},{name:"VBScript",displayName:s.__("VBScript"),mime:"text/vbscript",extensions:["vbs"],load:async()=>t((await n.e(3159).then(n.bind(n,43159))).vbScript)},{name:"Velocity",displayName:s.__("Velocity"),mime:"text/velocity",extensions:["vtl"],load:async()=>t((await n.e(9319).then(n.bind(n,39319))).velocity)},{name:"Verilog",displayName:s.__("Verilog"),mime:"text/x-verilog",extensions:["v"],load:async()=>t((await n.e(819).then(n.bind(n,20819))).verilog)},{name:"VHDL",displayName:s.__("VHDL"),mime:"text/x-vhdl",extensions:["vhd","vhdl"],load:async()=>t((await n.e(7294).then(n.bind(n,7294))).vhdl)},{name:"XQuery",displayName:s.__("XQuery"),mime:"application/xquery",extensions:["xy","xquery"],load:async()=>t((await n.e(13).then(n.bind(n,70013))).xQuery)},{name:"Yacas",displayName:s.__("Yacas"),mime:"text/x-yacas",extensions:["ys"],load:async()=>t((await n.e(6410).then(n.bind(n,26410))).yacas)},{name:"YAML",displayName:s.__("YAML"),alias:["yml"],mime:["text/x-yaml","text/yaml"],extensions:["yaml","yml"],load:async()=>t((await n.e(5002).then(n.bind(n,19411))).yaml)},{name:"Z80",displayName:s.__("Z80"),mime:"text/x-z80",extensions:["z80"],load:async()=>t((await n.e(4702).then(n.bind(n,14702))).z80)},{name:"mscgen",displayName:s.__("mscgen"),mime:"text/x-mscgen",extensions:["mscgen","mscin","msc"],load:async()=>t((await n.e(5225).then(n.bind(n,5225))).mscgen)},{name:"xu",displayName:s.__("xu"),mime:"text/x-xu",extensions:["xu"],load:async()=>t((await n.e(5225).then(n.bind(n,5225))).xu)},{name:"msgenny",displayName:s.__("msgenny"),mime:"text/x-msgenny",extensions:["msgenny"],load:async()=>t((await n.e(5225).then(n.bind(n,5225))).msgenny)}]}}(Vi||(Vi={}));class Gi{constructor(e){var t,n,r,a,o,l;this.edgeRequested=new Ce.Signal(this),this._isDisposed=!1,this._language=new i.Compartment,this._uuid="",this._languages=null!==(t=e.languages)&&void 0!==t?t:new Vi,this._configurator=null!==(a=null===(n=e.extensionsRegistry)||void 0===n?void 0:n.createNew({...e,inline:null!==(r=e.inline)&&void 0!==r&&r}))&&void 0!==a?a:new Xe;const c=this.host=e.host;c.classList.add("jp-CodeMirrorEditor"),c.classList.add("jp-Editor"),c.addEventListener("focus",this,!0),c.addEventListener("blur",this,!0),c.addEventListener("scroll",this,!0),this._uuid=null!==(o=e.uuid)&&void 0!==o?o:Se.UUID.uuid4();const h=this._model=e.model,u=s.EditorView.domEventHandlers({keydown:(e,t)=>this.onKeydown(e)}),d=s.EditorView.updateListener.of((e=>{this._onDocChanged(e)}));this._editor=Ui.createEditor(c,this._configurator,[i.Prec.high(u),d,this._language.of([]),...null!==(l=e.extensions)&&void 0!==l?l:[]],h.sharedModel.source),this._onMimeTypeChanged(),this._onCursorActivity(),this._configurator.configChanged.connect(this.onConfigChanged,this),h.mimeTypeChanged.connect(this._onMimeTypeChanged,this)}get uuid(){return this._uuid}set uuid(e){this._uuid=e}get editor(){return this._editor}get doc(){return this._editor.state.doc}get lineCount(){return this.doc.lines}get model(){return this._model}get lineHeight(){return this._editor.defaultLineHeight}get charWidth(){return this._editor.defaultCharacterWidth}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.host.removeEventListener("focus",this,!0),this.host.removeEventListener("blur",this,!0),this.host.removeEventListener("scroll",this,!0),this._configurator.dispose(),Ce.Signal.clearData(this),this.editor.destroy())}getOption(e){return this._configurator.getOption(e)}hasOption(e){return this._configurator.hasOption(e)}setOption(e,t){this._configurator.setOption(e,t)}setOptions(e){this._configurator.setOptions(e)}injectExtension(e){this._configurator.injectExtension(this._editor,e)}getLine(e){return(e+=1)<=this.doc.lines?this.doc.line(e).text:void 0}getOffsetAt(e){return this.doc.line(e.line+1).from+e.column}getPositionAt(e){const t=this.doc.lineAt(e);return{line:t.number-1,column:e-t.from}}undo(){this.model.sharedModel.undo()}redo(){this.model.sharedModel.redo()}clearHistory(){this.model.sharedModel.clearUndoHistory()}focus(){this._editor.focus()}hasFocus(){return this._editor.hasFocus}blur(){this._editor.contentDOM.blur()}get state(){return this._editor.state}firstLine(){return 0}lastLine(){return this.doc.lines-1}cursorCoords(e,t){const n=this.state.selection.main,i=e?n.from:n.to;return this.editor.coordsAtPos(i)}getRange(e,t,n){const i=this.getOffsetAt(this._toPosition(e)),s=this.getOffsetAt(this._toPosition(t));return this.state.sliceDoc(i,s)}revealPosition(e){const t=this.getOffsetAt(e);this._editor.dispatch({effects:s.EditorView.scrollIntoView(t)})}revealSelection(e){const t=this.getOffsetAt(e.start),n=this.getOffsetAt(e.end);this._editor.dispatch({effects:s.EditorView.scrollIntoView(i.EditorSelection.range(t,n))})}getCoordinateForPosition(e){const t=this.getOffsetAt(e);return this.editor.coordsAtPos(t)}getPositionForCoordinate(e){const t=this.editor.posAtCoords({x:e.left,y:e.top});return this.getPositionAt(t)||null}getCursorPosition(){const e=this.state.selection.main.head;return this.getPositionAt(e)}setCursorPosition(e,t){const n=this.getOffsetAt(e);this.editor.dispatch({selection:{anchor:n},scrollIntoView:!0}),this.editor.hasFocus||this.model.selections.set(this.uuid,this.getSelections())}getSelection(){return this.getSelections()[0]}setSelection(e){this.setSelections([e])}getSelections(){const e=this.state.selection.ranges;if(e.length>0)return e.map((e=>({anchor:this._toCodeMirrorPosition(this.getPositionAt(e.from)),head:this._toCodeMirrorPosition(this.getPositionAt(e.to))}))).map((e=>this._toSelection(e)));const t=this._toCodeMirrorPosition(this.getPositionAt(this.state.selection.main.head));return[this._toSelection({anchor:t,head:t})]}setSelections(e){const t=e.length?e.map((e=>i.EditorSelection.range(this.getOffsetAt(e.start),this.getOffsetAt(e.end)))):[i.EditorSelection.range(0,0)];this.editor.dispatch({selection:i.EditorSelection.create(t)})}replaceSelection(e){const t=this.getSelections()[0];this.model.sharedModel.updateSource(this.getOffsetAt(t.start),this.getOffsetAt(t.end),e);const n=this.getPositionAt(this.getOffsetAt(t.start)+e.length);this.setSelection({start:n,end:n})}getTokens(){const e=[],t=(0,r.l)(this.state,this.doc.length);return t&&t.iterate({enter:t=>(null===t.node.firstChild&&e.push({value:this.state.sliceDoc(t.from,t.to),offset:t.from,type:t.name}),!0)}),e}getTokenAt(e){const t=(0,r.l)(this.state,e);let n=null;return t&&t.iterate({enter:t=>!(n||!t.node.firstChild&&e>=t.from&&e<=t.to&&(n={value:this.state.sliceDoc(t.from,t.to),offset:t.from,type:t.name},1))}),n||{offset:e,value:""}}getTokenAtCursor(){return this.getTokenAt(this.state.selection.main.head)}newIndentedLine(){xe({state:this.state,dispatch:this.editor.dispatch})}execCommand(e){e(this.editor)}onConfigChanged(e,t){e.reconfigureExtensions(this._editor,t)}onKeydown(e){const t=this.state.selection.main.head;return 0===t&&38===e.keyCode?(e.shiftKey||this.edgeRequested.emit("top"),!1):1===this.doc.lineAt(t).number&&38===e.keyCode?(e.shiftKey||this.edgeRequested.emit("topLine"),!1):t===this.doc.length&&40===e.keyCode&&(e.shiftKey||this.edgeRequested.emit("bottom"),!1)}_onMimeTypeChanged(){this._languages.getLanguage(this._model.mimeType).then((e=>{var t;this._editor.dispatch({effects:this._language.reconfigure(null!==(t=null==e?void 0:e.support)&&void 0!==t?t:[])})})).catch((e=>{console.log(`Failed to load language for '${this._model.mimeType}'.`,e),this._editor.dispatch({effects:this._language.reconfigure([])})}))}_onCursorActivity(){if(this._editor.hasFocus){const e=this.getSelections();this.model.selections.set(this.uuid,e)}}_toSelection(e){return{uuid:this.uuid,start:this._toPosition(e.anchor),end:this._toPosition(e.head)}}_toPosition(e){return{line:e.line,column:e.ch}}_toCodeMirrorPosition(e){return{line:e.line,ch:e.column}}_onDocChanged(e){e.transactions.length&&e.transactions[0].selection&&this._onCursorActivity()}handleEvent(e){switch(e.type){case"focus":this._evtFocus(e);break;case"blur":this._evtBlur(e)}}_evtFocus(e){this.host.classList.add("jp-mod-focused"),this._onCursorActivity()}_evtBlur(e){this.host.classList.remove("jp-mod-focused")}}var Ui;function Wi(){var e=arguments[0];"string"==typeof e&&(e=document.createElement(e));var t=1,n=arguments[1];if(n&&"object"==typeof n&&null==n.nodeType&&!Array.isArray(n)){for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)){var s=n[i];"string"==typeof s?e.setAttribute(i,s):null!=s&&(e[i]=s)}t++}for(;t<arguments.length;t++)Qi(e,arguments[t]);return e}function Qi(e,t){if("string"==typeof t)e.appendChild(document.createTextNode(t));else if(null==t);else if(null!=t.nodeType)e.appendChild(t);else{if(!Array.isArray(t))throw new RangeError("Unsupported child node: "+t);for(var n=0;n<t.length;n++)Qi(e,t[n])}}!function(e){e.createEditor=function(e,t,n,r){const a=t.getInitialExtensions();return a.push(...n),new s.EditorView({state:i.EditorState.create({doc:r,extensions:a}),parent:e})}}(Ui||(Ui={}));const Yi="function"==typeof String.prototype.normalize?e=>e.normalize("NFKD"):e=>e;class Xi{constructor(e,t,n=0,i=e.length,s,r){this.test=r,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,i),this.bufferStart=n,this.normalize=s?e=>s(Yi(e)):Yi,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return(0,i.codePointAt)(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=(0,i.fromCodePoint)(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=(0,i.codePointSize)(e);let s=this.normalize(t);for(let e=0,i=n;;e++){let r=s.charCodeAt(e),a=this.match(r,i);if(a)return this.value=a,this;if(e==s.length-1)break;i==n&&e<t.length&&t.charCodeAt(e)==r&&i++}}}match(e,t){let n=null;for(let i=0;i<this.matches.length;i+=2){let s=this.matches[i],r=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?n={from:this.matches[i+1],to:t+1}:(this.matches[i]++,r=!0)),r||(this.matches.splice(i,2),i-=2)}return this.query.charCodeAt(0)==e&&(1==this.query.length?n={from:t,to:t+1}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferPos)&&(n=null),n}}"undefined"!=typeof Symbol&&(Xi.prototype[Symbol.iterator]=function(){return this});const Ki={from:-1,to:-1,match:/.*/.exec("")},Zi="gm"+(null==/x/.unicode?"":"u");class es{constructor(e,t,n,i=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=Ki,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new is(e,t,n,i,s);this.re=new RegExp(t,Zi+((null==n?void 0:n.ignoreCase)?"i":"")),this.test=null==n?void 0:n.test,this.iter=e.iter();let r=e.lineAt(i);this.curLineStart=r.from,this.matchPos=ss(e,i),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,i=n+t[0].length;if(this.matchPos=ss(this.text,i+(n==i?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<i||n>this.value.to)&&(!this.test||this.test(n,i,t)))return this.value={from:n,to:i,match:t},this;e=this.matchPos-this.curLineStart}else{if(!(this.curLineStart+this.curLine.length<this.to))return this.done=!0,this;this.nextLine(),e=0}}}}const ts=new WeakMap;class ns{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,n){let i=ts.get(e);if(!i||i.from>=n||i.to<=t){let i=new ns(t,e.sliceString(t,n));return ts.set(e,i),i}if(i.from==t&&i.to==n)return i;let{text:s,from:r}=i;return r>t&&(s=e.sliceString(t,r)+s,r=t),i.to<n&&(s+=e.sliceString(i.to,n)),ts.set(e,new ns(r,s)),new ns(t,s.slice(t-r,n-r))}}class is{constructor(e,t,n,i,s){this.text=e,this.to=s,this.done=!1,this.value=Ki,this.matchPos=ss(e,i),this.re=new RegExp(t,Zi+((null==n?void 0:n.ignoreCase)?"i":"")),this.test=null==n?void 0:n.test,this.flat=ns.get(e,i,this.chunkEnd(i+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let e=this.flat.from+t.index,n=e+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(e,n,t)))return this.value={from:e,to:n,match:t},this.matchPos=ss(this.text,n+(e==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=ns.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+2*this.flat.text.length))}}}function ss(e,t){if(t>=e.length)return t;let n,i=e.lineAt(t);for(;t<i.to&&(n=i.text.charCodeAt(t-i.from))>=56320&&n<57344;)t++;return t}function rs(e){let t=Wi("input",{class:"cm-textfield",name:"line"});function n(){let n=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!n)return;let{state:s}=e,r=s.doc.lineAt(s.selection.main.head),[,a,o,l,c]=n,h=l?+l.slice(1):0,u=o?+o:r.number;if(o&&c){let e=u/100;a&&(e=e*("-"==a?-1:1)+r.number/s.doc.lines),u=Math.round(s.doc.lines*e)}else o&&a&&(u=u*("-"==a?-1:1)+r.number);let d=s.doc.line(Math.max(1,Math.min(s.doc.lines,u)));e.dispatch({effects:as.of(!1),selection:i.EditorSelection.cursor(d.from+Math.max(0,Math.min(h,d.length))),scrollIntoView:!0}),e.focus()}return{dom:Wi("form",{class:"cm-gotoLine",onkeydown:t=>{27==t.keyCode?(t.preventDefault(),e.dispatch({effects:as.of(!1)}),e.focus()):13==t.keyCode&&(t.preventDefault(),n())},onsubmit:e=>{e.preventDefault(),n()}},Wi("label",e.state.phrase("Go to line"),": ",t)," ",Wi("button",{class:"cm-button",type:"submit"},e.state.phrase("go")))}}"undefined"!=typeof Symbol&&(es.prototype[Symbol.iterator]=is.prototype[Symbol.iterator]=function(){return this});const as=i.StateEffect.define(),os=i.StateField.define({create:()=>!0,update(e,t){for(let n of t.effects)n.is(as)&&(e=n.value);return e},provide:e=>s.showPanel.from(e,(e=>e?rs:null))}),ls=s.EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),cs=i.Facet.define({combine:e=>(0,i.combineConfig)(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Ds(e),scrollToMatch:e=>s.EditorView.scrollIntoView(e)})});class hs{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||function(e){try{return new RegExp(e,Zi),!0}catch(e){return!1}}(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,((e,t)=>"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"))}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new xs(this):new ms(this)}getCursor(e,t=0,n){let s=e.doc?e:i.EditorState.create({doc:e});return null==n&&(n=s.doc.length),this.regexp?ps(this,s,t,n):ds(this,s,t,n)}}class us{constructor(e){this.spec=e}}function ds(e,t,n,s){return new Xi(t.doc,e.unquoted,n,s,e.caseSensitive?void 0:e=>e.toLowerCase(),e.wholeWord?(r=t.doc,a=t.charCategorizer(t.selection.main.head),(e,t,n,s)=>((s>e||s+n.length<t)&&(s=Math.max(0,e-2),n=r.sliceString(s,Math.min(r.length,t+2))),!(a(fs(n,e-s))==i.CharCategory.Word&&a(gs(n,e-s))==i.CharCategory.Word||a(gs(n,t-s))==i.CharCategory.Word&&a(fs(n,t-s))==i.CharCategory.Word))):void 0);var r,a}class ms extends us{constructor(e){super(e)}nextMatch(e,t,n){let i=ds(this.spec,e,n,e.doc.length).nextOverlapping();return i.done&&(i=ds(this.spec,e,0,t).nextOverlapping()),i.done?null:i.value}prevMatchInRange(e,t,n){for(let i=n;;){let n=Math.max(t,i-1e4-this.spec.unquoted.length),s=ds(this.spec,e,n,i),r=null;for(;!s.nextOverlapping().done;)r=s.value;if(r)return r;if(n==t)return null;i-=1e4}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let n=ds(this.spec,e,0,e.doc.length),i=[];for(;!n.next().done;){if(i.length>=t)return null;i.push(n.value)}return i}highlight(e,t,n,i){let s=ds(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)i(s.value.from,s.value.to)}}function ps(e,t,n,s){return new es(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?(r=t.charCategorizer(t.selection.main.head),(e,t,n)=>!n[0].length||(r(fs(n.input,n.index))!=i.CharCategory.Word||r(gs(n.input,n.index))!=i.CharCategory.Word)&&(r(gs(n.input,n.index+n[0].length))!=i.CharCategory.Word||r(fs(n.input,n.index+n[0].length))!=i.CharCategory.Word)):void 0},n,s);var r}function fs(e,t){return e.slice((0,i.findClusterBreak)(e,t,!1),t)}function gs(e,t){return e.slice(t,(0,i.findClusterBreak)(e,t))}class xs extends us{nextMatch(e,t,n){let i=ps(this.spec,e,n,e.doc.length).next();return i.done&&(i=ps(this.spec,e,0,t).next()),i.done?null:i.value}prevMatchInRange(e,t,n){for(let i=1;;i++){let s=Math.max(t,n-1e4*i),r=ps(this.spec,e,s,n),a=null;for(;!r.next().done;)a=r.value;if(a&&(s==t||a.from>s+10))return a;if(s==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace.replace(/\$([$&\d+])/g,((t,n)=>"$"==n?"$":"&"==n?e.match[0]:"0"!=n&&+n<e.match.length?e.match[n]:t)))}matchAll(e,t){let n=ps(this.spec,e,0,e.doc.length),i=[];for(;!n.next().done;){if(i.length>=t)return null;i.push(n.value)}return i}highlight(e,t,n,i){let s=ps(this.spec,e,Math.max(0,t-250),Math.min(n+250,e.doc.length));for(;!s.next().done;)i(s.value.from,s.value.to)}}const ys=i.StateEffect.define(),bs=i.StateEffect.define(),_s=i.StateField.define({create:e=>new vs(Ts(e).create(),null),update(e,t){for(let n of t.effects)n.is(ys)?e=new vs(n.value.create(),e.panel):n.is(bs)&&(e=new vs(e.query,n.value?js:null));return e},provide:e=>s.showPanel.from(e,(e=>e.panel))});class vs{constructor(e,t){this.query=e,this.panel=t}}const ws=s.Decoration.mark({class:"cm-searchMatch"}),ks=s.Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Ss=s.ViewPlugin.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(_s))}update(e){let t=e.state.field(_s);(t!=e.startState.field(_s)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return s.Decoration.none;let{view:n}=this,r=new i.RangeSetBuilder;for(let t=0,i=n.visibleRanges,s=i.length;t<s;t++){let{from:a,to:o}=i[t];for(;t<s-1&&o>i[t+1].from-500;)o=i[++t].to;e.highlight(n.state,a,o,((e,t)=>{let i=n.state.selection.ranges.some((n=>n.from==e&&n.to==t));r.add(e,t,i?ks:ws)}))}return r.finish()}},{decorations:e=>e.decorations});function Cs(e){return t=>{let n=t.state.field(_s,!1);return n&&n.query.spec.valid?e(t,n):Is(t)}}const Ns=Cs(((e,{query:t})=>{let{to:n}=e.state.selection.main,s=t.nextMatch(e.state,n,n);if(!s)return!1;let r=i.EditorSelection.single(s.from,s.to),a=e.state.facet(cs);return e.dispatch({selection:r,effects:[Fs(e,s),a.scrollToMatch(r.main,e)],userEvent:"select.search"}),$s(e),!0})),Es=Cs(((e,{query:t})=>{let{state:n}=e,{from:s}=n.selection.main,r=t.prevMatch(n,s,s);if(!r)return!1;let a=i.EditorSelection.single(r.from,r.to),o=e.state.facet(cs);return e.dispatch({selection:a,effects:[Fs(e,r),o.scrollToMatch(a.main,e)],userEvent:"select.search"}),$s(e),!0})),As=Cs(((e,{query:t})=>{let n=t.matchAll(e.state,1e3);return!(!n||!n.length||(e.dispatch({selection:i.EditorSelection.create(n.map((e=>i.EditorSelection.range(e.from,e.to)))),userEvent:"select.search.matches"}),0))})),Ms=Cs(((e,{query:t})=>{let{state:n}=e,{from:r,to:a}=n.selection.main;if(n.readOnly)return!1;let o=t.nextMatch(n,r,r);if(!o)return!1;let l,c,h=[],u=[];if(o.from==r&&o.to==a&&(c=n.toText(t.getReplacement(o)),h.push({from:o.from,to:o.to,insert:c}),o=t.nextMatch(n,o.from,o.to),u.push(s.EditorView.announce.of(n.phrase("replaced match on line $",n.doc.lineAt(r).number)+"."))),o){let t=0==h.length||h[0].from>=o.to?0:o.to-o.from-c.length;l=i.EditorSelection.single(o.from-t,o.to-t),u.push(Fs(e,o)),u.push(n.facet(cs).scrollToMatch(l.main,e))}return e.dispatch({changes:h,selection:l,effects:u,userEvent:"input.replace"}),!0})),Os=Cs(((e,{query:t})=>{if(e.state.readOnly)return!1;let n=t.matchAll(e.state,1e9).map((e=>{let{from:n,to:i}=e;return{from:n,to:i,insert:t.getReplacement(e)}}));if(!n.length)return!1;let i=e.state.phrase("replaced $ matches",n.length)+".";return e.dispatch({changes:n,effects:s.EditorView.announce.of(i),userEvent:"input.replace.all"}),!0}));function js(e){return e.state.facet(cs).createPanel(e)}function Ts(e,t){var n,i,s,r,a;let o=e.selection.main,l=o.empty||o.to>o.from+100?"":e.sliceDoc(o.from,o.to);if(t&&!l)return t;let c=e.facet(cs);return new hs({search:(null!==(n=null==t?void 0:t.literal)&&void 0!==n?n:c.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:null!==(i=null==t?void 0:t.caseSensitive)&&void 0!==i?i:c.caseSensitive,literal:null!==(s=null==t?void 0:t.literal)&&void 0!==s?s:c.literal,regexp:null!==(r=null==t?void 0:t.regexp)&&void 0!==r?r:c.regexp,wholeWord:null!==(a=null==t?void 0:t.wholeWord)&&void 0!==a?a:c.wholeWord})}function Ps(e){let t=(0,s.getPanel)(e,js);return t&&t.dom.querySelector("[main-field]")}function $s(e){let t=Ps(e);t&&t==e.root.activeElement&&t.select()}const Is=e=>{let t=e.state.field(_s,!1);if(t&&t.panel){let n=Ps(e);if(n&&n!=e.root.activeElement){let i=Ts(e.state,t.query.spec);i.valid&&e.dispatch({effects:ys.of(i)}),n.focus(),n.select()}}else e.dispatch({effects:[bs.of(!0),t?ys.of(Ts(e.state,t.query.spec)):i.StateEffect.appendConfig.of(Hs)]});return!0},Rs=e=>{let t=e.state.field(_s,!1);if(!t||!t.panel)return!1;let n=(0,s.getPanel)(e,js);return n&&n.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:bs.of(!1)}),!0},Ls=[{key:"Mod-f",run:Is,scope:"editor search-panel"},{key:"F3",run:Ns,shift:Es,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Ns,shift:Es,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Rs,scope:"editor search-panel"},{key:"Mod-Shift-l",run:({state:e,dispatch:t})=>{let n=e.selection;if(n.ranges.length>1||n.main.empty)return!1;let{from:s,to:r}=n.main,a=[],o=0;for(let t=new Xi(e.doc,e.sliceDoc(s,r));!t.next().done;){if(a.length>1e3)return!1;t.value.from==s&&(o=a.length),a.push(i.EditorSelection.range(t.value.from,t.value.to))}return t(e.update({selection:i.EditorSelection.create(a,o),userEvent:"select.search.matches"})),!0}},{key:"Alt-g",run:e=>{let t=(0,s.getPanel)(e,rs);if(!t){let n=[as.of(!0)];null==e.state.field(os,!1)&&n.push(i.StateEffect.appendConfig.of([os,ls])),e.dispatch({effects:n}),t=(0,s.getPanel)(e,rs)}return t&&t.dom.querySelector("input").focus(),!0}},{key:"Mod-d",run:({state:e,dispatch:t})=>{let{ranges:n}=e.selection;if(n.some((e=>e.from===e.to)))return(({state:e,dispatch:t})=>{let{selection:n}=e,s=i.EditorSelection.create(n.ranges.map((t=>e.wordAt(t.head)||i.EditorSelection.cursor(t.head))),n.mainIndex);return!s.eq(n)&&(t(e.update({selection:s})),!0)})({state:e,dispatch:t});let r=e.sliceDoc(n[0].from,n[0].to);if(e.selection.ranges.some((t=>e.sliceDoc(t.from,t.to)!=r)))return!1;let a=function(e,t){let{main:n,ranges:i}=e.selection,s=e.wordAt(n.head),r=s&&s.from==n.from&&s.to==n.to;for(let n=!1,s=new Xi(e.doc,t,i[i.length-1].to);;){if(s.next(),!s.done){if(n&&i.some((e=>e.from==s.value.from)))continue;if(r){let t=e.wordAt(s.value.from);if(!t||t.from!=s.value.from||t.to!=s.value.to)continue}return s.value}if(n)return null;s=new Xi(e.doc,t,0,Math.max(0,i[i.length-1].from-1)),n=!0}}(e,r);return!!a&&(t(e.update({selection:e.selection.addRange(i.EditorSelection.range(a.from,a.to),!1),effects:s.EditorView.scrollIntoView(a.to)})),!0)},preventDefault:!0}];class Ds{constructor(e){this.view=e;let t=this.query=e.state.field(_s).query.spec;function n(e,t,n){return Wi("button",{class:"cm-button",name:e,onclick:t,type:"button"},n)}this.commit=this.commit.bind(this),this.searchField=Wi("input",{value:t.search,placeholder:qs(e,"Find"),"aria-label":qs(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=Wi("input",{value:t.replace,placeholder:qs(e,"Replace"),"aria-label":qs(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=Wi("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=Wi("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=Wi("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit}),this.dom=Wi("div",{onkeydown:e=>this.keydown(e),class:"cm-search"},[this.searchField,n("next",(()=>Ns(e)),[qs(e,"next")]),n("prev",(()=>Es(e)),[qs(e,"previous")]),n("select",(()=>As(e)),[qs(e,"all")]),Wi("label",null,[this.caseField,qs(e,"match case")]),Wi("label",null,[this.reField,qs(e,"regexp")]),Wi("label",null,[this.wordField,qs(e,"by word")]),...e.state.readOnly?[]:[Wi("br"),this.replaceField,n("replace",(()=>Ms(e)),[qs(e,"replace")]),n("replaceAll",(()=>Os(e)),[qs(e,"replace all")])],Wi("button",{name:"close",onclick:()=>Rs(e),"aria-label":qs(e,"close"),type:"button"},["×"])])}commit(){let e=new hs({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:ys.of(e)}))}keydown(e){(0,s.runScopeHandlers)(this.view,e,"search-panel")?e.preventDefault():13==e.keyCode&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?Es:Ns)(this.view)):13==e.keyCode&&e.target==this.replaceField&&(e.preventDefault(),Ms(this.view))}update(e){for(let t of e.transactions)for(let e of t.effects)e.is(ys)&&!e.value.eq(this.query)&&this.setQuery(e.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(cs).top}}function qs(e,t){return e.state.phrase(t)}const Bs=30,zs=/[\s\.,:;?!]/;function Fs(e,{from:t,to:n}){let i=e.state.doc.lineAt(t),r=e.state.doc.lineAt(n).to,a=Math.max(i.from,t-Bs),o=Math.min(r,n+Bs),l=e.state.sliceDoc(a,o);if(a!=i.from)for(let e=0;e<Bs;e++)if(!zs.test(l[e+1])&&zs.test(l[e])){l=l.slice(e);break}if(o!=r)for(let e=l.length-1;e>l.length-Bs;e--)if(!zs.test(l[e-1])&&zs.test(l[e])){l=l.slice(0,e);break}return s.EditorView.announce.of(`${e.state.phrase("current match")}. ${l} ${e.state.phrase("on line")} ${i.number}.`)}const Js=s.EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Hs=[_s,i.Prec.lowest(Ss),Js];class Vs{constructor(e={}){var t,n,i;this.newInlineEditor=e=>{var t;return e.host.dataset.type="inline",this.newEditor({...e,config:{...this.inlineCodeMirrorConfig,...e.config||{}},inline:!0,extensions:[s.keymap.of(Ls)].concat(null!==(t=e.extensions)&&void 0!==t?t:[])})},this.newDocumentEditor=e=>{var t,n;return e.host.dataset.type="document",this.newEditor({...e,config:{...this.documentCodeMirrorConfig,...null!==(t=e.config)&&void 0!==t?t:{}},inline:!1,extensions:[s.keymap.of([{key:"Shift-Enter",run:e=>!0}])].concat(null!==(n=e.extensions)&&void 0!==n?n:[])})},this.languages=null!==(t=e.languages)&&void 0!==t?t:new Vi,this.extensions=null!==(n=e.extensions)&&void 0!==n?n:new Ke,this.translator=null!==(i=e.translator)&&void 0!==i?i:Ee.nullTranslator,this.inlineCodeMirrorConfig={},this.documentCodeMirrorConfig={lineNumbers:!0,scrollPastEnd:!0}}newEditor(e){return new Gi({extensionsRegistry:this.extensions,languages:this.languages,translator:this.translator,...e})}}class Gs{constructor(e){this.languages=e}getMimeTypeByLanguage(e){const t=e.file_extension||"",n=this.languages.findBest(e.codemirror_mode||{mimetype:e.mimetype,name:e.name,ext:[t.split(".").slice(-1)[0]]});return n?n.mime:Ze.N.defaultMimeType}getMimeTypeByFilePath(e){var t;const n=et.PathExt.extname(e);if(".ipy"===n)return"text/x-python";if(".md"===n)return"text/x-ipythongfm";const i=this.languages.findByFileName(e);return i?Array.isArray(i.mime)?null!==(t=i.mime[0])&&void 0!==t?t:Ze.N.defaultMimeType:i.mime:Ze.N.defaultMimeType}}var Us=n(95274);const Ws={search(e,t){if("string"!=typeof t)try{t=JSON.stringify(t)}catch(e){return console.warn("Unable to search with TextSearchEngine non-JSON serializable object.",e,t),Promise.resolve([])}e.global||(e=new RegExp(e.source,e.flags+"g"));const n=new Array;let i=null;for(;null!==(i=e.exec(t));)n.push({text:i[0],position:i.index});return Promise.resolve(n)}};class Qs{constructor(){this.currentIndex=null,this.query=null,this._isActive=!0,this._inSelection=null,this._isDisposed=!1,this._cmHandler=null,this.currentIndex=null,this._stateChanged=new Ce.Signal(this)}get cmHandler(){return this._cmHandler||(this._cmHandler=new Ys(this.editor)),this._cmHandler}get stateChanged(){return this._stateChanged}get currentMatchIndex(){return this.isActive?this.currentIndex:null}get isActive(){return this._isActive}get isDisposed(){return this._isDisposed}get matchesCount(){return this.isActive?this.cmHandler.matches.length:0}clearHighlight(){return this.currentIndex=null,this.cmHandler.clearHighlight(),Promise.resolve()}dispose(){this._isDisposed||(this._isDisposed=!0,Ce.Signal.clearData(this),this.isActive&&this.endQuery().catch((e=>{console.error("Failed to end search query on cells.",e)})))}async setIsActive(e){this._isActive!==e&&(this._isActive=e,this._isActive?null!==this.query&&await this.startQuery(this.query,this.filters):await this.endQuery())}async setSearchSelection(e){this._inSelection!==e&&(this._inSelection=e,await this.updateCodeMirror(this.model.sharedModel.getSource()),this._stateChanged.emit())}setProtectSelection(e){this.cmHandler.protectSelection=e}async startQuery(e,t){this.query=e,this.filters=t;const n=this.model.sharedModel.getSource();await this.updateCodeMirror(n),this.model.sharedModel.changed.connect(this.onSharedModelChanged,this)}async endQuery(){await this.clearHighlight(),await this.cmHandler.endQuery(),this.currentIndex=null}async highlightNext(e=!0,t){if(0!==this.matchesCount&&this.isActive){let n=await this.cmHandler.highlightNext(t);return this.currentIndex=n?this.cmHandler.currentIndex:e?0:null,n}return this.currentIndex=null,Promise.resolve(this.getCurrentMatch())}async highlightPrevious(e=!0,t){if(0!==this.matchesCount&&this.isActive){let n=await this.cmHandler.highlightPrevious(t);return this.currentIndex=n?this.cmHandler.currentIndex:e?this.matchesCount-1:null,n}return this.currentIndex=null,Promise.resolve(this.getCurrentMatch())}replaceCurrentMatch(e,t,n){if(!this.isActive)return Promise.resolve(!1);let i=!1;if(null!==this.currentIndex&&this.currentIndex<this.cmHandler.matches.length){const t=this.getCurrentMatch();if(t){this.cmHandler.matches.splice(this.currentIndex,1),this.currentIndex=this.currentIndex<this.cmHandler.matches.length?Math.max(this.currentIndex-1,0):null;const s=(null==n?void 0:n.regularExpression)?t.text.replace(this.query,e):e,r=(null==n?void 0:n.preserveCase)?Us.$C.preserveCase(t.text,s):s;this.model.sharedModel.updateSource(t.position,t.position+t.text.length,r),i=!0}else this.currentIndex=null}return Promise.resolve(i)}replaceAllMatches(e,t){if(!this.isActive)return Promise.resolve(!1);let n=this.cmHandler.matches.length>0,i=this.model.sharedModel.getSource(),s=0;const r=this.cmHandler.matches.reduce(((n,r)=>{const a=r.position,o=a+r.text.length,l=(null==t?void 0:t.regularExpression)?r.text.replace(this.query,e):e,c=(null==t?void 0:t.preserveCase)?Us.$C.preserveCase(r.text,l):l,h=`${n}${i.slice(s,a)}${c}`;return s=o,h}),"");return n&&(this.cmHandler.matches=[],this.currentIndex=null,this.model.sharedModel.setSource(`${r}${i.slice(s)}`)),Promise.resolve(n)}getCurrentMatch(){if(null!==this.currentIndex){let e;return this.currentIndex<this.cmHandler.matches.length&&(e=this.cmHandler.matches[this.currentIndex]),e}}async onSharedModelChanged(e,t){t.sourceChange&&(await this.updateCodeMirror(e.getSource()),this._stateChanged.emit())}async updateCodeMirror(e){if(null!==this.query&&this.isActive){const t=await Ws.search(this.query,e);if(this._inSelection){const e=this.editor,n=e.getOffsetAt(this._inSelection.start),i=e.getOffsetAt(this._inSelection.end);this.cmHandler.matches=t.filter((e=>e.position>=n&&e.position<=i)),null===this.cmHandler.currentIndex&&this.cmHandler.matches.length>0&&await this.cmHandler.highlightNext({from:"selection",select:!1,scroll:!1}),this.currentIndex=this.cmHandler.currentIndex}else this.cmHandler.matches=t}else this.cmHandler.matches=[]}}class Ys{constructor(e){this._current=null,this._cm=e,this._matches=new Array,this._currentIndex=null,this._highlightEffect=i.StateEffect.define({map:(e,t)=>{const n=e=>({text:e.text,position:t.mapPos(e.position)});return{matches:e.matches.map(n),currentMatch:e.currentMatch?n(e.currentMatch):null}}}),this._highlightMark=s.Decoration.mark({class:"cm-searching"}),this._currentMark=s.Decoration.mark({class:"jp-current-match"}),this._highlightField=i.StateField.define({create:()=>s.Decoration.none,update:(e,t)=>{e=e.map(t.changes);for(let n of t.effects)if(n.is(this._highlightEffect)){const t=n;e=t.value.matches.length?(e=e.update({add:t.value.matches.map((e=>this._highlightMark.range(e.position,e.position+e.text.length))),filter:()=>!1})).update({add:t.value.currentMatch?[this._currentMark.range(t.value.currentMatch.position,t.value.currentMatch.position+t.value.currentMatch.text.length)]:[]}):s.Decoration.none}return e},provide:e=>s.EditorView.decorations.from(e)}),this._domEventHandlers=s.EditorView.domEventHandlers({focus:()=>{this._selectCurrentMatch()}})}get currentIndex(){return this._currentIndex}get matches(){return this._matches}set matches(e){this._matches=e,null!==this._currentIndex&&this._currentIndex>this._matches.length&&(this._currentIndex=this._matches.length>0?0:null),this._highlightCurrentMatch({select:!1})}get protectSelection(){return this._protectSelection}set protectSelection(e){this._protectSelection=e}clearHighlight(){this._currentIndex=null,this._highlightCurrentMatch()}endQuery(){return this._currentIndex=null,this._matches=[],this._cm&&this._cm.editor.dispatch({effects:this._highlightEffect.of({matches:[],currentMatch:null})}),Promise.resolve()}highlightNext(e){var t;return this._currentIndex=this._findNext(!1,null!==(t=null==e?void 0:e.from)&&void 0!==t?t:"auto"),this._highlightCurrentMatch(e),Promise.resolve(null!==this._currentIndex?this._matches[this._currentIndex]:void 0)}highlightPrevious(e){var t;return this._currentIndex=this._findNext(!0,null!==(t=null==e?void 0:e.from)&&void 0!==t?t:"auto"),this._highlightCurrentMatch(e),Promise.resolve(null!==this._currentIndex?this._matches[this._currentIndex]:void 0)}setEditor(e){if(this._cm)throw new Error("CodeMirrorEditor already set.");this._cm=e,null!==this._currentIndex&&this._highlightCurrentMatch(),this._cm.editor.dispatch({effects:i.StateEffect.appendConfig.of(this._domEventHandlers)}),this._refresh()}_selectCurrentMatch(e=!0){const t=this._current;if(!t)return;if(!this._cm)return;const n={anchor:t.position,head:t.position+t.text.length},r=this._cm.editor.state.selection.main;if(r.from===t.position&&r.to===t.position+t.text.length||this._protectSelection){if(e)return void this._cm.editor.dispatch({effects:s.EditorView.scrollIntoView(i.EditorSelection.range(n.anchor,n.head))})}else this._cm.editor.dispatch({selection:n,scrollIntoView:e})}_highlightCurrentMatch(e){var t,n,i;if(this._cm){if(null!==this._currentIndex){const r=this.matches[this._currentIndex];this._current=r,(null===(t=null==e?void 0:e.select)||void 0===t||t)&&(this._cm.hasFocus()?this._selectCurrentMatch(null===(n=null==e?void 0:e.scroll)||void 0===n||n):(null===(i=null==e?void 0:e.scroll)||void 0===i||i)&&this._cm.editor.dispatch({effects:s.EditorView.scrollIntoView(r.position)}))}else this._current=null;this._refresh()}}_refresh(){if(!this._cm)return;let e=[this._highlightEffect.of({matches:this.matches,currentMatch:this._current})];this._cm.state.field(this._highlightField,!1)||e.push(i.StateEffect.appendConfig.of([this._highlightField])),this._cm.editor.dispatch({effects:e})}_findNext(e,t="auto"){if(0===this._matches.length)return null;let n=0;if("auto"===t&&this._cm.hasFocus()||"selection"===t){const t=this._cm.state.selection.main;n=e?t.anchor:t.head}else if("selection-start"===t){const e=this._cm.state.selection.main;n=Math.min(e.anchor,e.head)}else"start"===t?n=0:this._current&&(n=e?this._current.position:this._current.position+this._current.text.length);0===n&&e&&null===this.currentIndex&&(n=this._cm.doc.length);const i=n;let s=Xs.findNext(this._matches,i,0,this._matches.length-1);return null===s?e?this._matches.length-1:null:e&&(s-=1,s<0)?null:s}}var Xs;!function(e){e.findNext=function(e,t,n=0,i=1/0){for(i=Math.min(e.length-1,i);n<=i;){let s=Math.floor(.5*(n+i));const r=e[s].position;if(r<t){if((n=s+1)<e.length&&e[n].position>t)return n}else{if(!(r>t))return s;if((i=s-1)>0&&e[i].position<t)return s}}const s=n>0?n-1:0;return e[s].position>=t?s:null}}(Xs||(Xs={}));const Ks=new Se.Token("@jupyterlab/codemirror:IEditorExtensionRegistry","A registry for CodeMirror extension factories."),Zs=new Se.Token("@jupyterlab/codemirror:IEditorLanguageRegistry","A registry for CodeMirror languages."),er=new Se.Token("@jupyterlab/codemirror:IEditorThemeRegistry","A registry for CodeMirror theme.")},95274:(e,t,n)=>{n.d(t,{$C:()=>l});var i=n(23190),s=n(32322);const r=["cm-string","cm-overlay","cm-searching"],a=["CodeMirror-selectedtext"];class o{static search(e,t){if(!(t instanceof Node))return console.warn("Unable to search with HTMLSearchEngine the provided object.",t),Promise.resolve([]);e.global||(e=new RegExp(e.source,e.flags+"g"));const n=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:n=>{let i=n.parentElement;for(;i!==t;){if(i.nodeName in o.UNSUPPORTED_ELEMENTS)return NodeFilter.FILTER_REJECT;i=i.parentElement}return e.test(n.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let s=null;for(;null!==(s=i.nextNode());){e.lastIndex=0;let t=null;for(;null!==(t=e.exec(s.textContent));)n.push({text:t[0],position:t.index,node:s})}return Promise.resolve(n)}}o.UNSUPPORTED_ELEMENTS={BASE:!0,HEAD:!0,LINK:!0,META:!0,STYLE:!0,TITLE:!0,BODY:!0,AREA:!0,AUDIO:!0,IMG:!0,MAP:!0,TRACK:!0,VIDEO:!0,APPLET:!0,EMBED:!0,IFRAME:!0,NOEMBED:!0,OBJECT:!0,PARAM:!0,PICTURE:!0,SOURCE:!0,CANVAS:!0,NOSCRIPT:!0,SCRIPT:!0,SVG:!0};class l extends s.X{constructor(){super(...arguments),this.isReadOnly=!0,this._matches=[],this._mutationObserver=new MutationObserver(this._onWidgetChanged.bind(this)),this._markNodes=new Array}static isApplicable(e){return e instanceof i.Widget}static createNew(e,t,n){return new l(e)}get currentMatchIndex(){return this._currentMatchIndex>=0?this._currentMatchIndex:null}get currentMatch(){var e;return null!==(e=this._matches[this._currentMatchIndex])&&void 0!==e?e:null}get matches(){return this._matches?this._matches.map((e=>Object.assign({},e))):this._matches}get matchesCount(){return this._matches.length}clearHighlight(){return this._currentMatchIndex>=0&&this._markNodes[this._currentMatchIndex].classList.remove(...a),this._currentMatchIndex=-1,Promise.resolve()}dispose(){this.isDisposed||(this.endQuery().catch((e=>{console.error("Failed to end search query.",e)})),super.dispose())}async highlightNext(e){var t;return null!==(t=this._highlightNext(!1,null==e||e))&&void 0!==t?t:void 0}async highlightPrevious(e){var t;return null!==(t=this._highlightNext(!0,null==e||e))&&void 0!==t?t:void 0}async replaceCurrentMatch(e,t){return Promise.resolve(!1)}async replaceAllMatches(e){return Promise.resolve(!1)}async startQuery(e,t={}){if(await this.endQuery(),this._query=e,null===e)return Promise.resolve();const n=await o.search(e,this.widget.node);let i=0;for(;i<n.length;){let e=n[i].node,t=e.parentNode,s=[n[i]];for(;++i<n.length&&n[i].node===e;)s.unshift(n[i]);const a=s.map((n=>{const i=document.createElement("mark");i.classList.add(...r),i.textContent=n.text;const s=e.splitText(n.position);return s.textContent=s.textContent.slice(n.text.length),t.insertBefore(i,s),i}));for(let e=a.length-1;e>=0;e--)this._markNodes.push(a[e])}this._mutationObserver.observe(this.widget.node,{attributes:!1,characterData:!0,childList:!0,subtree:!0}),this._matches=n}async endQuery(){this._mutationObserver.disconnect(),this._markNodes.forEach((e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()})),this._markNodes=[],this._matches=[],this._currentMatchIndex=-1}_highlightNext(e,t){if(0===this._matches.length)return null;if(-1===this._currentMatchIndex?this._currentMatchIndex=e?this.matches.length-1:0:(this._markNodes[this._currentMatchIndex].classList.remove(...a),this._currentMatchIndex=e?this._currentMatchIndex-1:this._currentMatchIndex+1,t&&(this._currentMatchIndex<0||this._currentMatchIndex>=this._matches.length)&&(this._currentMatchIndex=(this._currentMatchIndex+this._matches.length)%this._matches.length)),this._currentMatchIndex>=0&&this._currentMatchIndex<this._matches.length){const t=this._markNodes[this._currentMatchIndex];return t.classList.add(...a),function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.left>=0&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(t)||t.scrollIntoView(e),t.focus(),this._matches[this._currentMatchIndex]}return this._currentMatchIndex=-1,null}async _onWidgetChanged(e,t){this._currentMatchIndex=-1,await this.startQuery(this._query),this._stateChanged.emit()}}},32322:(e,t,n)=>{n.d(t,{X:()=>s});var i=n(53968);class s{constructor(e){this.widget=e,this._stateChanged=new i.Signal(this),this._filtersChanged=new i.Signal(this),this._disposed=!1}get stateChanged(){return this._stateChanged}get filtersChanged(){return this._filtersChanged}get currentMatchIndex(){return null}get isDisposed(){return this._disposed}get matchesCount(){return null}dispose(){this._disposed||(this._disposed=!0,i.Signal.clearData(this))}getInitialQuery(){return""}getFilters(){return{}}static preserveCase(e,t){return e.toUpperCase()===e?t.toUpperCase():e.toLowerCase()===e?t.toLowerCase():r(e)===e?r(t):t}}function r([e="",...t]){return e.toUpperCase()+""+t.join("").toLowerCase()}}}]);